// ============================================================================
// üåü PITCHCONNECT DATABASE SCHEMA v7.2.0 - ENTERPRISE EDITION
// ============================================================================
// Enhanced with:
// - Complete Two-Factor Authentication model
// - Secure password reset flow
// - Email verification system
// - Session management
// - Audit logging for auth events
// - Team Join Request System (NEW)
// - Job Posting & Application System (NEW)
// - Enhanced Club/Team Management
// ============================================================================

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch", "views", "postgresqlExtensions"]
  binaryTargets   = ["native", "rhel-openssl-1.0.x", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  directUrl  = env("DIRECT_URL")
  extensions = [citext]
}

// ============================================================================
// üìã ENUMS - COMPLETE SYSTEM
// ============================================================================

enum UserRole {
  SUPERADMIN
  ADMIN
  PLAYER
  PLAYER_PRO
  COACH
  COACH_PRO
  MANAGER
  CLUB_MANAGER
  CLUB_OWNER
  TREASURER
  REFEREE
  SCOUT
  ANALYST
  PARENT
  GUARDIAN
  LEAGUE_ADMIN
  MEDICAL_STAFF
  MEDIA_MANAGER
  FAN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  BANNED
  PENDING_VERIFICATION
  PENDING_EMAIL_VERIFICATION
  PENDING_PHONE_VERIFICATION
  PENDING_APPROVAL
  ARCHIVED
  DELETED
}

enum UserType {
  INDIVIDUAL
  ORGANIZATION
  FAMILY
}

enum AccountTier {
  FREE
  PRO
  PREMIUM
  ENTERPRISE
}

enum OrganisationRole {
  OWNER
  ADMIN
  MANAGER
  MEMBER
  VIEWER
}

enum OrganisationTier {
  STARTER
  PROFESSIONAL
  ENTERPRISE
  CUSTOM
}

enum PermissionType {
  USER_CREATE
  USER_READ
  USER_UPDATE
  USER_DELETE
  USER_SUSPEND
  USER_BAN
  TEAM_CREATE
  TEAM_READ
  TEAM_UPDATE
  TEAM_DELETE
  TEAM_INVITE
  TEAM_REMOVE_MEMBER
  MATCH_CREATE
  MATCH_READ
  MATCH_UPDATE
  MATCH_DELETE
  MATCH_PUBLISH
  MATCH_APPROVE_RESULT
  MATCH_RECORD_STATS
  PLAYER_CREATE
  PLAYER_READ
  PLAYER_UPDATE
  PLAYER_DELETE
  PLAYER_VERIFY
  PLAYER_TRANSFER
  MEDICAL_READ
  MEDICAL_CREATE
  MEDICAL_UPDATE
  BILLING_READ
  BILLING_UPDATE
  BILLING_MANAGE_SUBSCRIPTIONS
  ANALYTICS_VIEW
  ANALYTICS_EXPORT
  API_ACCESS
  API_KEY_CREATE
  API_KEY_REVOKE
  FACILITY_MANAGE
  FACILITY_BOOK
  SYSTEM_ADMIN
  AUDIT_LOG_VIEW
}

enum DataRetentionPolicy {
  EPHEMERAL
  TEMPORARY
  STANDARD
  PERMANENT
  DELETED
}

enum Sport {
  FOOTBALL
  NETBALL
  RUGBY
  CRICKET
  AMERICAN_FOOTBALL
  BASKETBALL
  HOCKEY
  LACROSSE
  AUSTRALIAN_RULES
  GAELIC_FOOTBALL
  FUTSAL
  BEACH_FOOTBALL
}

enum Position {
  GOALKEEPER
  LEFT_BACK
  CENTER_BACK
  RIGHT_BACK
  LEFT_WING_BACK
  RIGHT_WING_BACK
  DEFENSIVE_MIDFIELDER
  CENTRAL_MIDFIELDER
  LEFT_MIDFIELDER
  RIGHT_MIDFIELDER
  ATTACKING_MIDFIELDER
  LEFT_WINGER
  RIGHT_WINGER
  STRIKER
  CENTER_FORWARD
  SECOND_STRIKER
  GOALKEEPER_NETBALL
  GOAL_ATTACK
  WING_ATTACK
  CENTER
  WING_DEFENSE
  GOAL_DEFENSE
  GOAL_SHOOTER
  PROP
  HOOKER
  LOCK
  FLANKER
  NUMBER_8
  SCRUM_HALF
  FLY_HALF
  INSIDE_CENTER
  OUTSIDE_CENTER
  FULLBACK
  HOOKER_LEAGUE
  PROP_LEAGUE
  SECOND_ROW
  LOOSE_FORWARD
  QUARTERBACK
  RUNNING_BACK
  WIDE_RECEIVER
  TIGHT_END
  LEFT_TACKLE
  LEFT_GUARD
  CENTER_POSITION
  RIGHT_GUARD
  RIGHT_TACKLE
  LINEBACKER
  DEFENSIVE_END
  DEFENSIVE_TACKLE
  SAFETY
  CORNERBACK
  PUNTER
  KICKER
  POINT_GUARD
  SHOOTING_GUARD
  SMALL_FORWARD
  POWER_FORWARD
  CENTER_BASKETBALL
  BATSMAN
  BOWLER
  ALL_ROUNDER
  FIELDER
  WICKET_KEEPER
  GOALTENDER
  DEFENSEMAN
  WINGER
  CENTER_HOCKEY
  UTILITY
  SUBSTITUTE
}

enum PreferredFoot {
  LEFT
  RIGHT
  BOTH
}

enum MatchStatus {
  SCHEDULED
  WARMUP
  LIVE
  HALFTIME
  SECOND_HALF
  EXTRA_TIME_FIRST
  EXTRA_TIME_SECOND
  PENALTIES
  FINISHED
  CANCELLED
  POSTPONED
  ABANDONED
  REPLAY_SCHEDULED
  VOIDED
  DELAYED
  SUSPENDED
}

enum MatchAttendanceStatus {
  AVAILABLE
  UNAVAILABLE
  CONFIRMED
  MAYBE
  LATE
  NO_SHOW
  EXCUSED_ABSENCE
  INJURED
  ILL
  SUSPENDED
  NOT_SELECTED
  SUBSTITUTE
  STARTING_LINEUP
  ATTENDED
  UNUSED_SUB
  UNUSED_SQUAD
  INTERNATIONAL_DUTY
  LOAN
}

enum MatchEventType {
  GOAL
  ASSIST
  YELLOW_CARD
  SECOND_YELLOW
  RED_CARD
  SUBSTITUTION_ON
  SUBSTITUTION_OFF
  INJURY
  INJURY_TIME
  FULLTIME
  HALFTIME
  KICKOFF
  PENALTY_SCORED
  PENALTY_MISSED
  PENALTY_SAVED
  OWN_GOAL
  VAR_REVIEW
  VAR_DECISION
  CHALLENGE_REVIEW
  TIMEOUT
  INTERCEPT
  REBOUND
  CENTER_PASS
  OBSTRUCTION
  TRY
  CONVERSION
  PENALTY_GOAL
  DROP_GOAL
  SCRUM
  LINEOUT
  MAUL
  RUCK
  KNOCK_ON
  HIGH_TACKLE
  OFFSIDE
  WICKET
  BOUNDARY
  MAIDEN_OVER
  WIDE
  NO_BALL
  BYE
  LEG_BYE
  OVERTHROW
  THREE_POINTER
  FAST_BREAK
  TURNOVER
  OFFENSIVE_FOUL
  TRAVEL
  DOUBLE_DRIBBLE
  TOUCHDOWN
  FIELD_GOAL
  SAFETY_SCORE
  INTERCEPTION
  FUMBLE
  SACK
  HAT_TRICK
  MAJOR_PENALTY
  MINOR_PENALTY
  FIGHT
  CAPTAIN_CHANGE
  WEATHER_DELAY
  FLOODLIGHT_FAILURE
}

enum FormationType {
  FOUR_FOUR_TWO
  FOUR_THREE_THREE
  THREE_FIVE_TWO
  FIVE_THREE_TWO
  FIVE_FOUR_ONE
  THREE_FOUR_THREE
  FOUR_TWO_THREE_ONE
  FOUR_ONE_FOUR_ONE
  THREE_THREE_FOUR
  FIVE_TWO_THREE
  TWO_THREE_FIVE
  FOUR_ONE_TWO_THREE
  FOUR_FOUR_ONE_ONE
  FOUR_THREE_TWO_ONE
  FOUR_FIVE_ONE
  CUSTOM
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  EXPIRED
  PAUSED
  PAST_DUE
  TRIAL
  SUSPENDED
  DOWNGRADED
  PENDING_UPGRADE
  PENDING_CANCELLATION
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
  DISPUTED
  CANCELLED
  PROCESSING
  CHARGEBACK
}

enum WebhookEvent {
  MATCH_CREATED
  MATCH_STARTED
  MATCH_FINISHED
  MATCH_CANCELLED
  PLAYER_ADDED
  PLAYER_UPDATED
  PLAYER_INJURED
  PLAYER_TRANSFERRED
  TEAM_UPDATED
  SUBSCRIPTION_UPDATED
  PAYMENT_RECEIVED
  USER_CREATED
  USER_DELETED
  RESULT_APPROVED
  TRAINING_SCHEDULED
  ANNOUNCEMENT_POSTED
  JOB_POSTED
  JOB_APPLICATION_RECEIVED
  JOIN_REQUEST_RECEIVED
}

enum AuditActionType {
  USER_CREATED
  USER_UPDATED
  USER_DELETED
  USER_SUSPENDED
  USER_BANNED
  USER_REACTIVATED
  ROLE_ASSIGNED
  ROLE_REMOVED
  USER_REGISTERED
  USER_LOGIN
  USER_LOGOUT
  LOGIN_FAILED
  LOGIN_LOCKED
  EMAIL_VERIFIED
  PHONE_VERIFIED
  PASSWORD_CHANGED
  PASSWORD_RESET_REQUESTED
  PASSWORD_RESET_COMPLETED
  TWO_FACTOR_ENABLED
  TWO_FACTOR_DISABLED
  TWO_FACTOR_VERIFIED
  TWO_FACTOR_BACKUP_USED
  SESSION_CREATED
  SESSION_REVOKED
  SESSION_EXPIRED
  VERIFICATION_EMAIL_SENT
  VERIFICATION_EMAIL_RESENT
  SUBSCRIPTION_GRANTED
  SUBSCRIPTION_UPGRADED
  SUBSCRIPTION_DOWNGRADED
  SUBSCRIPTION_CANCELLED
  PAYMENT_PROCESSED
  PAYMENT_FAILED
  REFUND_PROCESSED
  DATA_EXPORTED
  DATA_DELETED
  DATA_IMPORTED
  TEAM_CREATED
  TEAM_UPDATED
  TEAM_DELETED
  MATCH_CREATED
  MATCH_UPDATED
  MATCH_RESULT_UPDATED
  MATCH_CANCELLED
  PLAYER_TRANSFER
  PLAYER_CONTRACT_SIGNED
  MEDICAL_RECORD_ACCESSED
  MEDICAL_RECORD_CREATED
  JOIN_REQUEST_SUBMITTED
  JOIN_REQUEST_APPROVED
  JOIN_REQUEST_REJECTED
  JOIN_REQUEST_CANCELLED
  JOB_POSTED
  JOB_CLOSED
  JOB_APPLICATION_SUBMITTED
  JOB_APPLICATION_REVIEWED
  JOB_APPLICATION_ACCEPTED
  JOB_APPLICATION_REJECTED
  CONSENT_UPDATED
  GDPR_REQUEST
  DATA_RETENTION_APPLIED
  SYSTEM_MAINTENANCE
  API_KEY_GENERATED
  API_KEY_REVOKED
  SUSPICIOUS_LOGIN
  SECURITY_ALERT
}

enum TrainingIntensity {
  RECOVERY
  LOW
  MEDIUM
  HIGH
  MAXIMUM
  COMPETITIVE
}

enum TrainingCategory {
  PASSING
  SHOOTING
  DEFENDING
  POSSESSION
  SET_PIECES
  CONDITIONING
  TACTICAL
  RECOVERY
  STRENGTH_POWER
  SPEED_AGILITY
  FLEXIBILITY
  BALANCE_COORDINATION
  MENTAL_PREPARATION
  VIDEO_ANALYSIS
  TEAM_BUILDING
  GOALKEEPER_SPECIFIC
  POSITION_SPECIFIC
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  EXCUSED
  LATE
  LEFT_EARLY
  PARTIAL
}

enum LeagueFormat {
  ROUND_ROBIN
  DOUBLE_ROUND_ROBIN
  KNOCKOUT
  GROUP_KNOCKOUT
  ROUND_ROBIN_WITH_PLAYOFFS
  SWISS_SYSTEM
  LADDER_SYSTEM
  HOME_AND_AWAY
  CUSTOM
}

enum LeagueVisibility {
  PUBLIC
  PRIVATE
  UNLISTED
  INVITE_ONLY
  FRIENDS_ONLY
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  REJECTED
  EXPIRED
  CANCELLED
  REVOKED
}

enum ResultApprovalStatus {
  PENDING
  APPROVED
  REJECTED
  DISPUTED
  REQUIRES_REVISION
  UNDER_REVIEW
  AUTO_APPROVED
}

enum ClubMemberRole {
  OWNER
  MANAGER
  HEAD_COACH
  ASSISTANT_COACH
  PLAYER
  STAFF
  TREASURER
  SCOUT
  ANALYST
  MEDICAL_STAFF
  PHYSIOTHERAPIST
  NUTRITIONIST
  PSYCHOLOGIST
  PERFORMANCE_COACH
  GOALKEEPING_COACH
  KIT_MANAGER
  MEDIA_OFFICER
}

enum TeamType {
  PROFESSIONAL
  SEMI_PROFESSIONAL
  AMATEUR
  ACADEMY
  YOUTH
  RECREATIONAL
  UNIVERSITY
  SCHOOL
}

enum VideoQuality {
  Q_360P
  Q_480P
  Q_720P
  Q_1080P
  Q_2K
  Q_4K
}

enum TranscodingStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  CANCELLED
  QUEUED
}

enum VideoProcessingProvider {
  MUX
  AWS_MEDIACONVERT
  BUNNY_CDN
  CLOUDINARY
  INTERNAL
  VERCEL_BLOB
}

enum TimesheetStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
  PAID
  DISPUTED
  ARCHIVED
}

enum PaymentType {
  SUBSCRIPTION
  COACHING_FEE
  MATCH_FEE
  TOURNAMENT_FEE
  TRAINING_FEE
  FACILITY_RENTAL
  EQUIPMENT
  REFUND
  BONUS
  SALARY
  COMMISSION
  TRANSFER_FEE
  LOAN_FEE
  SPONSORSHIP
  OTHER
}

enum TransferType {
  PERMANENT
  LOAN
  FREE_TRANSFER
  YOUTH_DEVELOPMENT
  TRIAL
  EXCHANGE
}

enum TransferStatus {
  PENDING
  NEGOTIATING
  AGREED
  COMPLETED
  CANCELLED
  REJECTED
  EXPIRED
}

enum InjurySeverity {
  MINOR
  MODERATE
  SEVERE
  CRITICAL
  CAREER_THREATENING
}

enum InjuryStatus {
  ACTIVE
  RECOVERING
  REHABILITATION
  CLEARED
  CHRONIC
}

enum FacilityType {
  STADIUM
  TRAINING_GROUND
  INDOOR_ARENA
  GYM
  SWIMMING_POOL
  MEDICAL_CENTER
  MEETING_ROOM
  OFFICE
  CHANGING_ROOM
  HOSPITALITY
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  NO_SHOW
}

enum ChatType {
  DIRECT
  GROUP
  TEAM
  CLUB
  ANNOUNCEMENT
}

enum MatchOfficialRole {
  REFEREE
  ASSISTANT_REFEREE_1
  ASSISTANT_REFEREE_2
  FOURTH_OFFICIAL
  VAR_OFFICIAL
  AVAR_OFFICIAL
  RESERVE_ASSISTANT
  MATCH_COMMISSIONER
  REFEREE_ASSESSOR
}

enum AnnouncementPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum AnnouncementStatus {
  DRAFT
  SCHEDULED
  PUBLISHED
  ARCHIVED
}

enum GoalType {
  PERFORMANCE
  DEVELOPMENT
  FITNESS
  BEHAVIORAL
  TEAM
}

enum GoalStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  EXCEEDED
  MISSED
  CANCELLED
}

enum VerificationType {
  EMAIL
  PHONE
  PASSWORD_RESET
  TWO_FACTOR
  ACCOUNT_RECOVERY
}

// NEW ENUMS v7.2.0 - JOIN REQUESTS & JOB BOARD

enum JoinRequestStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
  EXPIRED
  WITHDRAWN
}

enum JobPostingStatus {
  DRAFT
  OPEN
  PAUSED
  CLOSED
  FILLED
  CANCELLED
  EXPIRED
}

enum JobApplicationStatus {
  PENDING
  REVIEWING
  SHORTLISTED
  INTERVIEW_SCHEDULED
  INTERVIEW_COMPLETED
  OFFERED
  ACCEPTED
  REJECTED
  WITHDRAWN
  HIRED
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  TEMPORARY
  INTERNSHIP
  VOLUNTEER
  FREELANCE
  SEASONAL
}

enum JobCategory {
  COACHING
  MANAGEMENT
  MEDICAL
  ANALYSIS
  SCOUTING
  ADMINISTRATION
  MEDIA
  OPERATIONS
  FINANCE
  YOUTH_DEVELOPMENT
  PERFORMANCE
  OTHER
}

enum ExperienceLevel {
  ENTRY
  JUNIOR
  MID
  SENIOR
  LEAD
  DIRECTOR
  EXECUTIVE
}

// ============================================================================
// üè¢ ORGANISATION & MULTI-TENANCY MODELS
// ============================================================================

model Organisation {
  id   String @id @default(cuid())
  slug String @unique @db.VarChar(63)

  name        String
  description String? @db.Text
  logo        String?
  banner      String?
  website     String?

  email    String
  phone    String?
  country  String
  timezone String @default("Europe/London")

  tier          OrganisationTier @default(STARTER)
  monthlyBudget Float?
  currency      String           @default("GBP")

  registrationNumber      String?   @unique
  taxId                   String?   @unique
  complianceStatus        String    @default("PENDING")
  gdprCompliant           Boolean   @default(false)
  dataProcessingAgreement DateTime?

  totalUsers    Int @default(0)
  totalTeams    Int @default(0)
  totalMatches  Int @default(0)
  storageUsedMb Int @default(0)

  enabledFeatures String[] @default([])
  customFeatures  Json?

  maxUsers            Int @default(100)
  maxTeams            Int @default(10)
  maxStorageMb        Int @default(5120)
  maxApiCallsPerMonth Int @default(10000)
  maxConcurrentUsers  Int @default(50)

  subscriptionId  String?   @unique
  billingEmail    String?
  billingCycle    String    @default("MONTHLY")
  nextBillingDate DateTime?

  lastActivityAt DateTime?
  isActive       Boolean   @default(true)
  isArchived     Boolean   @default(false)
  archivedAt     DateTime?

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  owner                User                     @relation("organisationOwner", fields: [ownerId], references: [id])
  ownerId              String
  members              OrganisationMember[]
  invitations          OrganisationInvitation[]
  clubs                Club[]
  apiKeys              ApiKey[]
  webhooks             Webhook[]
  auditLogs            AuditLog[]
  backups              DatabaseBackup[]
  subscriptions        Subscription[]
  dataExportRequests   DataExportRequest[]
  dataDeletionRequests DataDeletionRequest[]
  apiUsageMetrics      ApiUsageMetrics[]
  quotaUsage           QuotaUsage[]
  seasons              Season[]
  facilities           Facility[]
  sponsors             Sponsor[]
  mediaAssets          MediaAsset[]

  @@index([slug])
  @@index([ownerId])
  @@index([tier])
  @@index([isActive])
  @@index([createdAt])
  @@index([country])
  @@map("organisations")
}

model OrganisationMember {
  id             String  @id @default(cuid())
  organisationId String
  userId         String
  roleId         String?

  role OrganisationRole @default(MEMBER)

  customPermissions String[]

  joinedAt  DateTime  @default(now())
  invitedBy String?
  invitedAt DateTime?

  lastAccessAt DateTime?
  lastAccessIp String?

  removedAt DateTime?

  organisation Organisation @relation(fields: [organisationId], references: [id], onDelete: Cascade)
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  customRole   Role?        @relation("roleMembers", fields: [roleId], references: [id], onDelete: SetNull)

  @@unique([organisationId, userId])
  @@index([organisationId])
  @@index([userId])
  @@index([roleId])
  @@index([role])
  @@index([joinedAt])
  @@map("organisation_members")
}

model OrganisationInvitation {
  id             String           @id @default(cuid())
  organisationId String
  email          String
  role           OrganisationRole @default(MEMBER)

  invitedBy String
  invitedAt DateTime @default(now())
  expiresAt DateTime

  acceptedAt DateTime?
  acceptedBy String?

  status InvitationStatus @default(PENDING)

  token String @unique @default(cuid())

  organisation Organisation @relation(fields: [organisationId], references: [id], onDelete: Cascade)

  @@unique([organisationId, email])
  @@index([organisationId])
  @@index([status])
  @@index([token])
  @@index([expiresAt])
  @@map("organisation_invitations")
}

model Season {
  id             String @id @default(cuid())
  organisationId String

  name      String
  startDate DateTime
  endDate   DateTime

  isActive  Boolean @default(false)
  isCurrent Boolean @default(false)

  description String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organisation Organisation @relation(fields: [organisationId], references: [id], onDelete: Cascade)
  leagues      League[]
  transfers    Transfer[]

  @@unique([organisationId, name])
  @@index([organisationId])
  @@index([isActive])
  @@index([isCurrent])
  @@map("seasons")
}

// ============================================================================
// üë§ USER & AUTHENTICATION MODELS
// ============================================================================

model User {
  id            String    @id @default(cuid())
  email         String    @unique @db.Citext
  emailVerified DateTime?
  phone         String?   @unique
  phoneVerified DateTime?

  firstName   String
  lastName    String
  middleName  String?
  displayName String?
  avatar      String?
  banner      String?
  bio         String?   @db.Text
  dateOfBirth DateTime?
  nationality String?
  language    String    @default("en-GB")
  timezone    String    @default("Europe/London")

  userType     UserType    @default(INDIVIDUAL)
  accountTier  AccountTier @default(FREE)
  roles        UserRole[]  @default([PLAYER])
  status       UserStatus  @default(PENDING_EMAIL_VERIFICATION)
  isSuperAdmin Boolean     @default(false)

  primaryOrganisationId String?
  clubId String?
  teamId String?

  password          String?
  passwordChangedAt DateTime?
  passwordResetToken  String?   @unique
  passwordResetExpiry DateTime?

  failedLoginAttempts Int       @default(0)
  lastFailedLoginAt   DateTime?
  lastLoginAt         DateTime?
  lastLoginIp         String?
  loginAttempts       Int       @default(0)
  lockoutUntil        DateTime?

  twoFactorEnabled     Boolean  @default(false)
  twoFactorSecret      String?  @unique
  twoFactorBackupCodes String[]

  emailNotificationsEnabled Boolean @default(true)
  pushNotificationsEnabled  Boolean @default(true)
  smsNotificationsEnabled   Boolean @default(false)
  marketingEmailsEnabled    Boolean @default(false)
  privacyLevel              String  @default("FRIENDS_ONLY")
  showOnlineStatus          Boolean @default(true)
  profileVisibility         String  @default("PUBLIC")

  gdprConsent             Boolean   @default(false)
  gdprConsentDate         DateTime?
  dataProcessingConsent   Boolean   @default(false)
  marketingConsent        Boolean   @default(false)
  cookieConsent           Boolean   @default(false)
  termsAcceptedAt         DateTime?
  privacyPolicyAcceptedAt DateTime?

  followersCount Int @default(0)
  followingCount Int @default(0)

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organisationMemberships OrganisationMember[]
  organisationsOwned      Organisation[]          @relation("organisationOwner")
  accounts                Account[]
  sessions                Session[]
  refreshTokens           RefreshToken[]
  twoFactorAuth           TwoFactorAuth?
  apiKeys                 ApiKey[]
  player                  Player?
  coach                   Coach?
  referee                 Referee?
  scout                   Scout?
  analyst                 Analyst?
  clubManager             ClubManager?
  clubOwner               ClubOwner?
  parent                  Parent?
  treasurer               Treasurer?
  clubMemberships         ClubMember[]
  managedClubs            Club[]                  @relation("clubManager")
  ownedClubs              Club[]                  @relation("clubOwner")
  notifications           Notification[]
  notificationPrefs       NotificationPreference?
  messages                Message[]
  chatMembers             ChatMember[]
  chatsCreated            Chat[]                  @relation("chatCreator")
  socialActions           SocialAction[]
  followers               Follow[]                @relation("follower")
  following               Follow[]                @relation("following")
  blocks                  UserBlock[]             @relation("blocker")
  blockedBy               UserBlock[]             @relation("blocked")
  achievements            Achievement[]           @relation("achievementUser")
  badges                  Badge[]                 @relation("badgeUser")
  subscriptions           Subscription[]
  payments                Payment[]
  invoices                Invoice[]
  auditLogsCreated        AuditLog[]              @relation("auditLogUser")
  announcementsCreated    Announcement[]          @relation("announcementCreator")
  performanceGoals        PerformanceGoal[]       @relation("goalUser")
  goalsCreated            PerformanceGoal[]       @relation("goalCreator")
  jobApplications         JobApplication[]        @relation("applicant")
  reviewedApplications    JobApplication[]        @relation("applicationReviewer")
  jobPostingsCreated      JobPosting[]            @relation("jobCreator")

  @@index([email])
  @@index([phone])
  @@index([status])
  @@index([clubId])
  @@index([teamId])
  @@index([failedLoginAttempts])
  @@index([primaryOrganisationId])
  @@index([createdAt])
  @@index([lastName, firstName])
  @@index([isSuperAdmin])
  @@index([passwordResetToken])
  @@index([twoFactorEnabled])
  @@map("users")
}

model TwoFactorAuth {
  id     String @id @default(cuid())
  userId String @unique

  secret String
  enabled Boolean @default(false)
  backupCodes String[]

  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  lastUsedAt DateTime?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([enabled])
  @@map("two_factor_auth")
}

model Account {
  id                String @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String

  refresh_token String? @db.Text
  access_token  String? @db.Text
  expires_at    Int?
  token_type    String?
  scope         String?
  id_token      String? @db.Text
  session_state String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime

  ipAddress String?
  userAgent String?
  device    String?
  location  String?

  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([sessionToken])
  @@index([expires])
  @@map("sessions")
}

model RefreshToken {
  id        String    @id @default(cuid())
  userId    String
  token     String    @unique
  expiresAt DateTime
  revokedAt DateTime?
  usedAt    DateTime?

  ipAddress String?
  userAgent String?

  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
  @@index([token])
  @@map("refresh_tokens")
}

model VerificationToken {
  id         String           @id @default(cuid())
  identifier String
  token      String           @unique
  type       VerificationType @default(EMAIL)
  expires    DateTime

  createdAt DateTime @default(now())

  @@unique([identifier, token])
  @@index([type])
  @@index([expires])
  @@index([identifier])
  @@map("verification_tokens")
}

model ApiKey {
  id             String  @id @default(cuid())
  userId         String
  organisationId String?

  name        String
  key         String    @unique @db.Char(32)
  secret      String?   @unique
  lastUsed    DateTime?
  expiresAt   DateTime?
  permissions String[]  @default([])

  rateLimit      Int @default(1000)
  rateLimitReset Int @default(3600)

  createdAt DateTime  @default(now())
  revokedAt DateTime?

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  organisation Organisation? @relation(fields: [organisationId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([key])
  @@index([organisationId])
  @@index([expiresAt])
  @@map("api_keys")
}

model Role {
  id             String @id @default(cuid())
  organisationId String

  name        String
  slug        String
  description String? @db.Text

  isBuiltIn Boolean @default(false)
  isCustom  Boolean @default(true)
  level     Int     @default(0)

  permissions          String[]
  customPermissionJson Json?

  memberCount Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organisationMembers OrganisationMember[] @relation("roleMembers")

  @@unique([organisationId, slug])
  @@index([organisationId])
  @@index([level])
  @@map("roles")
}

model Permission {
  id String @id @default(cuid())

  type        PermissionType @unique
  description String?
  category    String

  @@index([category])
  @@map("permissions")
}

model ResourcePermission {
  id String @id @default(cuid())

  resourceType String
  resourceId   String

  userId     String
  permission String

  grantedAt DateTime  @default(now())
  grantedBy String
  expiresAt DateTime?

  @@unique([resourceType, resourceId, userId, permission])
  @@index([userId])
  @@index([resourceType, resourceId])
  @@index([expiresAt])
  @@map("resource_permissions")
}

// ============================================================================
// üìã AUDIT, COMPLIANCE & DATA GOVERNANCE
// ============================================================================

model AuditLog {
  id             String  @id @default(cuid())
  organisationId String?
  userId         String?

  action AuditActionType

  resourceType String
  resourceId   String

  beforeState Json?
  afterState  Json?
  changes     String[]

  ipAddress String?
  userAgent String?
  sessionId String?
  requestId String?

  severity        String  @default("INFO")
  isCompliance    Boolean @default(false)
  requiresReview  Boolean @default(false)
  isLegalHold     Boolean @default(false)
  legalHoldReason String?

  durationMs Int?

  createdAt DateTime @default(now())

  organisation Organisation? @relation(fields: [organisationId], references: [id], onDelete: SetNull)
  user         User?         @relation("auditLogUser", fields: [userId], references: [id], onDelete: SetNull)

  @@index([organisationId])
  @@index([userId])
  @@index([action])
  @@index([resourceType, resourceId])
  @@index([createdAt])
  @@index([severity])
  @@index([isCompliance])
  @@map("audit_logs")
}

model EntityVersion {
  id String @id @default(cuid())

  entityType String
  entityId   String
  version    Int

  data Json

  changedBy    String
  changeReason String?
  changeType   String

  checksum String?

  retentionPolicy     DataRetentionPolicy @default(STANDARD)
  deletionScheduledAt DateTime?
  deletedAt           DateTime?

  createdAt DateTime @default(now())

  @@unique([entityType, entityId, version])
  @@index([entityType, entityId])
  @@index([deletionScheduledAt])
  @@index([retentionPolicy])
  @@map("entity_versions")
}

model ConsentLog {
  id     String @id @default(cuid())
  userId String

  type String

  granted   Boolean
  grantedAt DateTime

  evidence  Json?
  ipAddress String?
  userAgent String?

  withdrawnAt DateTime?

  @@index([userId])
  @@index([type])
  @@index([grantedAt])
  @@map("consent_logs")
}

model DataExportRequest {
  id             String @id @default(cuid())
  userId         String
  organisationId String

  status String @default("PENDING")

  requestedAt DateTime  @default(now())
  processedAt DateTime?
  expiresAt   DateTime

  fileUrl  String?
  fileSize Int?
  format   String  @default("JSON")

  progress Int @default(0)
  error    String?

  organisation Organisation @relation(fields: [organisationId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([expiresAt])
  @@map("data_export_requests")
}

model DataDeletionRequest {
  id             String @id @default(cuid())
  userId         String
  organisationId String

  reason      String?
  requestedAt DateTime @default(now())

  status      String    @default("PENDING")
  approvedAt  DateTime?
  completedAt DateTime?

  verificationToken  String?   @unique
  verificationSentAt DateTime?

  dataCategories String[]
  retainedData   String[]

  organisation Organisation @relation(fields: [organisationId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([requestedAt])
  @@map("data_deletion_requests")
}

// ============================================================================
// üèÉ PLAYER MODELS
// ============================================================================

model Player {
  id     String @id @default(cuid())
  userId String @unique

  height            Float?
  weight            Float?
  dateOfBirth       DateTime?
  nationality       String?
  secondNationality String?

  jerseyNumber      Int?
  preferredFoot     PreferredFoot?
  primaryPosition   Position?
  secondaryPosition Position?
  tertiaryPosition  Position?

  marketValue      Float?
  valueLastUpdated DateTime?
  currency         String    @default("GBP")

  isActive            Boolean @default(true)
  isVerified          Boolean @default(false)
  hasCompletedProfile Boolean @default(false)
  isAcademy           Boolean @default(false)
  isYouth             Boolean @default(false)
  youthCategory       String?

  overallRating    Float?    @default(0)
  formRating       Float?    @default(0)
  developmentPhase String?
  fitnessLevel     Float?
  injuryStatus     String?
  lastFitnessTest  DateTime?

  availabilityStatus String @default("AVAILABLE")

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user               User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  statistics         PlayerStatistic[]
  aggregateStats     PlayerAggregateStats?
  analytics          PlayerAnalytic?       @relation("playerAnalytics")
  insights           PlayerInsight?        @relation("playerInsights")
  contracts          Contract[]
  injuries           Injury[]
  medicalRecords     MedicalRecord[]
  matchAttendance    MatchAttendance[]
  familyLinks        PlayerFamily[]
  scoutingReports    ScoutingReport[]
  highlights         PlayerHighlight[]
  badges             Badge[]               @relation("badgePlayer")
  achievements       Achievement[]         @relation("achievementPlayer")
  transfers          Transfer[]
  availabilityWindow PlayerAvailability[]
  performanceGoals   PerformanceGoal[]     @relation("goalPlayer")
  trainingAttendance TrainingAttendance[]
  teamPlayers        TeamPlayer[]
  joinRequests       TeamJoinRequest[]     @relation("playerJoinRequests")

  @@index([userId])
  @@index([isActive])
  @@index([isVerified])
  @@index([primaryPosition])
  @@index([marketValue])
  @@index([createdAt])
  @@index([availabilityStatus])
  @@map("players")
}

model PlayerStatistic {
  id       String  @id @default(cuid())
  playerId String
  season   Int
  teamId   String?
  leagueId String?

  matches       Int @default(0)
  starts        Int @default(0)
  minutesPlayed Int @default(0)
  goals         Int @default(0)
  assists       Int @default(0)
  ownGoals      Int @default(0)

  yellowCards   Int @default(0)
  secondYellows Int @default(0)
  redCards      Int @default(0)
  foulsCommited Int @default(0)
  foulsSuffered Int @default(0)

  passes          Int    @default(0)
  passAccuracy    Float?
  keyPasses       Int    @default(0)
  tackles         Int    @default(0)
  tackleSuccess   Float?
  interceptions   Int    @default(0)
  clearances      Int    @default(0)
  blocks          Int    @default(0)
  aerialDuelsWon  Int    @default(0)
  aerialDuelsLost Int    @default(0)

  shots         Int    @default(0)
  shotsOnTarget Int    @default(0)
  shotAccuracy  Float?

  cleanSheets   Int    @default(0)
  saves         Int    @default(0)
  savePercent   Float?
  goalsConceded Int    @default(0)
  penaltySaves  Int    @default(0)

  dribbles        Int    @default(0)
  dribbleSuccess  Float?
  crossesAttempt  Int    @default(0)
  crossesComplete Int    @default(0)

  sportSpecificStats Json?

  averageRating Float?
  highestRating Float?
  lowestRating  Float?

  lastUpdated DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([playerId, season, teamId, leagueId])
  @@index([playerId])
  @@index([season])
  @@index([teamId])
  @@index([leagueId])
  @@map("player_statistics")
}

model PlayerAggregateStats {
  id       String @id @default(cuid())
  playerId String @unique

  totalMatches     Int @default(0)
  totalStarts      Int @default(0)
  totalGoals       Int @default(0)
  totalAssists     Int @default(0)
  totalMinutes     Int @default(0)
  totalYellowCards Int @default(0)
  totalRedCards    Int @default(0)
  totalCleanSheets Int @default(0)

  avgGoalsPerMatch   Float @default(0)
  avgAssistsPerMatch Float @default(0)
  avgMinutesPerMatch Float @default(0)
  avgRating          Float @default(0)

  seasonGoals   Int @default(0)
  seasonAssists Int @default(0)
  seasonMatches Int @default(0)

  formGoals   Int    @default(0)
  formAssists Int    @default(0)
  formRating  Float?

  positionRank Int?
  leagueRank   Int?
  clubRank     Int?

  milestone100Matches DateTime?
  milestone50Goals    DateTime?
  milestone100Goals   DateTime?

  lastUpdatedAt DateTime @default(now())
  refreshedAt   DateTime @default(now())

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([lastUpdatedAt])
  @@map("player_aggregate_stats")
}

model PlayerAnalytic {
  id       String @id @default(cuid())
  playerId String @unique

  overallRating        Float @default(0)
  formRating           Float @default(0)
  consistencyIndex     Float @default(0)
  injuryRisk           Float @default(0)
  developmentPotential Float @default(0)
  fatigueLevelEstimate Float @default(0)
  workRateIndex        Float @default(0)

  positionRank Int?
  leagueRank   Int?
  globalRank   Int?
  ageGroupRank Int?

  weeklyTrend  Float?
  monthlyTrend Float?
  seasonTrend  Float?

  lastMatchRating  Float?
  last5MatchesAvg  Float?
  last10MatchesAvg Float?
  seasonAverage    Float?

  predictions          Json?
  predictionConfidence Float?

  expectedGoals       Float?
  expectedAssists     Float?
  passCompletionTrend Float?
  pressureIndex       Float?
  tacticalAwareness   Float?

  strengths        String[]
  weaknesses       String[]
  developmentAreas String[]
  recommendations  String?   @db.Text
  lastAnalysisDate DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation("playerAnalytics", fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([overallRating])
  @@index([injuryRisk])
  @@index([formRating])
  @@map("player_analytics")
}

model PlayerInsight {
  id       String @id @default(cuid())
  playerId String @unique

  strengths         String[]
  weaknesses        String[]
  developmentAreas  String[]
  playingStyle      String?
  strongFoot        String?
  comparablePlayers String[]

  pace                 Int?
  shooting             Int?
  passing              Int?
  dribbling            Int?
  defending            Int?
  physical             Int?
  aggressiveness       Int?
  defensiveAbility     Int?
  leadership           Int?
  teamwork             Int?
  situationalAwareness Int?
  composure            Int?
  creativity           Int?
  workRate             Int?

  determination Int?
  concentration Int?
  decisions     Int?
  anticipation  Int?
  vision        Int?

  recommendations String?   @db.Text
  careerAdvice    String?   @db.Text
  lastReviewDate  DateTime?
  reviewedBy      String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation("playerInsights", fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@map("player_insights")
}

model PlayerFamily {
  id           String  @id @default(cuid())
  playerId     String
  parentId     String?
  guardianId   String?
  relationship String

  isEmergencyContact Boolean @default(false)
  phone              String?
  email              String?

  canViewMedical Boolean @default(false)
  canSignForms   Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([parentId])
  @@map("player_family")
}

model PlayerHighlight {
  id       String  @id @default(cuid())
  playerId String
  matchId  String?

  title         String
  description   String? @db.Text
  videoUrl      String?
  thumbnailUrl  String?
  duration      Int?
  highlightType String

  processingStatus TranscodingStatus @default(PENDING)

  viewCount Int @default(0)
  likeCount Int @default(0)

  isPublic   Boolean @default(true)
  isFeatured Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([matchId])
  @@index([isFeatured])
  @@map("player_highlights")
}

model PlayerAvailability {
  id       String @id @default(cuid())
  playerId String

  startDate DateTime
  endDate   DateTime

  reason String
  status MatchAttendanceStatus

  notes String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([startDate, endDate])
  @@map("player_availability")
}

model Injury {
  id       String @id @default(cuid())
  playerId String

  type     String
  severity InjurySeverity @default(MINOR)
  location String

  dateFrom        DateTime
  dateTo          DateTime?
  estimatedReturn DateTime?
  actualReturn    DateTime?

  description String?      @db.Text
  treatment   String?
  therapist   String?
  status      InjuryStatus @default(ACTIVE)

  diagnosedBy String?
  facility    String?
  scans       String[]
  notes       String? @db.Text

  recoveryProgress Int?
  lastAssessment   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([dateFrom])
  @@index([status])
  @@index([severity])
  @@map("injuries")
}

model MedicalRecord {
  id       String @id @default(cuid())
  playerId String

  recordType String
  date       DateTime

  results     Json?
  notes       String?  @db.Text
  provider    String?
  facility    String?
  attachments String[]

  isClearanceRecord Boolean @default(false)
  clearanceStatus   String?
  clearanceExpiry   DateTime?

  isConfidential   Boolean @default(true)
  accessRestricted Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([recordType])
  @@index([date])
  @@map("medical_records")
}

model Contract {
  id       String  @id @default(cuid())
  playerId String
  clubId   String?

  position Position

  salary           Float?
  currency         String @default("GBP")
  bonusStructure   Json?
  performanceBonus Float?
  signOnBonus      Float?
  loyaltyBonus     Float?
  appearanceFee    Float?
  goalBonus        Float?

  startDate DateTime
  endDate   DateTime?

  contractType     String  @default("PROFESSIONAL")
  status           String  @default("ACTIVE")
  contractDocument String?

  extensionOption Boolean   @default(false)
  extensionDate   DateTime?
  extensionYears  Int?
  buyoutClause    Float?
  releaseClause   Float?
  matchingRights  Boolean   @default(false)

  imageRightsPercent Float?

  agentName       String?
  agentEmail      String?
  agentPhone      String?
  agentCommission Float?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([clubId])
  @@index([status])
  @@index([endDate])
  @@map("contracts")
}

model Transfer {
  id String @id @default(cuid())

  playerId   String
  fromClubId String?
  toClubId   String?
  seasonId   String?

  type   TransferType
  status TransferStatus @default(PENDING)

  fee           Float?
  feeType       String   @default("FIXED")
  currency      String   @default("GBP")
  addOns        Json?
  sellOnPercent Float?
  installments  Json?
  agentFee      Float?

  loanFee          Float?
  wageContribution Float?
  buyOption        Float?
  buyObligation    Float?
  recallClause     Boolean @default(false)

  announcedAt   DateTime?
  completedAt   DateTime?
  effectiveDate DateTime
  loanEndDate   DateTime?

  medicalPassed  Boolean   @default(false)
  medicalDate    DateTime?
  contractSigned Boolean   @default(false)
  contractDate   DateTime?

  notes String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player  @relation(fields: [playerId], references: [id], onDelete: Cascade)
  season Season? @relation(fields: [seasonId], references: [id], onDelete: SetNull)

  @@index([playerId])
  @@index([fromClubId])
  @@index([toClubId])
  @@index([status])
  @@index([effectiveDate])
  @@map("transfers")
}

// ============================================================================
// üèÜ COACH MODELS
// ============================================================================

model Coach {
  id     String @id @default(cuid())
  userId String @unique

  coachType       String   @default("HEAD_COACH")
  specialization  String[]
  certifications  String[]
  yearsExperience Int?
  qualifications  String[] @db.Text
  bio             String?  @db.Text

  hourlyRate   Float?
  dailyRate    Float?
  currency     String  @default("GBP")
  bankDetails  Json?
  taxId        String?
  contractType String?

  isVerified            Boolean   @default(false)
  verificationDate      DateTime?
  licenseNumber         String?   @unique
  licenseExpiry         DateTime?
  backgroundCheckExpiry DateTime?
  dbsCheckNumber        String?
  dbsCheckExpiry        DateTime?
  safeguardingExpiry    DateTime?
  firstAidExpiry        DateTime?

  overallRating       Float? @default(0)
  totalPlayersCoached Int    @default(0)
  successRate         Float?
  matchesManaged      Int    @default(0)
  winRate             Float?

  isAvailable       Boolean @default(true)
  availabilityNotes String?

  // Job Seeking Fields
  isOpenToOpportunities   Boolean  @default(false)
  preferredRoles          String[]
  preferredLocations      String[]
  expectedSalary          Float?
  expectedSalaryCurrency  String   @default("GBP")
  noticePeriod            String?

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user             User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  clubMemberships  ClubMember[]      @relation("coachMemberships")
  trainingSessions TrainingSession[]
  timesheets       CoachTimesheet[]  @relation("coach")
  payments         CoachPayment[]
  achievements     Achievement[]     @relation("achievementCoach")
  jobApplications  JobApplication[]  @relation("coachApplications")

  @@index([userId])
  @@index([isVerified])
  @@index([coachType])
  @@index([licenseExpiry])
  @@index([isOpenToOpportunities])
  @@map("coaches")
}

model CoachTimesheet {
  id      String  @id @default(cuid())
  coachId String
  clubId  String?

  weekStartDate DateTime
  weekEndDate   DateTime

  totalHours Float   @default(0)
  hourlyRate Float?
  hourlyCost Float?
  totalCost  Float?

  description String?  @db.Text
  attachments String[]

  breakdown Json?

  status          TimesheetStatus @default(DRAFT)
  submittedAt     DateTime?
  approvedAt      DateTime?
  approvedBy      String?
  rejectionReason String?
  paidAt          DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  coach Coach @relation("coach", fields: [coachId], references: [id], onDelete: Cascade)

  @@index([coachId])
  @@index([clubId])
  @@index([status])
  @@index([weekStartDate])
  @@map("coach_timesheets")
}

model CoachPayment {
  id      String @id @default(cuid())
  coachId String

  amount        Float
  currency      String   @default("GBP")
  paymentDate   DateTime
  paymentMethod String

  invoiceNumber String? @unique
  reference     String?
  timesheetId   String?

  status      PaymentStatus @default(PENDING)
  description String?

  taxAmount Float?
  netAmount Float?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  coach Coach @relation(fields: [coachId], references: [id], onDelete: Cascade)

  @@index([coachId])
  @@index([status])
  @@index([paymentDate])
  @@map("coach_payments")
}

// ============================================================================
// ü§ù OTHER STAFF MODELS
// ============================================================================

model Referee {
  id     String @id @default(cuid())
  userId String @unique

  licenseNumber     String?  @unique
  licenseLevel      String?
  yearsOfExperience Int?
  specialization    String[]

  certificationDate     DateTime?
  certificationExpiry   DateTime?
  backgroundCheckExpiry DateTime?
  fitnessTestDate       DateTime?
  fitnessTestExpiry     DateTime?

  assignedMatches Int     @default(0)
  isVerified      Boolean @default(false)
  isActive        Boolean @default(true)

  averageRating Float?
  totalReviews  Int   @default(0)

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  matchOfficials MatchOfficial[]

  @@index([userId])
  @@index([isVerified])
  @@index([licenseLevel])
  @@map("referees")
}

model Scout {
  id     String @id @default(cuid())
  userId String @unique

  specialization  String[]
  region          String?
  regions         String[]
  yearsExperience Int?
  focusAgeGroup   String?
  focusPositions  Position[]

  isVerified Boolean @default(false)
  isActive   Boolean @default(true)

  playersRecommended Int @default(0)
  playersSigned      Int @default(0)

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  scoutingReports ScoutingReport[]

  @@index([userId])
  @@index([isVerified])
  @@index([region])
  @@map("scouts")
}

model Analyst {
  id     String @id @default(cuid())
  userId String @unique

  specialization  String[]
  tools           String[]
  yearsExperience Int?

  isVerified Boolean @default(false)
  isActive   Boolean @default(true)

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isVerified])
  @@map("analysts")
}

model ClubManager {
  id     String @id @default(cuid())
  userId String @unique

  managingStyle   String?
  yearsExperience Int?

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("club_managers")
}

model ClubOwner {
  id     String @id @default(cuid())
  userId String @unique

  businessType    String?
  yearsInBusiness Int?

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("club_owners")
}

model Parent {
  id     String @id @default(cuid())
  userId String @unique

  childrenCount Int @default(0)

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("parents")
}

model Treasurer {
  id     String @id @default(cuid())
  userId String @unique

  yearsExperience Int?
  bankDetails     Json?
  qualifications  String[]

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("treasurers")
}

// ============================================================================
// üè¢ CLUB & TEAM MODELS
// ============================================================================

model Club {
  id             String  @id @default(cuid())
  organisationId String?
  name           String
  slug           String  @unique
  shortName      String?
  description    String? @db.Text
  logo           String?
  banner         String?
  website        String?
  email          String?
  phone          String?
  foundedYear    Int?

  city          String?
  state         String?
  country       String?
  address       String?
  postcode      String?
  venue         String?
  venueCapacity Int?
  coordinates   Json?

  sport    Sport
  teamType TeamType @default(AMATEUR)

  managerId String
  ownerId   String?

  primaryColor   String?
  secondaryColor String?

  isVerified       Boolean @default(false)
  isPublic         Boolean @default(true)
  acceptingPlayers Boolean @default(true)
  acceptingStaff   Boolean @default(true)
  status           String  @default("ACTIVE")

  followerCount Int @default(0)
  joinedMembers Int @default(0)

  twitter   String?
  facebook  String?
  instagram String?
  youtube   String?
  tiktok    String?

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organisation     Organisation?       @relation(fields: [organisationId], references: [id], onDelete: SetNull)
  manager          User                @relation("clubManager", fields: [managerId], references: [id])
  owner            User?               @relation("clubOwner", fields: [ownerId], references: [id])
  members          ClubMember[]
  teams            Team[]
  leagues          League[]
  formations       TeamFormation[]
  tactics          Tactic[]
  trainingSessions TrainingSession[]
  homeMatches      Match[]             @relation("homeTeam")
  awayMatches      Match[]             @relation("awayTeam")
  aggregateStats   TeamAggregateStats?
  announcements    Announcement[]
  sponsors         ClubSponsor[]
  jobPostings      JobPosting[]

  @@index([organisationId])
  @@index([managerId])
  @@index([ownerId])
  @@index([sport])
  @@index([isPublic])
  @@index([city])
  @@index([country])
  @@index([status])
  @@index([acceptingPlayers])
  @@index([acceptingStaff])
  @@map("clubs")
}

model ClubMember {
  id      String  @id @default(cuid())
  userId  String
  clubId  String
  coachId String?

  role ClubMemberRole @default(STAFF)

  joinedAt  DateTime  @default(now())
  leftAt    DateTime?
  isActive  Boolean   @default(true)
  isCaptain Boolean   @default(false)

  salary      Float?
  currency    String    @default("GBP")
  contractEnd DateTime?

  canManageRoster  Boolean @default(false)
  canManageMatches Boolean @default(false)
  canManageBilling Boolean @default(false)

  deletedAt DateTime?

  user  User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  club  Club   @relation(fields: [clubId], references: [id], onDelete: Cascade)
  coach Coach? @relation("coachMemberships", fields: [coachId], references: [id], onDelete: SetNull)

  @@unique([userId, clubId])
  @@index([userId])
  @@index([clubId])
  @@index([coachId])
  @@index([role])
  @@index([isActive])
  @@map("club_members")
}

model Team {
  id     String @id @default(cuid())
  clubId String

  name        String
  description String? @db.Text
  logo        String?
  ageGroup    String?
  gender      String?
  status      String  @default("ACTIVE")

  minPlayers Int?
  maxPlayers Int?

  // Team preferences for join requests
  acceptingJoinRequests Boolean @default(true)
  requiresApproval      Boolean @default(true)

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club         Club              @relation(fields: [clubId], references: [id], onDelete: Cascade)
  players      TeamPlayer[]
  matchSquads  MatchSquad[]
  formations   TeamFormation[]
  leagueTeams  LeagueTeam[]
  joinRequests TeamJoinRequest[]

  @@unique([clubId, name])
  @@index([clubId])
  @@index([ageGroup])
  @@index([status])
  @@index([acceptingJoinRequests])
  @@map("teams")
}

model TeamPlayer {
  id       String @id @default(cuid())
  teamId   String
  playerId String

  position      Position?
  jerseyNumber  Int?
  isActive      Boolean   @default(true)
  isCaptain     Boolean   @default(false)
  isViceCaptain Boolean   @default(false)

  joinedAt DateTime  @default(now())
  leftAt   DateTime?

  // Track how player joined
  joinedVia     String? // 'DIRECT', 'JOIN_REQUEST', 'INVITATION', 'TRANSFER'
  joinRequestId String?

  team   Team   @relation(fields: [teamId], references: [id], onDelete: Cascade)
  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([teamId, playerId])
  @@index([teamId])
  @@index([playerId])
  @@index([isActive])
  @@map("team_players")
}

model TeamFormation {
  id     String  @id @default(cuid())
  clubId String
  teamId String?

  name        String?
  formation   FormationType @default(FOUR_FOUR_TWO)
  description String?
  diagram     Json?

  positions Json?

  isDefault Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club Club  @relation(fields: [clubId], references: [id], onDelete: Cascade)
  team Team? @relation(fields: [teamId], references: [id], onDelete: SetNull)

  @@index([clubId])
  @@index([teamId])
  @@map("team_formations")
}

// ============================================================================
// üìù TEAM JOIN REQUESTS - NEW v7.2.0
// ============================================================================

model TeamJoinRequest {
  id       String @id @default(cuid())
  teamId   String
  playerId String

  // Request details
  status                JoinRequestStatus @default(PENDING)
  message               String?           @db.Text
  preferredPosition     Position?
  preferredJerseyNumber Int?

  // Player profile snapshot at time of request
  playerProfileSnapshot Json?

  // Review information
  reviewedBy      String?
  reviewedAt      DateTime?
  reviewNotes     String?   @db.Text
  rejectionReason String?

  // Expiry
  expiresAt DateTime?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  team   Team   @relation(fields: [teamId], references: [id], onDelete: Cascade)
  player Player @relation("playerJoinRequests", fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([teamId, playerId, status])
  @@index([teamId])
  @@index([playerId])
  @@index([status])
  @@index([createdAt])
  @@index([expiresAt])
  @@map("team_join_requests")
}

// ============================================================================
// üíº JOB POSTING & APPLICATION SYSTEM - NEW v7.2.0
// ============================================================================

model JobPosting {
  id     String @id @default(cuid())
  clubId String

  // Job details
  title            String
  slug             String
  description      String  @db.Text
  shortDescription String?

  // Classification
  category        JobCategory
  role            ClubMemberRole
  employmentType  EmploymentType  @default(FULL_TIME)
  experienceLevel ExperienceLevel @default(MID)

  // Requirements
  requirements    String[]
  qualifications  String[]
  certifications  String[]
  skills          String[]
  yearsExperience Int?

  // Compensation
  salaryMin      Float?
  salaryMax      Float?
  currency       String   @default("GBP")
  salaryPeriod   String?
  benefits       String[]
  bonusStructure Json?

  // Location
  location       String?
  city           String?
  country        String?
  isRemote       Boolean @default(false)
  isHybrid       Boolean @default(false)
  travelRequired Boolean @default(false)

  // Status & Dates
  status      JobPostingStatus @default(DRAFT)
  publishedAt DateTime?
  deadline    DateTime?
  startDate   DateTime?

  // Settings
  isUrgent       Boolean @default(false)
  isFeatured     Boolean @default(false)
  isConfidential Boolean @default(false)

  // Application settings
  maxApplications     Int?
  requiresCoverLetter Boolean @default(true)
  requiresResume      Boolean @default(true)
  customQuestions     Json?

  // Metrics
  viewCount        Int @default(0)
  applicationCount Int @default(0)
  shortlistedCount Int @default(0)

  // Creator
  createdBy String

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  club         Club             @relation(fields: [clubId], references: [id], onDelete: Cascade)
  creator      User             @relation("jobCreator", fields: [createdBy], references: [id])
  applications JobApplication[]

  @@unique([clubId, slug])
  @@index([clubId])
  @@index([category])
  @@index([role])
  @@index([status])
  @@index([publishedAt])
  @@index([deadline])
  @@index([city])
  @@index([country])
  @@index([isRemote])
  @@index([isFeatured])
  @@index([createdAt])
  @@map("job_postings")
}

model JobApplication {
  id           String  @id @default(cuid())
  jobPostingId String
  userId       String
  coachId      String?

  // Application content
  coverLetter   String? @db.Text
  resumeUrl     String?
  portfolioUrl  String?
  linkedInUrl   String?
  customAnswers Json?

  // Applicant snapshot
  applicantSnapshot Json?

  // Status tracking
  status JobApplicationStatus @default(PENDING)

  // Review process
  reviewedBy  String?
  reviewedAt  DateTime?
  reviewNotes String?   @db.Text
  rating      Int?

  // Interview
  interviewDate     DateTime?
  interviewLocation String?
  interviewNotes    String?   @db.Text
  interviewRating   Int?

  // Offer
  offerDate          DateTime?
  offerSalary        Float?
  offerAcceptedAt    DateTime?
  offerDeclinedAt    DateTime?
  offerDeclineReason String?

  // Rejection
  rejectionReason String?
  rejectionDate   DateTime?

  // Withdrawal
  withdrawnAt    DateTime?
  withdrawReason String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  jobPosting JobPosting @relation(fields: [jobPostingId], references: [id], onDelete: Cascade)
  user       User       @relation("applicant", fields: [userId], references: [id], onDelete: Cascade)
  coach      Coach?     @relation("coachApplications", fields: [coachId], references: [id], onDelete: SetNull)
  reviewer   User?      @relation("applicationReviewer", fields: [reviewedBy], references: [id], onDelete: SetNull)

  @@unique([jobPostingId, userId])
  @@index([jobPostingId])
  @@index([userId])
  @@index([coachId])
  @@index([status])
  @@index([createdAt])
  @@index([rating])
  @@map("job_applications")
}

// ============================================================================
// üèÜ LEAGUE & COMPETITION MODELS
// ============================================================================

model League {
  id       String  @id @default(cuid())
  clubId   String
  seasonId String?

  name        String
  description String? @db.Text
  season      Int

  startDate            DateTime
  endDate              DateTime?
  registrationDeadline DateTime?

  format     LeagueFormat     @default(ROUND_ROBIN)
  visibility LeagueVisibility @default(PRIVATE)
  status     String           @default("DRAFT")

  maxTeams        Int?
  teamsRegistered Int  @default(0)

  tiebreakers String[] @default(["GOAL_DIFFERENCE", "GOALS_FOR", "HEAD_TO_HEAD"])

  pointsForWin  Int @default(3)
  pointsForDraw Int @default(1)
  pointsForLoss Int @default(0)

  logo  String?
  rules String? @db.Text

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club           Club                  @relation(fields: [clubId], references: [id], onDelete: Cascade)
  seasonRef      Season?               @relation(fields: [seasonId], references: [id], onDelete: SetNull)
  teams          LeagueTeam[]
  matches        Match[]
  standings      LeagueStanding[]
  aggregateStats LeagueAggregateStats?
  brackets       TournamentBracket[]

  @@index([clubId])
  @@index([seasonId])
  @@index([status])
  @@index([startDate])
  @@map("leagues")
}

model LeagueTeam {
  id       String @id @default(cuid())
  leagueId String
  teamId   String

  joinedAt   DateTime  @default(now())
  leftAt     DateTime?
  isActive   Boolean   @default(true)
  seedNumber Int?

  league League @relation(fields: [leagueId], references: [id], onDelete: Cascade)
  team   Team   @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([leagueId, teamId])
  @@index([leagueId])
  @@index([teamId])
  @@map("league_teams")
}

model LeagueStanding {
  id       String  @id @default(cuid())
  leagueId String
  teamId   String?

  position       Int
  played         Int @default(0)
  wins           Int @default(0)
  draws          Int @default(0)
  losses         Int @default(0)
  goalsFor       Int @default(0)
  goalsAgainst   Int @default(0)
  goalDifference Int @default(0)
  points         Int @default(0)

  form String?

  homeWins   Int @default(0)
  homeDraws  Int @default(0)
  homeLosses Int @default(0)
  awayWins   Int @default(0)
  awayDraws  Int @default(0)
  awayLosses Int @default(0)

  updatedAt DateTime @updatedAt

  league League @relation(fields: [leagueId], references: [id], onDelete: Cascade)

  @@unique([leagueId, teamId])
  @@index([leagueId])
  @@index([position])
  @@map("league_standings")
}

model LeagueAggregateStats {
  id       String @id @default(cuid())
  leagueId String @unique

  totalMatches        Int   @default(0)
  completedMatches    Int   @default(0)
  totalGoals          Int   @default(0)
  avgGoalsPerMatch    Float @default(0)
  homeWins            Int   @default(0)
  awayWins            Int   @default(0)
  draws               Int   @default(0)
  totalYellowCards    Int   @default(0)
  totalRedCards       Int   @default(0)
  biggestWin          Json?
  highestScoringMatch Json?

  lastUpdatedAt DateTime @default(now())

  league League @relation(fields: [leagueId], references: [id], onDelete: Cascade)

  @@index([leagueId])
  @@map("league_aggregate_stats")
}

model TournamentBracket {
  id       String @id @default(cuid())
  leagueId String

  round    Int
  position Int
  matchId  String?

  homeTeamId String?
  awayTeamId String?
  homeScore  Int?
  awayScore  Int?
  winnerId   String?

  homeSourceBracketId String?
  awaySourceBracketId String?

  scheduledAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  league League @relation(fields: [leagueId], references: [id], onDelete: Cascade)

  @@unique([leagueId, round, position])
  @@index([leagueId])
  @@index([round])
  @@map("tournament_brackets")
}

// ============================================================================
// ‚öΩ MATCH & EVENT MODELS
// ============================================================================

model Match {
  id         String  @id @default(cuid())
  leagueId   String?
  homeClubId String
  awayClubId String

  title       String?
  description String? @db.Text

  kickOffTime DateTime
  status      MatchStatus @default(SCHEDULED)

  venue   String?
  venueId String?
  pitch   String?

  weather     String?
  temperature Int?

  homeScore         Int?
  awayScore         Int?
  homeHalftimeScore Int?
  awayHalftimeScore Int?
  homePenalties     Int?
  awayPenalties     Int?

  homeExtraTimeScore Int?
  awayExtraTimeScore Int?

  attendance Int?
  capacity   Int?

  actualDuration   Int?
  injuryTimeFirst  Int?
  injuryTimeSecond Int?

  resultApprovalStatus ResultApprovalStatus @default(PENDING)
  approvedBy           String?
  approvedAt           DateTime?
  disputeReason        String?

  isHighlighted  Boolean @default(false)
  isFeatured     Boolean @default(false)
  isNeutralVenue Boolean @default(false)

  isBroadcasted Boolean @default(false)
  broadcastUrl  String?

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  league           League?           @relation(fields: [leagueId], references: [id], onDelete: SetNull)
  homeTeam         Club              @relation("homeTeam", fields: [homeClubId], references: [id])
  awayTeam         Club              @relation("awayTeam", fields: [awayClubId], references: [id])
  events           MatchEvent[]
  squads           MatchSquad[]
  playerAttendance MatchAttendance[]
  stats            MatchStat[]
  officials        MatchOfficial[]

  @@index([leagueId])
  @@index([homeClubId])
  @@index([awayClubId])
  @@index([status])
  @@index([kickOffTime])
  @@index([resultApprovalStatus])
  @@map("matches")
}

model MatchOfficial {
  id        String @id @default(cuid())
  matchId   String
  refereeId String

  role MatchOfficialRole

  performanceRating Float?
  notes             String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  match   Match   @relation(fields: [matchId], references: [id], onDelete: Cascade)
  referee Referee @relation(fields: [refereeId], references: [id], onDelete: Cascade)

  @@unique([matchId, role])
  @@index([matchId])
  @@index([refereeId])
  @@map("match_officials")
}

model MatchEvent {
  id       String  @id @default(cuid())
  matchId  String
  playerId String?

  eventType       MatchEventType
  minute          Int
  secondaryMinute Int?
  period          String?

  relatedPlayerId String?
  assistPlayerId  String?
  goalType        String?
  cardReason      String?

  details        Json?
  videoTimestamp Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  match Match @relation(fields: [matchId], references: [id], onDelete: Cascade)

  @@index([matchId])
  @@index([eventType])
  @@index([playerId])
  @@index([minute])
  @@map("match_events")
}

model MatchSquad {
  id       String  @id @default(cuid())
  matchId  String
  teamId   String
  playerId String?

  lineupPosition Int?
  shirtNumber    Int?

  status MatchAttendanceStatus @default(NOT_SELECTED)

  substituteOrder Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  match Match @relation(fields: [matchId], references: [id], onDelete: Cascade)
  team  Team  @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@index([matchId])
  @@index([teamId])
  @@index([playerId])
  @@map("match_squads")
}

model MatchAttendance {
  id       String @id @default(cuid())
  matchId  String
  playerId String

  status          MatchAttendanceStatus @default(AVAILABLE)
  notesFromPlayer String?
  responseDate    DateTime?

  minutesPlayed Int?
  rating        Float?

  goals       Int     @default(0)
  assists     Int     @default(0)
  yellowCards Int     @default(0)
  redCard     Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  match  Match  @relation(fields: [matchId], references: [id], onDelete: Cascade)
  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([matchId, playerId])
  @@index([matchId])
  @@index([playerId])
  @@index([status])
  @@map("match_attendance")
}

model MatchStat {
  id       String  @id @default(cuid())
  matchId  String
  playerId String?
  teamId   String?

  goals         Int @default(0)
  assists       Int @default(0)
  minutesPlayed Int @default(0)

  passes         Int    @default(0)
  passesComplete Int    @default(0)
  passAccuracy   Float?
  keyPasses      Int    @default(0)
  longBalls      Int    @default(0)
  throughBalls   Int    @default(0)

  tackles       Int @default(0)
  interceptions Int @default(0)
  clearances    Int @default(0)
  blocks        Int @default(0)

  shots         Int @default(0)
  shotsOnTarget Int @default(0)
  dribbles      Int @default(0)
  crosses       Int @default(0)

  fouls       Int @default(0)
  fouled      Int @default(0)
  yellowCards Int @default(0)
  redCards    Int @default(0)

  saves         Int     @default(0)
  goalsConceded Int     @default(0)
  cleanSheet    Boolean @default(false)

  aerialsWon  Int @default(0)
  aerialsLost Int @default(0)

  touches    Int    @default(0)
  possession Float?

  rating Float?

  customStats Json?

  updatedAt DateTime @updatedAt

  match Match @relation(fields: [matchId], references: [id], onDelete: Cascade)

  @@unique([matchId, playerId, teamId])
  @@index([matchId])
  @@index([playerId])
  @@index([teamId])
  @@map("match_stats")
}

// ============================================================================
// üìä TRAINING MODELS
// ============================================================================

model TrainingSession {
  id      String @id @default(cuid())
  clubId  String
  coachId String

  name        String
  description String? @db.Text

  startTime DateTime
  endTime   DateTime

  intensity TrainingIntensity @default(MEDIUM)
  category  TrainingCategory

  location        String?
  facilityId      String?
  maxParticipants Int?

  drills    Json?
  notes     String? @db.Text
  equipment String[]

  status String @default("SCHEDULED")

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club       Club                 @relation(fields: [clubId], references: [id], onDelete: Cascade)
  coach      Coach                @relation(fields: [coachId], references: [id], onDelete: Cascade)
  attendance TrainingAttendance[]

  @@index([clubId])
  @@index([coachId])
  @@index([startTime])
  @@index([status])
  @@map("training_sessions")
}

model TrainingAttendance {
  id        String @id @default(cuid())
  sessionId String
  playerId  String

  status      AttendanceStatus @default(PRESENT)
  arrivalTime DateTime?
  notes       String?

  performanceRating Float?
  effortRating      Float?
  coachNotes        String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  session TrainingSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  player  Player          @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([sessionId, playerId])
  @@index([sessionId])
  @@index([playerId])
  @@index([status])
  @@map("training_attendance")
}

model ScoutingReport {
  id       String @id @default(cuid())
  scoutId  String
  playerId String

  rating       Float?
  observations String? @db.Text

  technicalRating Float?
  tacticalRating  Float?
  physicalRating  Float?
  mentalRating    Float?

  recommendation String?
  urgency        String?
  suggestedValue Float?
  currency       String  @default("GBP")

  matchWatched String?
  matchDate    DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  scout  Scout  @relation(fields: [scoutId], references: [id], onDelete: Cascade)
  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([scoutId])
  @@index([playerId])
  @@index([recommendation])
  @@map("scouting_reports")
}

model Tactic {
  id     String @id @default(cuid())
  clubId String

  name        String
  description String? @db.Text
  diagram     Json?
  formation   FormationType?

  defendingStyle  String?
  attackingStyle  String?
  pressingTrigger String?
  buildUpPlay     String?

  corners   Json?
  freeKicks Json?
  throwIns  Json?

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club Club @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@index([clubId])
  @@index([isActive])
  @@map("tactics")
}

model TeamAggregateStats {
  id     String @id @default(cuid())
  clubId String @unique

  totalMatches      Int @default(0)
  totalWins         Int @default(0)
  totalDraws        Int @default(0)
  totalLosses       Int @default(0)
  totalGoalsFor     Int @default(0)
  totalGoalsAgainst Int @default(0)
  winRate           Float?

  homeMatches Int @default(0)
  homeWins    Int @default(0)
  homeDraws   Int @default(0)
  homeLosses  Int @default(0)

  awayMatches Int @default(0)
  awayWins    Int @default(0)
  awayDraws   Int @default(0)
  awayLosses  Int @default(0)

  currentStreak     Int     @default(0)
  streakType        String?
  longestWinStreak  Int     @default(0)
  longestLossStreak Int     @default(0)

  cleanSheets Int @default(0)

  lastUpdatedAt DateTime @default(now())

  club Club @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@index([clubId])
  @@map("team_aggregate_stats")
}

model PerformanceGoal {
  id String @id @default(cuid())

  userId   String?
  playerId String?

  type        GoalType
  title       String
  description String?  @db.Text

  targetValue  Float?
  currentValue Float?
  unit         String?

  startDate DateTime
  endDate   DateTime
  status    GoalStatus @default(NOT_STARTED)

  progress   Int   @default(0)
  milestones Json?

  reviewedAt DateTime?
  reviewedBy String?
  feedback   String?   @db.Text

  createdBy String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user    User?   @relation("goalUser", fields: [userId], references: [id], onDelete: Cascade)
  player  Player? @relation("goalPlayer", fields: [playerId], references: [id], onDelete: Cascade)
  creator User    @relation("goalCreator", fields: [createdBy], references: [id])

  @@index([userId])
  @@index([playerId])
  @@index([status])
  @@index([type])
  @@map("performance_goals")
}

// ============================================================================
// üèüÔ∏è FACILITY MANAGEMENT
// ============================================================================

model Facility {
  id             String @id @default(cuid())
  organisationId String

  name        String
  type        FacilityType
  description String?      @db.Text

  address     String?
  city        String?
  postcode    String?
  country     String?
  coordinates Json?

  capacity Int?

  isActive       Boolean @default(true)
  operatingHours Json?

  amenities String[]
  images    String[]

  contactName  String?
  contactPhone String?
  contactEmail String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organisation Organisation      @relation(fields: [organisationId], references: [id], onDelete: Cascade)
  bookings     FacilityBooking[]

  @@index([organisationId])
  @@index([type])
  @@index([isActive])
  @@map("facilities")
}

model FacilityBooking {
  id         String @id @default(cuid())
  facilityId String

  startTime DateTime
  endTime   DateTime

  purpose     String
  description String?
  bookedBy    String

  status BookingStatus @default(PENDING)

  isRecurring     Boolean @default(false)
  recurrenceRule  String?
  parentBookingId String?

  cost     Float?
  currency String  @default("GBP")
  paid     Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  facility Facility @relation(fields: [facilityId], references: [id], onDelete: Cascade)

  @@index([facilityId])
  @@index([startTime, endTime])
  @@index([status])
  @@index([bookedBy])
  @@map("facility_bookings")
}

// ============================================================================
// üì¢ ANNOUNCEMENTS
// ============================================================================

model Announcement {
  id     String @id @default(cuid())
  clubId String

  title   String
  content String  @db.Text
  excerpt String?

  priority AnnouncementPriority @default(NORMAL)
  status   AnnouncementStatus   @default(DRAFT)

  publishAt DateTime?
  expiresAt DateTime?

  targetRoles   ClubMemberRole[]
  targetTeamIds String[]
  isPublic      Boolean          @default(false)

  attachments String[]
  imageUrl    String?

  viewCount Int @default(0)

  authorId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club   Club @relation(fields: [clubId], references: [id], onDelete: Cascade)
  author User @relation("announcementCreator", fields: [authorId], references: [id])

  @@index([clubId])
  @@index([status])
  @@index([publishAt])
  @@index([priority])
  @@map("announcements")
}

// ============================================================================
// üí∞ BILLING & SUBSCRIPTION MODELS
// ============================================================================

model Subscription {
  id             String  @id @default(cuid())
  userId         String?
  organisationId String?

  stripeSubscriptionId String? @unique
  stripeCustomerId     String?
  stripePriceId        String?

  status SubscriptionStatus @default(ACTIVE)
  tier   AccountTier        @default(FREE)

  currentPeriodStart DateTime
  currentPeriodEnd   DateTime

  trialStart DateTime?
  trialEnd   DateTime?

  cancelledAt       DateTime?
  cancelledReason   String?
  cancelAtPeriodEnd Boolean   @default(false)

  usageLimit   Int?
  usageCurrent Int  @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user         User?         @relation(fields: [userId], references: [id], onDelete: Cascade)
  organisation Organisation? @relation(fields: [organisationId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([organisationId])
  @@index([status])
  @@index([currentPeriodEnd])
  @@map("subscriptions")
}

model Payment {
  id     String  @id @default(cuid())
  userId String?

  amount   Float
  currency String @default("GBP")

  status PaymentStatus @default(PENDING)
  type   PaymentType   @default(SUBSCRIPTION)

  stripePaymentIntentId String? @unique
  stripeChargeId        String?

  description String?
  metadata    Json?

  refundedAmount Float?
  refundedAt     DateTime?
  refundReason   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([status])
  @@index([type])
  @@index([createdAt])
  @@map("payments")
}

model Invoice {
  id     String @id @default(cuid())
  userId String

  invoiceNumber String @unique
  amount        Float
  tax           Float?
  total         Float
  currency      String @default("GBP")

  issuedAt DateTime
  dueAt    DateTime
  paidAt   DateTime?

  status String @default("ISSUED")

  lineItems Json?

  pdfUrl          String?
  stripeInvoiceId String?

  remindersSent Int       @default(0)
  lastReminder  DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([dueAt])
  @@index([invoiceNumber])
  @@map("invoices")
}

// ============================================================================
// ü§ù SPONSORS
// ============================================================================

model Sponsor {
  id             String @id @default(cuid())
  organisationId String

  name        String
  logo        String?
  website     String?
  description String? @db.Text

  contactName  String?
  contactEmail String?
  contactPhone String?

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organisation Organisation  @relation(fields: [organisationId], references: [id], onDelete: Cascade)
  clubSponsors ClubSponsor[]

  @@index([organisationId])
  @@index([isActive])
  @@map("sponsors")
}

model ClubSponsor {
  id        String @id @default(cuid())
  clubId    String
  sponsorId String

  type      String
  value     Float?
  currency  String    @default("GBP")
  startDate DateTime
  endDate   DateTime?

  deliverables Json?

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club    Club    @relation(fields: [clubId], references: [id], onDelete: Cascade)
  sponsor Sponsor @relation(fields: [sponsorId], references: [id], onDelete: Cascade)

  @@unique([clubId, sponsorId, type])
  @@index([clubId])
  @@index([sponsorId])
  @@map("club_sponsors")
}

// ============================================================================
// üì± NOTIFICATIONS & MESSAGING
// ============================================================================

model Notification {
  id     String @id @default(cuid())
  userId String

  title   String
  message String @db.Text
  type    String

  read   Boolean   @default(false)
  readAt DateTime?

  link     String?
  metadata Json?

  emailSent Boolean @default(false)
  pushSent  Boolean @default(false)

  scheduledFor DateTime?

  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([read])
  @@index([type])
  @@index([createdAt])
  @@map("notifications")
}

model NotificationPreference {
  id     String @id @default(cuid())
  userId String @unique

  emailMatches   Boolean @default(true)
  emailTeam      Boolean @default(true)
  emailCoach     Boolean @default(true)
  emailTraining  Boolean @default(true)
  emailNews      Boolean @default(false)
  emailMarketing Boolean @default(false)
  emailJobs      Boolean @default(true)

  pushMatches  Boolean @default(true)
  pushTeam     Boolean @default(true)
  pushTraining Boolean @default(true)
  pushChat     Boolean @default(true)
  pushJobs     Boolean @default(true)

  smsMatches Boolean @default(false)
  smsUrgent  Boolean @default(false)

  quietHoursStart String?
  quietHoursEnd   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("notification_preferences")
}

// ============================================================================
// üí¨ CHAT SYSTEM
// ============================================================================

model Chat {
  id String @id @default(cuid())

  type ChatType @default(DIRECT)
  name String?

  teamId String?
  clubId String?

  isArchived Boolean @default(false)
  isMuted    Boolean @default(false)

  lastMessageAt      DateTime?
  lastMessagePreview String?

  createdBy String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  creator  User         @relation("chatCreator", fields: [createdBy], references: [id])
  members  ChatMember[]
  messages Message[]

  @@index([type])
  @@index([teamId])
  @@index([clubId])
  @@index([lastMessageAt])
  @@map("chats")
}

model Message {
  id       String @id @default(cuid())
  senderId String
  chatId   String

  content String @db.Text

  attachments Json?

  readBy   String[]  @default([])
  editedAt DateTime?

  replyToId String?

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sender User @relation(fields: [senderId], references: [id], onDelete: Cascade)
  chat   Chat @relation(fields: [chatId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([chatId])
  @@index([createdAt])
  @@map("messages")
}

model ChatMember {
  id     String @id @default(cuid())
  userId String
  chatId String

  role     String    @default("MEMBER")
  joinedAt DateTime  @default(now())
  leftAt   DateTime?

  isMuted     Boolean   @default(false)
  lastReadAt  DateTime?
  unreadCount Int       @default(0)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  chat Chat @relation(fields: [chatId], references: [id], onDelete: Cascade)

  @@unique([userId, chatId])
  @@index([userId])
  @@index([chatId])
  @@map("chat_members")
}

// ============================================================================
// üë• SOCIAL & GAMIFICATION
// ============================================================================

model Follow {
  id          String @id @default(cuid())
  followerId  String
  followingId String

  createdAt DateTime @default(now())

  follower  User @relation("follower", fields: [followerId], references: [id], onDelete: Cascade)
  following User @relation("following", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
  @@map("follows")
}

model UserBlock {
  id        String @id @default(cuid())
  blockerId String
  blockedId String

  reason String?

  createdAt DateTime @default(now())

  blocker User @relation("blocker", fields: [blockerId], references: [id], onDelete: Cascade)
  blocked User @relation("blocked", fields: [blockedId], references: [id], onDelete: Cascade)

  @@unique([blockerId, blockedId])
  @@index([blockerId])
  @@map("user_blocks")
}

model SocialAction {
  id     String @id @default(cuid())
  userId String

  type         String
  resourceId   String
  resourceType String

  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, type, resourceId, resourceType])
  @@index([userId])
  @@index([resourceType, resourceId])
  @@map("social_actions")
}

model Achievement {
  id String @id @default(cuid())

  userId   String?
  playerId String?
  coachId  String?

  type        String
  title       String
  description String? @db.Text
  icon        String?

  progress Int     @default(100)
  tier     String?

  unlockedAt DateTime @default(now())

  user   User?   @relation("achievementUser", fields: [userId], references: [id], onDelete: Cascade)
  player Player? @relation("achievementPlayer", fields: [playerId], references: [id], onDelete: Cascade)
  coach  Coach?  @relation("achievementCoach", fields: [coachId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([playerId])
  @@index([coachId])
  @@index([type])
  @@map("achievements")
}

model Badge {
  id String @id @default(cuid())

  userId   String?
  playerId String?

  name        String
  description String?
  icon        String?
  category    String?

  rarity String @default("COMMON")

  awardedAt DateTime @default(now())

  user   User?   @relation("badgeUser", fields: [userId], references: [id], onDelete: Cascade)
  player Player? @relation("badgePlayer", fields: [playerId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([playerId])
  @@index([category])
  @@map("badges")
}

// ============================================================================
// üìπ MEDIA ASSETS
// ============================================================================

model MediaAsset {
  id             String @id @default(cuid())
  organisationId String

  type     String
  filename String
  url      String
  mimeType String

  width  Int?
  height Int?

  sizeBytes Int

  duration           Int?
  thumbnailUrl       String?
  processingStatus   TranscodingStatus?
  processingProvider VideoProcessingProvider?

  alt         String?
  description String?
  tags        String[]

  usageCount Int @default(0)

  createdBy String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organisation Organisation @relation(fields: [organisationId], references: [id], onDelete: Cascade)

  @@index([organisationId])
  @@index([type])
  @@index([createdAt])
  @@map("media_assets")
}

// ============================================================================
// üîå API & INTEGRATIONS
// ============================================================================

model Webhook {
  id             String @id @default(cuid())
  organisationId String

  name   String?
  event  WebhookEvent
  url    String

  isActive Boolean @default(true)
  secret   String?

  headers Json?

  maxRetries   Int @default(3)
  retryDelayMs Int @default(1000)

  failureCount  Int       @default(0)
  lastFailedAt  DateTime?
  lastSuccessAt DateTime?
  lastError     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organisation Organisation      @relation(fields: [organisationId], references: [id], onDelete: Cascade)
  deliveries   WebhookDelivery[]

  @@index([organisationId])
  @@index([event])
  @@index([isActive])
  @@map("webhooks")
}

model WebhookDelivery {
  id        String @id @default(cuid())
  webhookId String

  event    WebhookEvent
  payload  Json
  response Json?

  statusCode   Int?
  success      Boolean
  errorMessage String?
  durationMs   Int?

  attemptNumber Int @default(1)

  createdAt DateTime @default(now())

  webhook Webhook @relation(fields: [webhookId], references: [id], onDelete: Cascade)

  @@index([webhookId])
  @@index([success])
  @@index([createdAt])
  @@map("webhook_deliveries")
}

model ApiUsageMetrics {
  id             String @id @default(cuid())
  organisationId String

  date DateTime @db.Date

  callsCount          Int    @default(0)
  averageResponseTime Float?
  errorCount          Int    @default(0)
  bandwidthBytes      BigInt @default(0)

  endpointBreakdown Json?

  updatedAt DateTime @updatedAt

  organisation Organisation @relation(fields: [organisationId], references: [id], onDelete: Cascade)

  @@unique([organisationId, date])
  @@index([organisationId])
  @@index([date])
  @@map("api_usage_metrics")
}

model QuotaUsage {
  id             String @id @default(cuid())
  organisationId String

  usersUsed             Int @default(0)
  teamsUsed             Int @default(0)
  storageUsedMb         Int @default(0)
  apiCallsUsedThisMonth Int @default(0)
  matchesThisMonth      Int @default(0)

  monthlyResetDate DateTime?

  updatedAt DateTime @updatedAt

  organisation Organisation @relation(fields: [organisationId], references: [id], onDelete: Cascade)

  @@index([organisationId])
  @@map("quota_usage")
}

// ============================================================================
// üîÑ BACKUP & MAINTENANCE
// ============================================================================

model DatabaseBackup {
  id             String @id @default(cuid())
  organisationId String

  type   String @default("FULL")
  size   Int
  status String @default("COMPLETED")

  backupUrl String?
  checksum  String?
  expiresAt DateTime

  tablesIncluded String[]
  rowsCaptured   Int?

  createdAt DateTime @default(now())

  organisation Organisation @relation(fields: [organisationId], references: [id], onDelete: Cascade)

  @@index([organisationId])
  @@index([expiresAt])
  @@index([status])
  @@map("database_backups")
}
