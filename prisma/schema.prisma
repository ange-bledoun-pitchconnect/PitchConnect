// ============================================================================
// üèÜ PITCHCONNECT DATABASE SCHEMA v7.4.0 - ENTERPRISE EDITION
// ============================================================================
// 
// Version History:
// - v7.0.0: Initial enterprise schema
// - v7.1.0: Added Two-Factor Auth, Password Reset, Email Verification
// - v7.2.0: Added Team Join Requests, Job Posting System
// - v7.3.0: Added MediaContent, Hybrid Training, Enhanced Attendance
// - v7.4.0: MAJOR UPDATE - Competition System, Match Enhancements, Multi-Sport
//
// ============================================================================
// NEW IN v7.4.0:
// ============================================================================
//
// üèüÔ∏è MATCH SYSTEM OVERHAUL:
//   - MatchType enum (13 types: LEAGUE, CUP, FRIENDLY, PLAYOFF, etc.)
//   - Optional competition linking (standalone friendlies supported)
//   - Both Team AND Club relations on Match (inter/intra-club support)
//   - homeFormation/awayFormation tactical tracking
//   - homeScoreBreakdown/awayScoreBreakdown for multi-sport scoring
//   - createdById + createdByCoachId for permission tracking
//   - 16 comprehensive MatchStatus values
//
// üèÜ COMPETITION SYSTEM:
//   - New Competition model (replaces League for flexibility)
//   - CompetitionType enum (LEAGUE, CUP, TOURNAMENT, FRIENDLY_SERIES, etc.)
//   - CompetitionStage for knockout/group tracking
//   - Supports organization-wide, cross-club, and internal competitions
//
// üèüÔ∏è VENUE MANAGEMENT:
//   - New Venue model (external match venues)
//   - Facility model retained (club-owned facilities)
//   - Match links to both via venueId OR facilityId
//
// üìä PLAYER PERFORMANCE:
//   - New PlayerMatchPerformance model (clean separation)
//   - Ratings, stats, coach notes, sport-specific metrics
//   - Replaces stats in MatchAttendance
//
// üîí DATA INTEGRITY:
//   - Soft deletes (deletedAt) on ALL major entities
//   - Comprehensive indexing strategy
//   - GDPR compliance fields
//   - Audit trail integration
//
// üèà MULTI-SPORT SUPPORT:
//   - 12 sports with sport-specific scoring
//   - Score breakdown JSON for tries, conversions, touchdowns, etc.
//   - Sport-specific event types (80+ events)
//   - Position and formation enums per sport
//
// ============================================================================
// MIGRATION NOTES:
// ============================================================================
// 
// BREAKING CHANGES from v7.3.0:
// 1. Match.leagueId ‚Üí Match.competitionId (migration required)
// 2. League model enhanced ‚Üí Competition model (data migration)
// 3. MatchAttendance stats ‚Üí PlayerMatchPerformance (data migration)
// 4. New required fields: Match.homeTeamId, Match.awayTeamId
//
// RECOMMENDED MIGRATION ORDER:
// 1. Create new enums (MatchType, CompetitionType, etc.)
// 2. Create Venue model
// 3. Create Competition model
// 4. Create PlayerMatchPerformance model
// 5. Add new Match fields (homeTeamId, awayTeamId, etc.)
// 6. Migrate League ‚Üí Competition data
// 7. Add soft delete fields
// 8. Run index creation
//
// ============================================================================

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch", "views", "postgresqlExtensions"]
  binaryTargets   = ["native", "rhel-openssl-1.0.x", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  directUrl  = env("DIRECT_URL")
  extensions = [citext]
}

// ============================================================================
// üìã ENUMS - USER & AUTHENTICATION
// ============================================================================

enum UserRole {
  SUPERADMIN
  ADMIN
  PLAYER
  PLAYER_PRO
  COACH
  COACH_PRO
  MANAGER
  CLUB_MANAGER
  CLUB_OWNER
  TREASURER
  REFEREE
  SCOUT
  ANALYST
  PARENT
  GUARDIAN
  LEAGUE_ADMIN
  MEDICAL_STAFF
  MEDIA_MANAGER
  FAN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  BANNED
  PENDING_VERIFICATION
  PENDING_EMAIL_VERIFICATION
  PENDING_PHONE_VERIFICATION
  PENDING_APPROVAL
  ARCHIVED
  DELETED
}

enum UserType {
  INDIVIDUAL
  ORGANIZATION
  FAMILY
}

enum AccountTier {
  FREE
  PRO
  PREMIUM
  ENTERPRISE
}

enum OrganisationRole {
  OWNER
  ADMIN
  MANAGER
  MEMBER
  VIEWER
}

enum OrganisationTier {
  STARTER
  PROFESSIONAL
  ENTERPRISE
  CUSTOM
}

enum VerificationType {
  EMAIL
  PHONE
  PASSWORD_RESET
  TWO_FACTOR
  ACCOUNT_RECOVERY
}

// ============================================================================
// üìã ENUMS - PERMISSIONS & DATA GOVERNANCE
// ============================================================================

enum PermissionType {
  // User Management
  USER_CREATE
  USER_READ
  USER_UPDATE
  USER_DELETE
  USER_SUSPEND
  USER_BAN
  
  // Team Management
  TEAM_CREATE
  TEAM_READ
  TEAM_UPDATE
  TEAM_DELETE
  TEAM_INVITE
  TEAM_REMOVE_MEMBER
  
  // Match Management
  MATCH_CREATE
  MATCH_READ
  MATCH_UPDATE
  MATCH_DELETE
  MATCH_PUBLISH
  MATCH_APPROVE_RESULT
  MATCH_RECORD_STATS
  MATCH_MANAGE_LINEUP
  MATCH_RECORD_EVENTS
  
  // Competition Management (NEW v7.4.0)
  COMPETITION_CREATE
  COMPETITION_READ
  COMPETITION_UPDATE
  COMPETITION_DELETE
  COMPETITION_MANAGE_TEAMS
  
  // Player Management
  PLAYER_CREATE
  PLAYER_READ
  PLAYER_UPDATE
  PLAYER_DELETE
  PLAYER_VERIFY
  PLAYER_TRANSFER
  
  // Medical
  MEDICAL_READ
  MEDICAL_CREATE
  MEDICAL_UPDATE
  
  // Billing
  BILLING_READ
  BILLING_UPDATE
  BILLING_MANAGE_SUBSCRIPTIONS
  
  // Analytics
  ANALYTICS_VIEW
  ANALYTICS_EXPORT
  
  // API
  API_ACCESS
  API_KEY_CREATE
  API_KEY_REVOKE
  
  // Facilities & Venues (NEW v7.4.0)
  FACILITY_MANAGE
  FACILITY_BOOK
  VENUE_CREATE
  VENUE_UPDATE
  
  // System
  SYSTEM_ADMIN
  AUDIT_LOG_VIEW
  
  // Media
  MEDIA_UPLOAD
  MEDIA_DELETE
  MEDIA_MANAGE
}

enum DataRetentionPolicy {
  EPHEMERAL    // Delete after session
  TEMPORARY    // Delete after 30 days
  STANDARD     // Delete after 2 years
  PERMANENT    // Never auto-delete
  DELETED      // Marked for deletion
}

enum AuditActionType {
  // User Lifecycle
  USER_CREATED
  USER_UPDATED
  USER_DELETED
  USER_SUSPENDED
  USER_BANNED
  USER_REACTIVATED
  ROLE_ASSIGNED
  ROLE_REMOVED
  
  // Authentication
  USER_REGISTERED
  USER_LOGIN
  USER_LOGOUT
  LOGIN_FAILED
  LOGIN_LOCKED
  EMAIL_VERIFIED
  PHONE_VERIFIED
  PASSWORD_CHANGED
  PASSWORD_RESET_REQUESTED
  PASSWORD_RESET_COMPLETED
  TWO_FACTOR_ENABLED
  TWO_FACTOR_DISABLED
  TWO_FACTOR_VERIFIED
  TWO_FACTOR_BACKUP_USED
  
  // Session
  SESSION_CREATED
  SESSION_REVOKED
  SESSION_EXPIRED
  VERIFICATION_EMAIL_SENT
  VERIFICATION_EMAIL_RESENT
  
  // Subscription & Payment
  SUBSCRIPTION_GRANTED
  SUBSCRIPTION_UPGRADED
  SUBSCRIPTION_DOWNGRADED
  SUBSCRIPTION_CANCELLED
  PAYMENT_PROCESSED
  PAYMENT_FAILED
  REFUND_PROCESSED
  
  // Data Operations
  DATA_EXPORTED
  DATA_DELETED
  DATA_IMPORTED
  
  // Team & Club
  TEAM_CREATED
  TEAM_UPDATED
  TEAM_DELETED
  CLUB_CREATED
  CLUB_UPDATED
  CLUB_DELETED
  
  // Match Operations (ENHANCED v7.4.0)
  MATCH_CREATED
  MATCH_UPDATED
  MATCH_RESULT_UPDATED
  MATCH_CANCELLED
  MATCH_LINEUP_SET
  MATCH_EVENT_RECORDED
  MATCH_STATUS_CHANGED
  
  // Competition Operations (NEW v7.4.0)
  COMPETITION_CREATED
  COMPETITION_UPDATED
  COMPETITION_DELETED
  COMPETITION_TEAM_ADDED
  COMPETITION_TEAM_REMOVED
  
  // Player Operations
  PLAYER_TRANSFER
  PLAYER_CONTRACT_SIGNED
  PLAYER_PERFORMANCE_RECORDED
  
  // Medical
  MEDICAL_RECORD_ACCESSED
  MEDICAL_RECORD_CREATED
  
  // Join Requests & Jobs
  JOIN_REQUEST_SUBMITTED
  JOIN_REQUEST_APPROVED
  JOIN_REQUEST_REJECTED
  JOIN_REQUEST_CANCELLED
  JOB_POSTED
  JOB_CLOSED
  JOB_APPLICATION_SUBMITTED
  JOB_APPLICATION_REVIEWED
  JOB_APPLICATION_ACCEPTED
  JOB_APPLICATION_REJECTED
  
  // Training
  TRAINING_CREATED
  TRAINING_UPDATED
  TRAINING_CANCELLED
  
  // Media
  MEDIA_UPLOADED
  MEDIA_DELETED
  MEDIA_SHARED
  
  // Compliance
  CONSENT_UPDATED
  GDPR_REQUEST
  DATA_RETENTION_APPLIED
  
  // System
  SYSTEM_MAINTENANCE
  API_KEY_GENERATED
  API_KEY_REVOKED
  SUSPICIOUS_LOGIN
  SECURITY_ALERT
}

// ============================================================================
// üìã ENUMS - SPORT & POSITION
// ============================================================================

enum Sport {
  FOOTBALL
  NETBALL
  RUGBY
  CRICKET
  AMERICAN_FOOTBALL
  BASKETBALL
  HOCKEY
  LACROSSE
  AUSTRALIAN_RULES
  GAELIC_FOOTBALL
  FUTSAL
  BEACH_FOOTBALL
}

enum Position {
  // ========================
  // FOOTBALL (SOCCER)
  // ========================
  GOALKEEPER
  LEFT_BACK
  CENTER_BACK
  RIGHT_BACK
  LEFT_WING_BACK
  RIGHT_WING_BACK
  DEFENSIVE_MIDFIELDER
  CENTRAL_MIDFIELDER
  LEFT_MIDFIELDER
  RIGHT_MIDFIELDER
  ATTACKING_MIDFIELDER
  LEFT_WINGER
  RIGHT_WINGER
  STRIKER
  CENTER_FORWARD
  SECOND_STRIKER

  // ========================
  // NETBALL
  // ========================
  GOALKEEPER_NETBALL
  GOAL_ATTACK
  WING_ATTACK
  CENTER
  WING_DEFENSE
  GOAL_DEFENSE
  GOAL_SHOOTER

  // ========================
  // RUGBY UNION
  // ========================
  PROP
  HOOKER
  LOCK
  FLANKER
  NUMBER_8
  SCRUM_HALF
  FLY_HALF
  INSIDE_CENTER
  OUTSIDE_CENTER
  FULLBACK

  // ========================
  // RUGBY LEAGUE
  // ========================
  HOOKER_LEAGUE
  PROP_LEAGUE
  SECOND_ROW
  LOOSE_FORWARD

  // ========================
  // AMERICAN FOOTBALL
  // ========================
  QUARTERBACK
  RUNNING_BACK
  WIDE_RECEIVER
  TIGHT_END
  LEFT_TACKLE
  LEFT_GUARD
  CENTER_POSITION
  RIGHT_GUARD
  RIGHT_TACKLE
  LINEBACKER
  DEFENSIVE_END
  DEFENSIVE_TACKLE
  SAFETY
  CORNERBACK
  PUNTER
  KICKER

  // ========================
  // BASKETBALL
  // ========================
  POINT_GUARD
  SHOOTING_GUARD
  SMALL_FORWARD
  POWER_FORWARD
  CENTER_BASKETBALL

  // ========================
  // CRICKET
  // ========================
  BATSMAN
  BOWLER
  ALL_ROUNDER
  FIELDER
  WICKET_KEEPER

  // ========================
  // HOCKEY
  // ========================
  GOALTENDER
  DEFENSEMAN
  WINGER
  CENTER_HOCKEY

  // ========================
  // GENERIC / MULTI-SPORT
  // ========================
  UTILITY
  SUBSTITUTE
}

enum PreferredFoot {
  LEFT
  RIGHT
  BOTH
}

enum FormationType {
  // ========================
  // FOOTBALL (SOCCER)
  // ========================
  FOUR_FOUR_TWO
  FOUR_THREE_THREE
  THREE_FIVE_TWO
  FIVE_THREE_TWO
  FIVE_FOUR_ONE
  THREE_FOUR_THREE
  FOUR_TWO_THREE_ONE
  FOUR_ONE_FOUR_ONE
  THREE_THREE_FOUR
  FIVE_TWO_THREE
  TWO_THREE_FIVE
  FOUR_ONE_TWO_THREE
  FOUR_FOUR_ONE_ONE
  FOUR_THREE_TWO_ONE
  FOUR_FIVE_ONE

  // ========================
  // BASKETBALL
  // ========================
  ONE_THREE_ONE
  TWO_THREE
  TWO_ONE_TWO
  THREE_TWO
  ONE_TWO_TWO

  // ========================
  // AMERICAN FOOTBALL
  // ========================
  I_FORMATION
  SHOTGUN
  PISTOL
  SPREAD
  SINGLE_BACK
  PRO_SET
  WILDCAT

  // ========================
  // RUGBY
  // ========================
  PODS
  DIAMOND
  FLAT_LINE

  // ========================
  // GENERIC
  // ========================
  CUSTOM
}

// ============================================================================
// üìã ENUMS - MATCH & COMPETITION (ENHANCED v7.4.0)
// ============================================================================

// NEW v7.4.0: Match type categorization
enum MatchType {
  LEAGUE           // Regular season league match
  CUP              // Cup/knockout competition
  FRIENDLY         // Non-competitive friendly match
  PLAYOFF          // Post-season playoff match
  TOURNAMENT       // Tournament match
  QUALIFIER        // Qualifying round match
  FINAL            // Championship final
  SEMI_FINAL       // Semi-final match
  QUARTER_FINAL    // Quarter-final match
  GROUP_STAGE      // Group stage match
  TRAINING_MATCH   // Training/practice match
  PRACTICE         // Practice session match
  EXHIBITION       // Exhibition/showcase match
}

// Comprehensive match status
enum MatchStatus {
  SCHEDULED
  WARMUP
  LIVE
  HALFTIME
  SECOND_HALF
  EXTRA_TIME_FIRST
  EXTRA_TIME_SECOND
  PENALTIES
  FINISHED
  CANCELLED
  POSTPONED
  ABANDONED
  REPLAY_SCHEDULED
  VOIDED
  DELAYED
  SUSPENDED
}

// NEW v7.4.0: Competition type
enum CompetitionType {
  LEAGUE                 // Round-robin league
  CUP                    // Knockout cup
  TOURNAMENT             // Multi-stage tournament
  FRIENDLY_SERIES        // Series of friendly matches
  SUPER_CUP              // One-off super cup
  PLAYOFF                // Post-season playoffs
  QUALIFIER              // Qualification competition
  CHAMPIONSHIP           // Championship tournament
  INVITATIONAL           // Invitation-only event
}

// NEW v7.4.0: Competition stage for knockout/group tracking
enum CompetitionStage {
  GROUP_STAGE
  ROUND_OF_32
  ROUND_OF_16
  QUARTER_FINAL
  SEMI_FINAL
  THIRD_PLACE
  FINAL
  PRELIMINARY
  FIRST_ROUND
  SECOND_ROUND
  PLAYOFF_ROUND
}

enum LeagueFormat {
  ROUND_ROBIN
  DOUBLE_ROUND_ROBIN
  KNOCKOUT
  GROUP_KNOCKOUT
  ROUND_ROBIN_WITH_PLAYOFFS
  SWISS_SYSTEM
  LADDER_SYSTEM
  HOME_AND_AWAY
  CUSTOM
}

enum LeagueVisibility {
  PUBLIC
  PRIVATE
  UNLISTED
  INVITE_ONLY
  FRIENDS_ONLY
}

enum ResultApprovalStatus {
  PENDING
  APPROVED
  REJECTED
  DISPUTED
  REQUIRES_REVISION
  UNDER_REVIEW
  AUTO_APPROVED
}

enum MatchAttendanceStatus {
  AVAILABLE
  UNAVAILABLE
  CONFIRMED
  MAYBE
  LATE
  NO_SHOW
  EXCUSED_ABSENCE
  INJURED
  ILL
  SUSPENDED
  NOT_SELECTED
  SUBSTITUTE
  STARTING_LINEUP
  ATTENDED
  UNUSED_SUB
  UNUSED_SQUAD
  INTERNATIONAL_DUTY
  LOAN
}

// ============================================================================
// üìã ENUMS - MATCH EVENTS (80+ EVENT TYPES)
// ============================================================================

enum MatchEventType {
  // ========================
  // FOOTBALL (SOCCER)
  // ========================
  GOAL
  ASSIST
  YELLOW_CARD
  SECOND_YELLOW
  RED_CARD
  SUBSTITUTION_ON
  SUBSTITUTION_OFF
  INJURY
  INJURY_TIME
  FULLTIME
  HALFTIME
  KICKOFF
  PENALTY_SCORED
  PENALTY_MISSED
  PENALTY_SAVED
  OWN_GOAL
  VAR_REVIEW
  VAR_DECISION
  OFFSIDE
  FOUL
  FREE_KICK
  CORNER
  THROW_IN
  GOAL_KICK

  // ========================
  // GENERAL EVENTS
  // ========================
  CHALLENGE_REVIEW
  TIMEOUT
  INTERCEPT
  REBOUND
  CAPTAIN_CHANGE
  WEATHER_DELAY
  FLOODLIGHT_FAILURE
  PERIOD_START
  PERIOD_END
  OVERTIME_START
  SHOOTOUT_START

  // ========================
  // NETBALL
  // ========================
  CENTER_PASS
  OBSTRUCTION
  CONTACT
  HELD_BALL
  STEPPING
  OVER_THIRD

  // ========================
  // RUGBY
  // ========================
  TRY
  CONVERSION
  PENALTY_GOAL
  DROP_GOAL
  SCRUM
  LINEOUT
  MAUL
  RUCK
  KNOCK_ON
  HIGH_TACKLE
  SIN_BIN
  YELLOW_CARD_RUGBY
  RED_CARD_RUGBY

  // ========================
  // CRICKET
  // ========================
  WICKET
  BOUNDARY
  SIX
  MAIDEN_OVER
  WIDE
  NO_BALL
  BYE
  LEG_BYE
  OVERTHROW
  RUN_OUT
  CAUGHT
  BOWLED
  LBW
  STUMPED

  // ========================
  // BASKETBALL
  // ========================
  THREE_POINTER
  TWO_POINTER
  FREE_THROW_MADE
  FREE_THROW_MISSED
  FAST_BREAK
  TURNOVER
  OFFENSIVE_FOUL
  DEFENSIVE_FOUL
  TRAVEL
  DOUBLE_DRIBBLE
  BLOCK
  STEAL
  DUNK
  ALLEY_OOP

  // ========================
  // AMERICAN FOOTBALL
  // ========================
  TOUCHDOWN
  FIELD_GOAL
  SAFETY_SCORE
  INTERCEPTION
  FUMBLE
  SACK
  TWO_POINT_CONVERSION
  EXTRA_POINT
  PUNT
  KICKOFF_RETURN
  FAIR_CATCH

  // ========================
  // HOCKEY
  // ========================
  HAT_TRICK
  MAJOR_PENALTY
  MINOR_PENALTY
  FIGHT
  POWER_PLAY_GOAL
  SHORTHANDED_GOAL
  EMPTY_NET_GOAL

  // ========================
  // AUSTRALIAN RULES
  // ========================
  BEHIND
  RUSHED_BEHIND
  MARK
  HANDBALL
  BOUNCE
}

// ============================================================================
// üìã ENUMS - CLUB & TEAM
// ============================================================================

enum ClubMemberRole {
  OWNER
  MANAGER
  HEAD_COACH
  ASSISTANT_COACH
  PLAYER
  STAFF
  TREASURER
  SCOUT
  ANALYST
  MEDICAL_STAFF
  PHYSIOTHERAPIST
  NUTRITIONIST
  PSYCHOLOGIST
  PERFORMANCE_COACH
  GOALKEEPING_COACH
  KIT_MANAGER
  MEDIA_OFFICER
  VIDEO_ANALYST
}

enum TeamType {
  PROFESSIONAL
  SEMI_PROFESSIONAL
  AMATEUR
  ACADEMY
  YOUTH
  RECREATIONAL
  UNIVERSITY
  SCHOOL
}

enum TeamStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  ARCHIVED
  DISSOLVED
}

// ============================================================================
// üìã ENUMS - TRAINING
// ============================================================================

enum TrainingIntensity {
  RECOVERY
  LOW
  MEDIUM
  HIGH
  MAXIMUM
  COMPETITIVE
}

enum TrainingCategory {
  // Technical Skills
  PASSING
  SHOOTING
  DEFENDING
  POSSESSION
  SET_PIECES
  DRIBBLING

  // Physical
  CONDITIONING
  STRENGTH_POWER
  SPEED_AGILITY
  FLEXIBILITY
  BALANCE_COORDINATION
  ENDURANCE

  // Tactical
  TACTICAL
  FORMATION_WORK
  GAME_STRATEGY
  TRANSITIONS

  // Recovery & Mental
  RECOVERY
  MENTAL_PREPARATION
  VIDEO_ANALYSIS
  TEAM_BUILDING

  // Position Specific
  GOALKEEPER_SPECIFIC
  POSITION_SPECIFIC

  // Sport-Specific
  SPORT_SPECIFIC

  // Generic
  WARM_UP
  COOL_DOWN
  SCRIMMAGE
  MATCH_SIMULATION
  INDIVIDUAL_TRAINING
  GROUP_TRAINING
}

enum TrainingStatus {
  DRAFT
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  POSTPONED
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  EXCUSED
  LATE
  LEFT_EARLY
  PARTIAL
  INJURED
  SICK
  SUSPENDED
}

// ============================================================================
// üìã ENUMS - MEDIA
// ============================================================================

enum MediaType {
  VIDEO
  IMAGE
  DOCUMENT
  AUDIO
}

enum MediaCategory {
  // Match Related
  MATCH_HIGHLIGHT
  MATCH_FULL
  MATCH_ANALYSIS
  GOAL_CLIP
  SAVE_CLIP
  INCIDENT_CLIP

  // Training Related
  TRAINING_SESSION
  TRAINING_DRILL
  TRAINING_EXERCISE
  TRAINING_ANALYSIS

  // Player Related
  PLAYER_HIGHLIGHT
  PLAYER_INTERVIEW
  PLAYER_PROFILE

  // Team Related
  TEAM_PROMO
  TEAM_ANNOUNCEMENT
  PRESS_CONFERENCE

  // Documents
  TACTICS_DOCUMENT
  MEDICAL_DOCUMENT
  CONTRACT_DOCUMENT
  REPORT

  // General
  THUMBNAIL
  PROFILE_PHOTO
  BANNER
  LOGO
  OTHER
}

enum MediaVisibility {
  PUBLIC
  CLUB_ONLY
  TEAM_ONLY
  STAFF_ONLY
  PRIVATE
}

enum MediaProcessingStatus {
  PENDING
  UPLOADING
  PROCESSING
  TRANSCODING
  COMPLETED
  FAILED
  CANCELLED
}

enum VideoQuality {
  Q_360P
  Q_480P
  Q_720P
  Q_1080P
  Q_2K
  Q_4K
  ORIGINAL
}

enum TranscodingStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  CANCELLED
  QUEUED
}

enum VideoProcessingProvider {
  MUX
  AWS_MEDIACONVERT
  BUNNY_CDN
  CLOUDINARY
  INTERNAL
  VERCEL_BLOB
}

// ============================================================================
// üìã ENUMS - HR & JOBS
// ============================================================================

enum TimesheetStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
  PAID
  DISPUTED
  ARCHIVED
}

enum JoinRequestStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
  EXPIRED
  WITHDRAWN
}

enum JobPostingStatus {
  DRAFT
  OPEN
  PAUSED
  CLOSED
  FILLED
  CANCELLED
  EXPIRED
}

enum JobApplicationStatus {
  PENDING
  REVIEWING
  SHORTLISTED
  INTERVIEW_SCHEDULED
  INTERVIEW_COMPLETED
  OFFERED
  ACCEPTED
  REJECTED
  WITHDRAWN
  HIRED
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  TEMPORARY
  INTERNSHIP
  VOLUNTEER
  FREELANCE
  SEASONAL
}

enum JobCategory {
  COACHING
  MANAGEMENT
  MEDICAL
  ANALYSIS
  SCOUTING
  ADMINISTRATION
  MEDIA
  OPERATIONS
  FINANCE
  YOUTH_DEVELOPMENT
  PERFORMANCE
  OTHER
}

enum ExperienceLevel {
  ENTRY
  JUNIOR
  MID
  SENIOR
  LEAD
  DIRECTOR
  EXECUTIVE
}

// ============================================================================
// üìã ENUMS - TRANSFERS & MEDICAL
// ============================================================================

enum TransferType {
  PERMANENT
  LOAN
  FREE_TRANSFER
  YOUTH_DEVELOPMENT
  TRIAL
  EXCHANGE
}

enum TransferStatus {
  PENDING
  NEGOTIATING
  AGREED
  COMPLETED
  CANCELLED
  REJECTED
  EXPIRED
}

enum InjurySeverity {
  MINOR
  MODERATE
  SEVERE
  CRITICAL
  CAREER_THREATENING
}

enum InjuryStatus {
  ACTIVE
  RECOVERING
  REHABILITATION
  CLEARED
  CHRONIC
}

// ============================================================================
// üìã ENUMS - FACILITIES & VENUES (ENHANCED v7.4.0)
// ============================================================================

enum FacilityType {
  STADIUM
  TRAINING_GROUND
  INDOOR_ARENA
  GYM
  SWIMMING_POOL
  MEDICAL_CENTER
  MEETING_ROOM
  OFFICE
  CHANGING_ROOM
  HOSPITALITY
  OUTDOOR_PITCH
  INDOOR_PITCH
  MULTI_PURPOSE
}

// NEW v7.4.0: Venue type for external match venues
enum VenueType {
  STADIUM
  ARENA
  SPORTS_COMPLEX
  SCHOOL_GROUND
  PARK
  COMMUNITY_CENTER
  UNIVERSITY
  PRIVATE_FACILITY
  NEUTRAL_VENUE
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  NO_SHOW
}

// ============================================================================
// üìã ENUMS - BILLING & SUBSCRIPTIONS
// ============================================================================

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  EXPIRED
  PAUSED
  PAST_DUE
  TRIAL
  SUSPENDED
  DOWNGRADED
  PENDING_UPGRADE
  PENDING_CANCELLATION
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
  DISPUTED
  CANCELLED
  PROCESSING
  CHARGEBACK
}

enum PaymentType {
  SUBSCRIPTION
  COACHING_FEE
  MATCH_FEE
  TOURNAMENT_FEE
  TRAINING_FEE
  FACILITY_RENTAL
  EQUIPMENT
  REFUND
  BONUS
  SALARY
  COMMISSION
  TRANSFER_FEE
  LOAN_FEE
  SPONSORSHIP
  OTHER
}

// ============================================================================
// üìã ENUMS - NOTIFICATIONS & SOCIAL
// ============================================================================

enum ChatType {
  DIRECT
  GROUP
  TEAM
  CLUB
  ANNOUNCEMENT
}

enum MatchOfficialRole {
  REFEREE
  ASSISTANT_REFEREE_1
  ASSISTANT_REFEREE_2
  FOURTH_OFFICIAL
  VAR_OFFICIAL
  AVAR_OFFICIAL
  RESERVE_ASSISTANT
  MATCH_COMMISSIONER
  REFEREE_ASSESSOR
}

enum AnnouncementPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum AnnouncementStatus {
  DRAFT
  SCHEDULED
  PUBLISHED
  ARCHIVED
}

enum GoalType {
  PERFORMANCE
  DEVELOPMENT
  FITNESS
  BEHAVIORAL
  TEAM
}

enum GoalStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  EXCEEDED
  MISSED
  CANCELLED
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  REJECTED
  EXPIRED
  CANCELLED
  REVOKED
}

enum WebhookEvent {
  // Match Events
  MATCH_CREATED
  MATCH_STARTED
  MATCH_FINISHED
  MATCH_CANCELLED
  MATCH_LINEUP_SET
  
  // Player Events
  PLAYER_ADDED
  PLAYER_UPDATED
  PLAYER_INJURED
  PLAYER_TRANSFERRED
  
  // Team Events
  TEAM_UPDATED
  TEAM_CREATED
  
  // Competition Events (NEW v7.4.0)
  COMPETITION_CREATED
  COMPETITION_STARTED
  COMPETITION_FINISHED
  
  // Subscription Events
  SUBSCRIPTION_UPDATED
  PAYMENT_RECEIVED
  
  // User Events
  USER_CREATED
  USER_DELETED
  
  // Other Events
  RESULT_APPROVED
  TRAINING_SCHEDULED
  TRAINING_COMPLETED
  ANNOUNCEMENT_POSTED
  JOB_POSTED
  JOB_APPLICATION_RECEIVED
  JOIN_REQUEST_RECEIVED
  MEDIA_UPLOADED
  MEDIA_PROCESSED
}
// ============================================================================
// üè¢ ORGANISATION & MULTI-TENANCY MODELS
// ============================================================================

model Organisation {
  id   String @id @default(cuid())
  slug String @unique @db.VarChar(63)

  name        String
  description String? @db.Text
  logo        String?
  banner      String?
  website     String?

  email    String
  phone    String?
  country  String
  timezone String @default("Europe/London")

  tier          OrganisationTier @default(STARTER)
  monthlyBudget Float?
  currency      String           @default("GBP")

  registrationNumber      String?   @unique
  taxId                   String?   @unique
  complianceStatus        String    @default("PENDING")
  gdprCompliant           Boolean   @default(false)
  dataProcessingAgreement DateTime?

  totalUsers    Int @default(0)
  totalTeams    Int @default(0)
  totalMatches  Int @default(0)
  storageUsedMb Int @default(0)

  enabledFeatures String[] @default([])
  customFeatures  Json?

  maxUsers            Int @default(100)
  maxTeams            Int @default(10)
  maxStorageMb        Int @default(5120)
  maxApiCallsPerMonth Int @default(10000)
  maxConcurrentUsers  Int @default(50)

  subscriptionId  String?   @unique
  billingEmail    String?
  billingCycle    String    @default("MONTHLY")
  nextBillingDate DateTime?

  lastActivityAt DateTime?
  isActive       Boolean   @default(true)
  isArchived     Boolean   @default(false)
  archivedAt     DateTime?

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?
  deletedBy String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  owner                User                     @relation("organisationOwner", fields: [ownerId], references: [id])
  ownerId              String
  members              OrganisationMember[]
  invitations          OrganisationInvitation[]
  clubs                Club[]
  apiKeys              ApiKey[]
  webhooks             Webhook[]
  auditLogs            AuditLog[]
  backups              DatabaseBackup[]
  subscriptions        Subscription[]
  dataExportRequests   DataExportRequest[]
  dataDeletionRequests DataDeletionRequest[]
  apiUsageMetrics      ApiUsageMetrics[]
  quotaUsage           QuotaUsage[]
  seasons              Season[]
  facilities           Facility[]
  venues               Venue[]                  @relation("organisationVenues")
  sponsors             Sponsor[]
  mediaAssets          MediaAsset[]
  mediaContent         MediaContent[]
  competitions         Competition[]

  @@index([slug])
  @@index([ownerId])
  @@index([tier])
  @@index([isActive])
  @@index([createdAt])
  @@index([country])
  @@index([deletedAt])
  @@map("organisations")
}

model OrganisationMember {
  id             String  @id @default(cuid())
  organisationId String
  userId         String
  roleId         String?

  role OrganisationRole @default(MEMBER)

  customPermissions String[]

  joinedAt  DateTime  @default(now())
  invitedBy String?
  invitedAt DateTime?

  lastAccessAt DateTime?
  lastAccessIp String?

  removedAt DateTime?
  removedBy String?

  organisation Organisation @relation(fields: [organisationId], references: [id], onDelete: Cascade)
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  customRole   Role?        @relation("roleMembers", fields: [roleId], references: [id], onDelete: SetNull)

  @@unique([organisationId, userId])
  @@index([organisationId])
  @@index([userId])
  @@index([roleId])
  @@index([role])
  @@index([joinedAt])
  @@map("organisation_members")
}

model OrganisationInvitation {
  id             String           @id @default(cuid())
  organisationId String
  email          String
  role           OrganisationRole @default(MEMBER)

  invitedBy String
  invitedAt DateTime @default(now())
  expiresAt DateTime

  acceptedAt DateTime?
  acceptedBy String?

  status InvitationStatus @default(PENDING)

  token String @unique @default(cuid())

  organisation Organisation @relation(fields: [organisationId], references: [id], onDelete: Cascade)

  @@unique([organisationId, email])
  @@index([organisationId])
  @@index([status])
  @@index([token])
  @@index([expiresAt])
  @@map("organisation_invitations")
}

model Season {
  id             String @id @default(cuid())
  organisationId String

  name      String
  startDate DateTime
  endDate   DateTime

  isActive  Boolean @default(false)
  isCurrent Boolean @default(false)

  description String?

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organisation Organisation   @relation(fields: [organisationId], references: [id], onDelete: Cascade)
  competitions Competition[]
  transfers    Transfer[]

  @@unique([organisationId, name])
  @@index([organisationId])
  @@index([isActive])
  @@index([isCurrent])
  @@index([deletedAt])
  @@map("seasons")
}

// ============================================================================
// üë§ USER & AUTHENTICATION MODELS
// ============================================================================

model User {
  id            String    @id @default(cuid())
  email         String    @unique @db.Citext
  emailVerified DateTime?
  phone         String?   @unique
  phoneVerified DateTime?

  firstName   String
  lastName    String
  middleName  String?
  displayName String?
  avatar      String?
  banner      String?
  bio         String?   @db.Text
  dateOfBirth DateTime?
  nationality String?
  language    String    @default("en-GB")
  timezone    String    @default("Europe/London")

  userType     UserType    @default(INDIVIDUAL)
  accountTier  AccountTier @default(FREE)
  roles        UserRole[]  @default([PLAYER])
  status       UserStatus  @default(PENDING_EMAIL_VERIFICATION)
  isSuperAdmin Boolean     @default(false)

  primaryOrganisationId String?
  clubId                String?
  teamId                String?

  password            String?
  passwordChangedAt   DateTime?
  passwordResetToken  String?   @unique
  passwordResetExpiry DateTime?

  failedLoginAttempts Int       @default(0)
  lastFailedLoginAt   DateTime?
  lastLoginAt         DateTime?
  lastLoginIp         String?
  loginAttempts       Int       @default(0)
  lockoutUntil        DateTime?

  twoFactorEnabled     Boolean  @default(false)
  twoFactorSecret      String?  @unique
  twoFactorBackupCodes String[]

  emailNotificationsEnabled Boolean @default(true)
  pushNotificationsEnabled  Boolean @default(true)
  smsNotificationsEnabled   Boolean @default(false)
  marketingEmailsEnabled    Boolean @default(false)
  privacyLevel              String  @default("FRIENDS_ONLY")
  showOnlineStatus          Boolean @default(true)
  profileVisibility         String  @default("PUBLIC")

  gdprConsent             Boolean   @default(false)
  gdprConsentDate         DateTime?
  dataProcessingConsent   Boolean   @default(false)
  marketingConsent        Boolean   @default(false)
  cookieConsent           Boolean   @default(false)
  termsAcceptedAt         DateTime?
  privacyPolicyAcceptedAt DateTime?

  followersCount Int @default(0)
  followingCount Int @default(0)

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?
  deletedBy String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  organisationMemberships OrganisationMember[]
  organisationsOwned      Organisation[]          @relation("organisationOwner")
  accounts                Account[]
  sessions                Session[]
  refreshTokens           RefreshToken[]
  twoFactorAuth           TwoFactorAuth?
  apiKeys                 ApiKey[]
  player                  Player?
  coach                   Coach?
  referee                 Referee?
  scout                   Scout?
  analyst                 Analyst?
  clubManager             ClubManager?
  clubOwner               ClubOwner?
  parent                  Parent?
  treasurer               Treasurer?
  clubMemberships         ClubMember[]
  managedClubs            Club[]                  @relation("clubManager")
  ownedClubs              Club[]                  @relation("clubOwner")
  notifications           Notification[]
  notificationPrefs       NotificationPreference?
  messages                Message[]
  chatMembers             ChatMember[]
  chatsCreated            Chat[]                  @relation("chatCreator")
  socialActions           SocialAction[]
  followers               Follow[]                @relation("follower")
  following               Follow[]                @relation("following")
  blocks                  UserBlock[]             @relation("blocker")
  blockedBy               UserBlock[]             @relation("blocked")
  achievements            Achievement[]           @relation("achievementUser")
  badges                  Badge[]                 @relation("badgeUser")
  subscriptions           Subscription[]
  payments                Payment[]
  invoices                Invoice[]
  auditLogsCreated        AuditLog[]              @relation("auditLogUser")
  announcementsCreated    Announcement[]          @relation("announcementCreator")
  performanceGoals        PerformanceGoal[]       @relation("goalUser")
  goalsCreated            PerformanceGoal[]       @relation("goalCreator")
  jobApplications         JobApplication[]        @relation("applicant")
  reviewedApplications    JobApplication[]        @relation("applicationReviewer")
  jobPostingsCreated      JobPosting[]            @relation("jobCreator")
  mediaUploaded           MediaContent[]          @relation("mediaUploader")
  matchesCreated          Match[]                 @relation("matchCreator")
  competitionsCreated     Competition[]           @relation("competitionCreator")

  @@index([email])
  @@index([phone])
  @@index([status])
  @@index([clubId])
  @@index([teamId])
  @@index([failedLoginAttempts])
  @@index([primaryOrganisationId])
  @@index([createdAt])
  @@index([lastName, firstName])
  @@index([isSuperAdmin])
  @@index([passwordResetToken])
  @@index([twoFactorEnabled])
  @@index([deletedAt])
  @@map("users")
}

model TwoFactorAuth {
  id     String @id @default(cuid())
  userId String @unique

  secret      String
  enabled     Boolean  @default(false)
  backupCodes String[]

  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  lastUsedAt DateTime?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([enabled])
  @@map("two_factor_auth")
}

model Account {
  id                String @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String

  refresh_token String? @db.Text
  access_token  String? @db.Text
  expires_at    Int?
  token_type    String?
  scope         String?
  id_token      String? @db.Text
  session_state String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime

  ipAddress String?
  userAgent String?
  device    String?
  location  String?

  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([sessionToken])
  @@index([expires])
  @@map("sessions")
}

model RefreshToken {
  id        String    @id @default(cuid())
  userId    String
  token     String    @unique
  expiresAt DateTime
  revokedAt DateTime?
  usedAt    DateTime?

  ipAddress String?
  userAgent String?

  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
  @@index([token])
  @@map("refresh_tokens")
}

model VerificationToken {
  id         String           @id @default(cuid())
  identifier String
  token      String           @unique
  type       VerificationType @default(EMAIL)
  expires    DateTime

  createdAt DateTime @default(now())

  @@unique([identifier, token])
  @@index([type])
  @@index([expires])
  @@index([identifier])
  @@map("verification_tokens")
}

model ApiKey {
  id             String  @id @default(cuid())
  userId         String
  organisationId String?

  name        String
  key         String    @unique @db.Char(32)
  secret      String?   @unique
  lastUsed    DateTime?
  expiresAt   DateTime?
  permissions String[]  @default([])

  rateLimit      Int @default(1000)
  rateLimitReset Int @default(3600)

  createdAt DateTime  @default(now())
  revokedAt DateTime?

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  organisation Organisation? @relation(fields: [organisationId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([key])
  @@index([organisationId])
  @@index([expiresAt])
  @@map("api_keys")
}

model Role {
  id             String @id @default(cuid())
  organisationId String

  name        String
  slug        String
  description String? @db.Text

  isBuiltIn Boolean @default(false)
  isCustom  Boolean @default(true)
  level     Int     @default(0)

  permissions          String[]
  customPermissionJson Json?

  memberCount Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organisationMembers OrganisationMember[] @relation("roleMembers")

  @@unique([organisationId, slug])
  @@index([organisationId])
  @@index([level])
  @@map("roles")
}

model Permission {
  id String @id @default(cuid())

  type        PermissionType @unique
  description String?
  category    String

  @@index([category])
  @@map("permissions")
}

model ResourcePermission {
  id String @id @default(cuid())

  resourceType String
  resourceId   String

  userId     String
  permission String

  grantedAt DateTime  @default(now())
  grantedBy String
  expiresAt DateTime?

  @@unique([resourceType, resourceId, userId, permission])
  @@index([userId])
  @@index([resourceType, resourceId])
  @@index([expiresAt])
  @@map("resource_permissions")
}

// ============================================================================
// üìã AUDIT, COMPLIANCE & DATA GOVERNANCE
// ============================================================================

model AuditLog {
  id             String  @id @default(cuid())
  organisationId String?
  userId         String?

  action AuditActionType

  resourceType String
  resourceId   String

  beforeState Json?
  afterState  Json?
  changes     String[]

  ipAddress String?
  userAgent String?
  sessionId String?
  requestId String?

  severity        String  @default("INFO")
  isCompliance    Boolean @default(false)
  requiresReview  Boolean @default(false)
  isLegalHold     Boolean @default(false)
  legalHoldReason String?

  durationMs Int?

  createdAt DateTime @default(now())

  organisation Organisation? @relation(fields: [organisationId], references: [id], onDelete: SetNull)
  user         User?         @relation("auditLogUser", fields: [userId], references: [id], onDelete: SetNull)

  @@index([organisationId])
  @@index([userId])
  @@index([action])
  @@index([resourceType, resourceId])
  @@index([createdAt])
  @@index([severity])
  @@index([isCompliance])
  @@map("audit_logs")
}

model EntityVersion {
  id String @id @default(cuid())

  entityType String
  entityId   String
  version    Int

  data Json

  changedBy    String
  changeReason String?
  changeType   String

  checksum String?

  retentionPolicy     DataRetentionPolicy @default(STANDARD)
  deletionScheduledAt DateTime?
  deletedAt           DateTime?

  createdAt DateTime @default(now())

  @@unique([entityType, entityId, version])
  @@index([entityType, entityId])
  @@index([deletionScheduledAt])
  @@index([retentionPolicy])
  @@map("entity_versions")
}

model ConsentLog {
  id     String @id @default(cuid())
  userId String

  type String

  granted   Boolean
  grantedAt DateTime

  evidence  Json?
  ipAddress String?
  userAgent String?

  withdrawnAt DateTime?

  @@index([userId])
  @@index([type])
  @@index([grantedAt])
  @@map("consent_logs")
}

model DataExportRequest {
  id             String @id @default(cuid())
  userId         String
  organisationId String

  status String @default("PENDING")

  requestedAt DateTime  @default(now())
  processedAt DateTime?
  expiresAt   DateTime

  fileUrl  String?
  fileSize Int?
  format   String  @default("JSON")

  progress Int @default(0)
  error    String?

  organisation Organisation @relation(fields: [organisationId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([expiresAt])
  @@map("data_export_requests")
}

model DataDeletionRequest {
  id             String @id @default(cuid())
  userId         String
  organisationId String

  reason      String?
  requestedAt DateTime @default(now())

  status      String    @default("PENDING")
  approvedAt  DateTime?
  completedAt DateTime?

  verificationToken  String?   @unique
  verificationSentAt DateTime?

  dataCategories String[]
  retainedData   String[]

  organisation Organisation @relation(fields: [organisationId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([requestedAt])
  @@map("data_deletion_requests")
}
// ============================================================================
// üèÉ PLAYER MODELS
// ============================================================================

model Player {
  id     String @id @default(cuid())
  userId String @unique

  height            Float?
  weight            Float?
  dateOfBirth       DateTime?
  nationality       String?
  secondNationality String?

  jerseyNumber      Int?
  preferredFoot     PreferredFoot?
  primaryPosition   Position?
  secondaryPosition Position?
  tertiaryPosition  Position?

  marketValue      Float?
  valueLastUpdated DateTime?
  currency         String    @default("GBP")

  isActive            Boolean @default(true)
  isVerified          Boolean @default(false)
  hasCompletedProfile Boolean @default(false)
  isAcademy           Boolean @default(false)
  isYouth             Boolean @default(false)
  youthCategory       String?

  overallRating    Float?    @default(0)
  formRating       Float?    @default(0)
  developmentPhase String?
  fitnessLevel     Float?
  injuryStatus     String?
  lastFitnessTest  DateTime?

  availabilityStatus String @default("AVAILABLE")

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?
  deletedBy String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user                    User                      @relation(fields: [userId], references: [id], onDelete: Cascade)
  statistics              PlayerStatistic[]
  aggregateStats          PlayerAggregateStats?
  analytics               PlayerAnalytic?           @relation("playerAnalytics")
  insights                PlayerInsight?            @relation("playerInsights")
  contracts               Contract[]
  injuries                Injury[]
  medicalRecords          MedicalRecord[]
  matchAttendance         MatchAttendance[]
  familyLinks             PlayerFamily[]
  scoutingReports         ScoutingReport[]
  highlights              PlayerHighlight[]
  badges                  Badge[]                   @relation("badgePlayer")
  achievements            Achievement[]             @relation("achievementPlayer")
  transfers               Transfer[]
  availabilityWindow      PlayerAvailability[]
  performanceGoals        PerformanceGoal[]         @relation("goalPlayer")
  trainingAttendance      TrainingAttendance[]
  teamPlayers             TeamPlayer[]
  joinRequests            TeamJoinRequest[]         @relation("playerJoinRequests")
  matchPerformances       PlayerMatchPerformance[]  @relation("playerPerformances")
  matchSquads             MatchSquad[]              @relation("playerSquad")
  matchEvents             MatchEvent[]              @relation("eventPlayer")
  matchEventsAssisted     MatchEvent[]              @relation("assistPlayer")
  matchEventsRelated      MatchEvent[]              @relation("relatedPlayer")

  @@index([userId])
  @@index([isActive])
  @@index([isVerified])
  @@index([primaryPosition])
  @@index([marketValue])
  @@index([createdAt])
  @@index([availabilityStatus])
  @@index([deletedAt])
  @@map("players")
}

model PlayerStatistic {
  id       String  @id @default(cuid())
  playerId String
  season   Int
  teamId   String?
  leagueId String?

  matches       Int @default(0)
  starts        Int @default(0)
  minutesPlayed Int @default(0)
  goals         Int @default(0)
  assists       Int @default(0)
  ownGoals      Int @default(0)

  yellowCards   Int @default(0)
  secondYellows Int @default(0)
  redCards      Int @default(0)
  foulsCommited Int @default(0)
  foulsSuffered Int @default(0)

  passes          Int    @default(0)
  passAccuracy    Float?
  keyPasses       Int    @default(0)
  tackles         Int    @default(0)
  tackleSuccess   Float?
  interceptions   Int    @default(0)
  clearances      Int    @default(0)
  blocks          Int    @default(0)
  aerialDuelsWon  Int    @default(0)
  aerialDuelsLost Int    @default(0)

  shots         Int    @default(0)
  shotsOnTarget Int    @default(0)
  shotAccuracy  Float?

  cleanSheets   Int    @default(0)
  saves         Int    @default(0)
  savePercent   Float?
  goalsConceded Int    @default(0)
  penaltySaves  Int    @default(0)

  dribbles        Int    @default(0)
  dribbleSuccess  Float?
  crossesAttempt  Int    @default(0)
  crossesComplete Int    @default(0)

  // Sport-specific stats stored as JSON for flexibility
  sportSpecificStats Json?

  averageRating Float?
  highestRating Float?
  lowestRating  Float?

  lastUpdated DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([playerId, season, teamId, leagueId])
  @@index([playerId])
  @@index([season])
  @@index([teamId])
  @@index([leagueId])
  @@map("player_statistics")
}

model PlayerAggregateStats {
  id       String @id @default(cuid())
  playerId String @unique

  totalMatches     Int @default(0)
  totalStarts      Int @default(0)
  totalGoals       Int @default(0)
  totalAssists     Int @default(0)
  totalMinutes     Int @default(0)
  totalYellowCards Int @default(0)
  totalRedCards    Int @default(0)
  totalCleanSheets Int @default(0)

  avgGoalsPerMatch   Float @default(0)
  avgAssistsPerMatch Float @default(0)
  avgMinutesPerMatch Float @default(0)
  avgRating          Float @default(0)

  seasonGoals   Int @default(0)
  seasonAssists Int @default(0)
  seasonMatches Int @default(0)

  formGoals   Int    @default(0)
  formAssists Int    @default(0)
  formRating  Float?

  positionRank Int?
  leagueRank   Int?
  clubRank     Int?

  milestone100Matches DateTime?
  milestone50Goals    DateTime?
  milestone100Goals   DateTime?

  lastUpdatedAt DateTime @default(now())
  refreshedAt   DateTime @default(now())

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([lastUpdatedAt])
  @@map("player_aggregate_stats")
}

model PlayerAnalytic {
  id       String @id @default(cuid())
  playerId String @unique

  overallRating        Float @default(0)
  formRating           Float @default(0)
  consistencyIndex     Float @default(0)
  injuryRisk           Float @default(0)
  developmentPotential Float @default(0)
  fatigueLevelEstimate Float @default(0)
  workRateIndex        Float @default(0)

  positionRank Int?
  leagueRank   Int?
  globalRank   Int?
  ageGroupRank Int?

  weeklyTrend  Float?
  monthlyTrend Float?
  seasonTrend  Float?

  lastMatchRating  Float?
  last5MatchesAvg  Float?
  last10MatchesAvg Float?
  seasonAverage    Float?

  predictions          Json?
  predictionConfidence Float?

  expectedGoals       Float?
  expectedAssists     Float?
  passCompletionTrend Float?
  pressureIndex       Float?
  tacticalAwareness   Float?

  strengths        String[]
  weaknesses       String[]
  developmentAreas String[]
  recommendations  String?   @db.Text
  lastAnalysisDate DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation("playerAnalytics", fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([overallRating])
  @@index([injuryRisk])
  @@index([formRating])
  @@map("player_analytics")
}

model PlayerInsight {
  id       String @id @default(cuid())
  playerId String @unique

  strengths         String[]
  weaknesses        String[]
  developmentAreas  String[]
  playingStyle      String?
  strongFoot        String?
  comparablePlayers String[]

  pace                 Int?
  shooting             Int?
  passing              Int?
  dribbling            Int?
  defending            Int?
  physical             Int?
  aggressiveness       Int?
  defensiveAbility     Int?
  leadership           Int?
  teamwork             Int?
  situationalAwareness Int?
  composure            Int?
  creativity           Int?
  workRate             Int?

  determination Int?
  concentration Int?
  decisions     Int?
  anticipation  Int?
  vision        Int?

  recommendations String?   @db.Text
  careerAdvice    String?   @db.Text
  lastReviewDate  DateTime?
  reviewedBy      String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation("playerInsights", fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@map("player_insights")
}

model PlayerFamily {
  id           String  @id @default(cuid())
  playerId     String
  parentId     String?
  guardianId   String?
  relationship String

  isEmergencyContact Boolean @default(false)
  phone              String?
  email              String?

  canViewMedical Boolean @default(false)
  canSignForms   Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([parentId])
  @@map("player_family")
}

model PlayerHighlight {
  id       String  @id @default(cuid())
  playerId String
  matchId  String?

  title         String
  description   String? @db.Text
  videoUrl      String?
  thumbnailUrl  String?
  duration      Int?
  highlightType String

  processingStatus TranscodingStatus @default(PENDING)

  viewCount Int @default(0)
  likeCount Int @default(0)

  isPublic   Boolean @default(true)
  isFeatured Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([matchId])
  @@index([isFeatured])
  @@map("player_highlights")
}

model PlayerAvailability {
  id       String @id @default(cuid())
  playerId String

  startDate DateTime
  endDate   DateTime

  reason String
  status MatchAttendanceStatus

  notes String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([startDate, endDate])
  @@map("player_availability")
}

model Injury {
  id       String @id @default(cuid())
  playerId String

  type     String
  severity InjurySeverity @default(MINOR)
  location String

  dateFrom        DateTime
  dateTo          DateTime?
  estimatedReturn DateTime?
  actualReturn    DateTime?

  description String?      @db.Text
  treatment   String?
  therapist   String?
  status      InjuryStatus @default(ACTIVE)

  diagnosedBy String?
  facility    String?
  scans       String[]
  notes       String? @db.Text

  recoveryProgress Int?
  lastAssessment   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([dateFrom])
  @@index([status])
  @@index([severity])
  @@map("injuries")
}

model MedicalRecord {
  id       String @id @default(cuid())
  playerId String

  recordType String
  date       DateTime

  results     Json?
  notes       String?  @db.Text
  provider    String?
  facility    String?
  attachments String[]

  isClearanceRecord Boolean @default(false)
  clearanceStatus   String?
  clearanceExpiry   DateTime?

  isConfidential   Boolean @default(true)
  accessRestricted Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([recordType])
  @@index([date])
  @@map("medical_records")
}

model Contract {
  id       String  @id @default(cuid())
  playerId String
  clubId   String?

  position Position

  salary           Float?
  currency         String @default("GBP")
  bonusStructure   Json?
  performanceBonus Float?
  signOnBonus      Float?
  loyaltyBonus     Float?
  appearanceFee    Float?
  goalBonus        Float?

  startDate DateTime
  endDate   DateTime?

  contractType     String  @default("PROFESSIONAL")
  status           String  @default("ACTIVE")
  contractDocument String?

  extensionOption Boolean   @default(false)
  extensionDate   DateTime?
  extensionYears  Int?
  buyoutClause    Float?
  releaseClause   Float?
  matchingRights  Boolean   @default(false)

  imageRightsPercent Float?

  agentName       String?
  agentEmail      String?
  agentPhone      String?
  agentCommission Float?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([clubId])
  @@index([status])
  @@index([endDate])
  @@map("contracts")
}

model Transfer {
  id String @id @default(cuid())

  playerId   String
  fromClubId String?
  toClubId   String?
  seasonId   String?

  type   TransferType
  status TransferStatus @default(PENDING)

  fee           Float?
  feeType       String   @default("FIXED")
  currency      String   @default("GBP")
  addOns        Json?
  sellOnPercent Float?
  installments  Json?
  agentFee      Float?

  loanFee          Float?
  wageContribution Float?
  buyOption        Float?
  buyObligation    Float?
  recallClause     Boolean @default(false)

  announcedAt   DateTime?
  completedAt   DateTime?
  effectiveDate DateTime
  loanEndDate   DateTime?

  medicalPassed  Boolean   @default(false)
  medicalDate    DateTime?
  contractSigned Boolean   @default(false)
  contractDate   DateTime?

  notes String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player  @relation(fields: [playerId], references: [id], onDelete: Cascade)
  season Season? @relation(fields: [seasonId], references: [id], onDelete: SetNull)

  @@index([playerId])
  @@index([fromClubId])
  @@index([toClubId])
  @@index([status])
  @@index([effectiveDate])
  @@map("transfers")
}

// ============================================================================
// üèÜ COACH MODELS
// ============================================================================

model Coach {
  id     String @id @default(cuid())
  userId String @unique

  coachType       String   @default("HEAD_COACH")
  specialization  String[]
  certifications  String[]
  yearsExperience Int?
  qualifications  String[] @db.Text
  bio             String?  @db.Text

  hourlyRate   Float?
  dailyRate    Float?
  currency     String  @default("GBP")
  bankDetails  Json?
  taxId        String?
  contractType String?

  isVerified            Boolean   @default(false)
  verificationDate      DateTime?
  licenseNumber         String?   @unique
  licenseExpiry         DateTime?
  backgroundCheckExpiry DateTime?
  dbsCheckNumber        String?
  dbsCheckExpiry        DateTime?
  safeguardingExpiry    DateTime?
  firstAidExpiry        DateTime?

  overallRating       Float? @default(0)
  totalPlayersCoached Int    @default(0)
  successRate         Float?
  matchesManaged      Int    @default(0)
  winRate             Float?

  isAvailable       Boolean @default(true)
  availabilityNotes String?

  // Job Seeking Fields
  isOpenToOpportunities  Boolean  @default(false)
  preferredRoles         String[]
  preferredLocations     String[]
  expectedSalary         Float?
  expectedSalaryCurrency String   @default("GBP")
  noticePeriod           String?

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?
  deletedBy String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user             User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  clubMemberships  ClubMember[]      @relation("coachMemberships")
  trainingSessions TrainingSession[]
  timesheets       CoachTimesheet[]  @relation("coach")
  payments         CoachPayment[]
  achievements     Achievement[]     @relation("achievementCoach")
  jobApplications  JobApplication[]  @relation("coachApplications")
  matchesCreatedByCoach Match[]      @relation("matchCreatedByCoach")

  @@index([userId])
  @@index([isVerified])
  @@index([coachType])
  @@index([licenseExpiry])
  @@index([isOpenToOpportunities])
  @@index([deletedAt])
  @@map("coaches")
}

model CoachTimesheet {
  id      String  @id @default(cuid())
  coachId String
  clubId  String?

  weekStartDate DateTime
  weekEndDate   DateTime

  totalHours Float   @default(0)
  hourlyRate Float?
  hourlyCost Float?
  totalCost  Float?

  description String?  @db.Text
  attachments String[]

  breakdown Json?

  status          TimesheetStatus @default(DRAFT)
  submittedAt     DateTime?
  approvedAt      DateTime?
  approvedBy      String?
  rejectionReason String?
  paidAt          DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  coach Coach @relation("coach", fields: [coachId], references: [id], onDelete: Cascade)

  @@index([coachId])
  @@index([clubId])
  @@index([status])
  @@index([weekStartDate])
  @@map("coach_timesheets")
}

model CoachPayment {
  id      String @id @default(cuid())
  coachId String

  amount        Float
  currency      String   @default("GBP")
  paymentDate   DateTime
  paymentMethod String

  invoiceNumber String? @unique
  reference     String?
  timesheetId   String?

  status      PaymentStatus @default(PENDING)
  description String?

  taxAmount Float?
  netAmount Float?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  coach Coach @relation(fields: [coachId], references: [id], onDelete: Cascade)

  @@index([coachId])
  @@index([status])
  @@index([paymentDate])
  @@map("coach_payments")
}

// ============================================================================
// ü§ù OTHER STAFF MODELS
// ============================================================================

model Referee {
  id     String @id @default(cuid())
  userId String @unique

  licenseNumber     String?  @unique
  licenseLevel      String?
  yearsOfExperience Int?
  specialization    String[]

  certificationDate     DateTime?
  certificationExpiry   DateTime?
  backgroundCheckExpiry DateTime?
  fitnessTestDate       DateTime?
  fitnessTestExpiry     DateTime?

  assignedMatches Int     @default(0)
  isVerified      Boolean @default(false)
  isActive        Boolean @default(true)

  averageRating Float?
  totalReviews  Int   @default(0)

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  matchOfficials MatchOfficial[]

  @@index([userId])
  @@index([isVerified])
  @@index([licenseLevel])
  @@index([deletedAt])
  @@map("referees")
}

model Scout {
  id     String @id @default(cuid())
  userId String @unique

  specialization  String[]
  region          String?
  regions         String[]
  yearsExperience Int?
  focusAgeGroup   String?
  focusPositions  Position[]

  isVerified Boolean @default(false)
  isActive   Boolean @default(true)

  playersRecommended Int @default(0)
  playersSigned      Int @default(0)

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  scoutingReports ScoutingReport[]

  @@index([userId])
  @@index([isVerified])
  @@index([region])
  @@index([deletedAt])
  @@map("scouts")
}

model Analyst {
  id     String @id @default(cuid())
  userId String @unique

  specialization  String[]
  tools           String[]
  yearsExperience Int?

  isVerified Boolean @default(false)
  isActive   Boolean @default(true)

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isVerified])
  @@index([deletedAt])
  @@map("analysts")
}

model ClubManager {
  id     String @id @default(cuid())
  userId String @unique

  managingStyle   String?
  yearsExperience Int?

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([deletedAt])
  @@map("club_managers")
}

model ClubOwner {
  id     String @id @default(cuid())
  userId String @unique

  businessType    String?
  yearsInBusiness Int?

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([deletedAt])
  @@map("club_owners")
}

model Parent {
  id     String @id @default(cuid())
  userId String @unique

  childrenCount Int @default(0)

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([deletedAt])
  @@map("parents")
}

model Treasurer {
  id     String @id @default(cuid())
  userId String @unique

  yearsExperience Int?
  bankDetails     Json?
  qualifications  String[]

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([deletedAt])
  @@map("treasurers")
}
// ============================================================================
// üè¢ CLUB & TEAM MODELS
// ============================================================================

model Club {
  id             String  @id @default(cuid())
  organisationId String?
  name           String
  slug           String  @unique
  shortName      String?
  description    String? @db.Text
  logo           String?
  banner         String?
  website        String?
  email          String?
  phone          String?
  foundedYear    Int?

  city          String?
  state         String?
  country       String?
  address       String?
  postcode      String?
  venue         String?
  venueCapacity Int?
  coordinates   Json?

  sport    Sport
  teamType TeamType @default(AMATEUR)

  managerId String
  ownerId   String?

  primaryColor   String?
  secondaryColor String?

  isVerified       Boolean @default(false)
  isPublic         Boolean @default(true)
  acceptingPlayers Boolean @default(true)
  acceptingStaff   Boolean @default(true)
  status           String  @default("ACTIVE")

  followerCount Int @default(0)
  joinedMembers Int @default(0)

  twitter   String?
  facebook  String?
  instagram String?
  youtube   String?
  tiktok    String?

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?
  deletedBy String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organisation     Organisation?       @relation(fields: [organisationId], references: [id], onDelete: SetNull)
  manager          User                @relation("clubManager", fields: [managerId], references: [id])
  owner            User?               @relation("clubOwner", fields: [ownerId], references: [id])
  members          ClubMember[]
  teams            Team[]
  formations       TeamFormation[]
  tactics          Tactic[]
  trainingSessions TrainingSession[]
  homeMatches      Match[]             @relation("homeClub")
  awayMatches      Match[]             @relation("awayClub")
  aggregateStats   TeamAggregateStats?
  announcements    Announcement[]
  sponsors         ClubSponsor[]
  jobPostings      JobPosting[]
  mediaContent     MediaContent[]      @relation("clubMedia")
  competitions     Competition[]       @relation("clubCompetitions")
  competitionTeams CompetitionTeam[]

  @@index([organisationId])
  @@index([managerId])
  @@index([ownerId])
  @@index([sport])
  @@index([isPublic])
  @@index([city])
  @@index([country])
  @@index([status])
  @@index([acceptingPlayers])
  @@index([acceptingStaff])
  @@index([deletedAt])
  @@map("clubs")
}

model ClubMember {
  id      String  @id @default(cuid())
  userId  String
  clubId  String
  coachId String?

  role ClubMemberRole @default(STAFF)

  joinedAt  DateTime  @default(now())
  leftAt    DateTime?
  isActive  Boolean   @default(true)
  isCaptain Boolean   @default(false)

  salary      Float?
  currency    String    @default("GBP")
  contractEnd DateTime?

  canManageRoster  Boolean @default(false)
  canManageMatches Boolean @default(false)
  canManageBilling Boolean @default(false)
  canManageMedia   Boolean @default(false)

  // NEW v7.4.0: Additional permissions
  canCreateFriendlyMatches Boolean @default(false)
  canManageLineups         Boolean @default(false)

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?

  user  User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  club  Club   @relation(fields: [clubId], references: [id], onDelete: Cascade)
  coach Coach? @relation("coachMemberships", fields: [coachId], references: [id], onDelete: SetNull)

  @@unique([userId, clubId])
  @@index([userId])
  @@index([clubId])
  @@index([coachId])
  @@index([role])
  @@index([isActive])
  @@index([deletedAt])
  @@map("club_members")
}

model Team {
  id     String @id @default(cuid())
  clubId String

  name        String
  description String? @db.Text
  logo        String?
  ageGroup    String?
  gender      String?
  status      TeamStatus @default(ACTIVE)

  minPlayers Int?
  maxPlayers Int?

  // Default formation for the team
  defaultFormation FormationType?

  // Team preferences for join requests
  acceptingJoinRequests Boolean @default(true)
  requiresApproval      Boolean @default(true)

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?
  deletedBy String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club             Club              @relation(fields: [clubId], references: [id], onDelete: Cascade)
  players          TeamPlayer[]
  matchSquads      MatchSquad[]
  formations       TeamFormation[]
  competitionTeams CompetitionTeam[]
  joinRequests     TeamJoinRequest[]
  trainingSessions TrainingSession[] @relation("teamTraining")
  mediaContent     MediaContent[]    @relation("teamMedia")
  homeMatches      Match[]           @relation("homeTeam")
  awayMatches      Match[]           @relation("awayTeam")

  @@unique([clubId, name])
  @@index([clubId])
  @@index([ageGroup])
  @@index([status])
  @@index([acceptingJoinRequests])
  @@index([deletedAt])
  @@map("teams")
}

model TeamPlayer {
  id       String @id @default(cuid())
  teamId   String
  playerId String

  position      Position?
  jerseyNumber  Int?
  isActive      Boolean   @default(true)
  isCaptain     Boolean   @default(false)
  isViceCaptain Boolean   @default(false)

  joinedAt DateTime  @default(now())
  leftAt   DateTime?

  // Track how player joined
  joinedVia     String? // 'DIRECT', 'JOIN_REQUEST', 'INVITATION', 'TRANSFER'
  joinRequestId String?

  team   Team   @relation(fields: [teamId], references: [id], onDelete: Cascade)
  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([teamId, playerId])
  @@index([teamId])
  @@index([playerId])
  @@index([isActive])
  @@map("team_players")
}

model TeamFormation {
  id     String  @id @default(cuid())
  clubId String
  teamId String?

  name        String?
  formation   FormationType @default(FOUR_FOUR_TWO)
  description String?
  diagram     Json?

  positions Json?

  isDefault Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club Club  @relation(fields: [clubId], references: [id], onDelete: Cascade)
  team Team? @relation(fields: [teamId], references: [id], onDelete: SetNull)

  @@index([clubId])
  @@index([teamId])
  @@map("team_formations")
}

model TeamJoinRequest {
  id       String @id @default(cuid())
  teamId   String
  playerId String

  // Request details
  status                JoinRequestStatus @default(PENDING)
  message               String?           @db.Text
  preferredPosition     Position?
  preferredJerseyNumber Int?

  // Player profile snapshot at time of request
  playerProfileSnapshot Json?

  // Review information
  reviewedBy      String?
  reviewedAt      DateTime?
  reviewNotes     String?   @db.Text
  rejectionReason String?

  // Expiry
  expiresAt DateTime?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  team   Team   @relation(fields: [teamId], references: [id], onDelete: Cascade)
  player Player @relation("playerJoinRequests", fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([teamId, playerId, status])
  @@index([teamId])
  @@index([playerId])
  @@index([status])
  @@index([createdAt])
  @@index([expiresAt])
  @@map("team_join_requests")
}

// ============================================================================
// üèÜ COMPETITION SYSTEM (NEW v7.4.0)
// ============================================================================

model Competition {
  id             String  @id @default(cuid())
  organisationId String?
  clubId         String? // For club-owned competitions
  seasonId       String?

  // Basic Info
  name        String
  shortName   String?
  slug        String        @unique
  description String?       @db.Text
  logo        String?
  banner      String?

  // Sport & Type
  sport Sport
  type  CompetitionType @default(LEAGUE)

  // Format
  format     LeagueFormat     @default(ROUND_ROBIN)
  visibility LeagueVisibility @default(PRIVATE)

  // Schedule
  startDate            DateTime
  endDate              DateTime?
  registrationDeadline DateTime?

  // Status
  status String @default("DRAFT")

  // Settings
  maxTeams        Int?
  teamsRegistered Int  @default(0)

  tiebreakers String[] @default(["GOAL_DIFFERENCE", "GOALS_FOR", "HEAD_TO_HEAD"])

  pointsForWin  Int @default(3)
  pointsForDraw Int @default(1)
  pointsForLoss Int @default(0)

  // Scoring (multi-sport support)
  scoringRules Json?

  rules String? @db.Text

  // Analytics
  totalMatches     Int @default(0)
  completedMatches Int @default(0)
  totalGoals       Int @default(0)

  // Creator
  createdBy String

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?
  deletedBy String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  organisation Organisation?          @relation(fields: [organisationId], references: [id], onDelete: SetNull)
  club         Club?                  @relation("clubCompetitions", fields: [clubId], references: [id], onDelete: SetNull)
  season       Season?                @relation(fields: [seasonId], references: [id], onDelete: SetNull)
  creator      User                   @relation("competitionCreator", fields: [createdBy], references: [id])
  teams        CompetitionTeam[]
  matches      Match[]
  standings    CompetitionStanding[]
  brackets     TournamentBracket[]
  stages       CompetitionStageConfig[]

  @@index([organisationId])
  @@index([clubId])
  @@index([seasonId])
  @@index([sport])
  @@index([type])
  @@index([status])
  @@index([startDate])
  @@index([deletedAt])
  @@map("competitions")
}

model CompetitionTeam {
  id            String @id @default(cuid())
  competitionId String
  teamId        String
  clubId        String

  joinedAt   DateTime  @default(now())
  leftAt     DateTime?
  isActive   Boolean   @default(true)
  seedNumber Int?
  groupName  String?   // For group stage competitions

  competition Competition @relation(fields: [competitionId], references: [id], onDelete: Cascade)
  team        Team        @relation(fields: [teamId], references: [id], onDelete: Cascade)
  club        Club        @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@unique([competitionId, teamId])
  @@index([competitionId])
  @@index([teamId])
  @@index([clubId])
  @@index([groupName])
  @@map("competition_teams")
}

model CompetitionStanding {
  id            String  @id @default(cuid())
  competitionId String
  teamId        String?
  groupName     String? // For group stage standings

  position       Int
  played         Int @default(0)
  wins           Int @default(0)
  draws          Int @default(0)
  losses         Int @default(0)
  goalsFor       Int @default(0)
  goalsAgainst   Int @default(0)
  goalDifference Int @default(0)
  points         Int @default(0)

  // Multi-sport: Store sport-specific breakdown
  scoreBreakdown Json?

  form String?

  homeWins   Int @default(0)
  homeDraws  Int @default(0)
  homeLosses Int @default(0)
  awayWins   Int @default(0)
  awayDraws  Int @default(0)
  awayLosses Int @default(0)

  updatedAt DateTime @updatedAt

  competition Competition @relation(fields: [competitionId], references: [id], onDelete: Cascade)

  @@unique([competitionId, teamId, groupName])
  @@index([competitionId])
  @@index([position])
  @@index([groupName])
  @@map("competition_standings")
}

model CompetitionStageConfig {
  id            String @id @default(cuid())
  competitionId String

  stage     CompetitionStage
  name      String?
  order     Int              @default(0)

  // Configuration
  numberOfTeams  Int?
  numberOfGroups Int?
  matchesPerTeam Int?
  isHomeAndAway  Boolean @default(false)

  startDate DateTime?
  endDate   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  competition Competition @relation(fields: [competitionId], references: [id], onDelete: Cascade)

  @@unique([competitionId, stage])
  @@index([competitionId])
  @@index([order])
  @@map("competition_stage_configs")
}

model TournamentBracket {
  id            String @id @default(cuid())
  competitionId String

  round    Int
  position Int
  matchId  String?

  homeTeamId String?
  awayTeamId String?
  homeScore  Int?
  awayScore  Int?
  winnerId   String?

  homeSourceBracketId String?
  awaySourceBracketId String?

  scheduledAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  competition Competition @relation(fields: [competitionId], references: [id], onDelete: Cascade)

  @@unique([competitionId, round, position])
  @@index([competitionId])
  @@index([round])
  @@map("tournament_brackets")
}

// ============================================================================
// üèüÔ∏è VENUE MODEL (NEW v7.4.0)
// ============================================================================

model Venue {
  id             String  @id @default(cuid())
  organisationId String?

  name      String
  shortName String?
  type      VenueType @default(STADIUM)

  // Location
  address     String?
  city        String?
  state       String?
  postcode    String?
  country     String?
  coordinates Json?   // { lat: number, lng: number }

  // Details
  capacity    Int?
  surface     String?  // 'GRASS', 'ARTIFICIAL', 'INDOOR', etc.
  description String?  @db.Text
  facilities  String[] // ['FLOODLIGHTS', 'PARKING', 'CHANGING_ROOMS', etc.]
  images      String[]

  // Contact
  contactName  String?
  contactEmail String?
  contactPhone String?
  website      String?

  // Operating hours (JSON structure)
  operatingHours Json?

  // Status
  isActive   Boolean @default(true)
  isVerified Boolean @default(false)

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organisation Organisation? @relation("organisationVenues", fields: [organisationId], references: [id], onDelete: SetNull)
  matches      Match[]       @relation("matchVenue")

  @@index([organisationId])
  @@index([city])
  @@index([country])
  @@index([type])
  @@index([isActive])
  @@index([deletedAt])
  @@map("venues")
}

// ============================================================================
// ‚öΩ MATCH MODEL (MAJOR OVERHAUL v7.4.0)
// ============================================================================

model Match {
  id String @id @default(cuid())

  // Competition (OPTIONAL - allows standalone friendlies)
  competitionId String?

  // REQUIRED: Teams (NEW v7.4.0)
  homeTeamId String
  awayTeamId String

  // DERIVED: Clubs (auto-populated from teams)
  homeClubId String
  awayClubId String

  // Match Type (NEW v7.4.0)
  matchType MatchType @default(LEAGUE)

  // Competition Stage (for knockout/group tracking)
  stage     CompetitionStage?
  groupName String?
  round     Int?
  matchday  Int?
  leg       Int?

  title       String?
  description String? @db.Text

  // Schedule
  kickOffTime DateTime
  endTime     DateTime?
  status      MatchStatus @default(SCHEDULED)

  // Venue (NEW v7.4.0: Links to Venue OR Facility)
  venueId    String?
  facilityId String?
  venue      String? // Text fallback for venue name
  pitch      String?

  // Weather conditions
  weather     String?
  temperature Int?
  humidity    Int?
  windSpeed   Float?

  // ========================
  // SCORES (v7.4.0 STANDARD)
  // ========================
  homeScore         Int?
  awayScore         Int?
  homeHalftimeScore Int?
  awayHalftimeScore Int?
  homePenalties     Int?
  awayPenalties     Int?
  homeExtraTimeScore Int?
  awayExtraTimeScore Int?

  // Multi-sport score breakdown (NEW v7.4.0)
  // Rugby: {"tries": 3, "conversions": 2, "penalties": 1, "dropGoals": 0}
  // Basketball: {"twoPointers": 20, "threePointers": 8, "freeThrows": 12}
  // Cricket: {"runs": 245, "wickets": 7, "overs": 50}
  homeScoreBreakdown Json?
  awayScoreBreakdown Json?

  // ========================
  // FORMATIONS (NEW v7.4.0)
  // ========================
  homeFormation FormationType?
  awayFormation FormationType?

  // Attendance
  attendance Int?
  capacity   Int?

  // Match timing
  actualDuration   Int?
  injuryTimeFirst  Int?
  injuryTimeSecond Int?

  // Result approval
  resultApprovalStatus ResultApprovalStatus @default(PENDING)
  approvedBy           String?
  approvedAt           DateTime?
  disputeReason        String?

  // Flags
  isHighlighted  Boolean @default(false)
  isFeatured     Boolean @default(false)
  isNeutralVenue Boolean @default(false)

  // Broadcast
  isBroadcasted Boolean @default(false)
  broadcastUrl  String?

  // ========================
  // CREATOR TRACKING (NEW v7.4.0)
  // ========================
  createdById      String  // Required: Who created the match
  createdByCoachId String? // Optional: If created by coach (for friendly permissions)

  // Match report
  matchReport String? @db.Text
  notes       String? @db.Text

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?
  deletedBy String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  competition      Competition?            @relation(fields: [competitionId], references: [id], onDelete: SetNull)
  homeTeam         Team                    @relation("homeTeam", fields: [homeTeamId], references: [id])
  awayTeam         Team                    @relation("awayTeam", fields: [awayTeamId], references: [id])
  homeClub         Club                    @relation("homeClub", fields: [homeClubId], references: [id])
  awayClub         Club                    @relation("awayClub", fields: [awayClubId], references: [id])
  venueRelation    Venue?                  @relation("matchVenue", fields: [venueId], references: [id])
  facilityRelation Facility?               @relation("matchFacility", fields: [facilityId], references: [id])
  creator          User                    @relation("matchCreator", fields: [createdById], references: [id])
  createdByCoach   Coach?                  @relation("matchCreatedByCoach", fields: [createdByCoachId], references: [id])
  events           MatchEvent[]
  squads           MatchSquad[]
  playerAttendance MatchAttendance[]
  playerPerformances PlayerMatchPerformance[]
  officials        MatchOfficial[]
  mediaContent     MediaContent[]          @relation("matchMedia")

  @@index([competitionId])
  @@index([homeTeamId])
  @@index([awayTeamId])
  @@index([homeClubId])
  @@index([awayClubId])
  @@index([venueId])
  @@index([facilityId])
  @@index([matchType])
  @@index([status])
  @@index([kickOffTime])
  @@index([resultApprovalStatus])
  @@index([createdById])
  @@index([createdByCoachId])
  @@index([deletedAt])
  @@map("matches")
}

// ============================================================================
// üìä PLAYER MATCH PERFORMANCE (NEW v7.4.0)
// ============================================================================

model PlayerMatchPerformance {
  id       String @id @default(cuid())
  matchId  String
  playerId String
  teamId   String

  // Time played
  minutesPlayed Int @default(0)
  startedMatch  Boolean @default(false)
  substituteOn  Int?   // Minute substituted on
  substituteOff Int?   // Minute substituted off

  // Basic stats
  goals         Int @default(0)
  assists       Int @default(0)
  yellowCards   Int @default(0)
  redCard       Boolean @default(false)
  secondYellow  Boolean @default(false)

  // Passing
  passes         Int    @default(0)
  passesComplete Int    @default(0)
  passAccuracy   Float?
  keyPasses      Int    @default(0)
  longBalls      Int    @default(0)
  throughBalls   Int    @default(0)
  crosses        Int    @default(0)
  crossesComplete Int   @default(0)

  // Defending
  tackles       Int @default(0)
  tacklesWon    Int @default(0)
  interceptions Int @default(0)
  clearances    Int @default(0)
  blocks        Int @default(0)

  // Attacking
  shots         Int @default(0)
  shotsOnTarget Int @default(0)
  dribbles      Int @default(0)
  dribblesWon   Int @default(0)

  // Duels
  aerialsWon  Int @default(0)
  aerialsLost Int @default(0)
  duelsWon    Int @default(0)
  duelsLost   Int @default(0)

  // Discipline
  fouls       Int @default(0)
  fouled      Int @default(0)

  // Goalkeeper stats
  saves         Int     @default(0)
  goalsConceded Int     @default(0)
  cleanSheet    Boolean @default(false)
  penaltySaves  Int     @default(0)

  // Touch/Possession
  touches    Int    @default(0)
  possession Float?

  // Rating (0-10 scale)
  rating      Float?
  coachRating Float?

  // Coach feedback
  coachNotes String? @db.Text

  // Sport-specific stats (JSON for flexibility)
  // Rugby: {"tackles": 10, "carries": 5, "offloads": 2}
  // Basketball: {"rebounds": 8, "steals": 3, "blocks": 2}
  sportSpecificStats Json?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  match  Match  @relation(fields: [matchId], references: [id], onDelete: Cascade)
  player Player @relation("playerPerformances", fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([matchId, playerId])
  @@index([matchId])
  @@index([playerId])
  @@index([teamId])
  @@index([rating])
  @@map("player_match_performances")
}

// ============================================================================
// ‚öΩ MATCH SUPPORTING MODELS
// ============================================================================

model MatchOfficial {
  id        String @id @default(cuid())
  matchId   String
  refereeId String

  role MatchOfficialRole

  performanceRating Float?
  notes             String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  match   Match   @relation(fields: [matchId], references: [id], onDelete: Cascade)
  referee Referee @relation(fields: [refereeId], references: [id], onDelete: Cascade)

  @@unique([matchId, role])
  @@index([matchId])
  @@index([refereeId])
  @@map("match_officials")
}

model MatchEvent {
  id       String  @id @default(cuid())
  matchId  String
  playerId String?

  eventType       MatchEventType
  minute          Int
  secondaryMinute Int?
  period          String?

  // Team side for the event
  teamSide String? // 'home' or 'away'

  // Related players
  relatedPlayerId String?
  assistPlayerId  String?

  // Event specifics
  goalType   String?
  cardReason String?
  injuryType String?

  // Position on pitch (for heatmaps)
  xPosition Float?
  yPosition Float?

  details        Json?
  videoTimestamp Int?
  videoUrl       String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  match         Match   @relation(fields: [matchId], references: [id], onDelete: Cascade)
  player        Player? @relation("eventPlayer", fields: [playerId], references: [id])
  assistPlayer  Player? @relation("assistPlayer", fields: [assistPlayerId], references: [id])
  relatedPlayer Player? @relation("relatedPlayer", fields: [relatedPlayerId], references: [id])

  @@index([matchId])
  @@index([eventType])
  @@index([playerId])
  @@index([minute])
  @@index([teamSide])
  @@map("match_events")
}

model MatchSquad {
  id       String  @id @default(cuid())
  matchId  String
  teamId   String
  playerId String?

  lineupPosition Int?
  shirtNumber    Int?
  position       Position?

  status MatchAttendanceStatus @default(NOT_SELECTED)

  isCaptain       Boolean @default(false)
  substituteOrder Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  match  Match   @relation(fields: [matchId], references: [id], onDelete: Cascade)
  team   Team    @relation(fields: [teamId], references: [id], onDelete: Cascade)
  player Player? @relation("playerSquad", fields: [playerId], references: [id])

  @@unique([matchId, playerId])
  @@index([matchId])
  @@index([teamId])
  @@index([playerId])
  @@index([status])
  @@map("match_squads")
}

model MatchAttendance {
  id       String @id @default(cuid())
  matchId  String
  playerId String

  status          MatchAttendanceStatus @default(AVAILABLE)
  notesFromPlayer String?
  responseDate    DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  match  Match  @relation(fields: [matchId], references: [id], onDelete: Cascade)
  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([matchId, playerId])
  @@index([matchId])
  @@index([playerId])
  @@index([status])
  @@map("match_attendance")
}
// ============================================================================
// üìä TRAINING MODELS
// ============================================================================

model TrainingSession {
  id      String  @id @default(cuid())
  clubId  String
  teamId  String? // Optional team-specific training (hybrid support)
  coachId String

  name        String
  description String? @db.Text

  startTime DateTime
  endTime   DateTime

  intensity TrainingIntensity @default(MEDIUM)
  category  TrainingCategory

  // Custom category for sport-specific training
  customCategory String?

  location        String?
  facilityId      String?
  maxParticipants Int?

  drills    Json?
  notes     String? @db.Text
  equipment String[]

  // Focus areas as array for better querying
  focusAreas String[]

  status TrainingStatus @default(SCHEDULED)

  // Analytics
  attendanceCount Int @default(0)
  avgRating       Float?

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club       Club                 @relation(fields: [clubId], references: [id], onDelete: Cascade)
  team       Team?                @relation("teamTraining", fields: [teamId], references: [id], onDelete: SetNull)
  coach      Coach                @relation(fields: [coachId], references: [id], onDelete: Cascade)
  attendance TrainingAttendance[]
  media      MediaContent[]       @relation("trainingMedia")

  @@index([clubId])
  @@index([teamId])
  @@index([coachId])
  @@index([startTime])
  @@index([status])
  @@index([category])
  @@index([deletedAt])
  @@map("training_sessions")
}

model TrainingAttendance {
  id        String @id @default(cuid())
  sessionId String
  playerId  String

  status      AttendanceStatus @default(PRESENT)
  arrivalTime DateTime?
  departTime  DateTime?
  notes       String?

  // Injury reference if status is INJURED
  injuryId String?

  performanceRating Float?
  effortRating      Float?
  coachNotes        String?

  // Sport-specific metrics
  customMetrics Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  session TrainingSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  player  Player          @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([sessionId, playerId])
  @@index([sessionId])
  @@index([playerId])
  @@index([status])
  @@map("training_attendance")
}

model ScoutingReport {
  id       String @id @default(cuid())
  scoutId  String
  playerId String

  rating       Float?
  observations String? @db.Text

  technicalRating Float?
  tacticalRating  Float?
  physicalRating  Float?
  mentalRating    Float?

  recommendation String?
  urgency        String?
  suggestedValue Float?
  currency       String  @default("GBP")

  matchWatched String?
  matchDate    DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  scout  Scout  @relation(fields: [scoutId], references: [id], onDelete: Cascade)
  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([scoutId])
  @@index([playerId])
  @@index([recommendation])
  @@map("scouting_reports")
}

model Tactic {
  id     String @id @default(cuid())
  clubId String

  name        String
  description String? @db.Text
  diagram     Json?
  formation   FormationType?

  defendingStyle  String?
  attackingStyle  String?
  pressingTrigger String?
  buildUpPlay     String?

  corners   Json?
  freeKicks Json?
  throwIns  Json?

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club Club @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@index([clubId])
  @@index([isActive])
  @@map("tactics")
}

model TeamAggregateStats {
  id     String @id @default(cuid())
  clubId String @unique

  totalMatches      Int @default(0)
  totalWins         Int @default(0)
  totalDraws        Int @default(0)
  totalLosses       Int @default(0)
  totalGoalsFor     Int @default(0)
  totalGoalsAgainst Int @default(0)
  winRate           Float?

  homeMatches Int @default(0)
  homeWins    Int @default(0)
  homeDraws   Int @default(0)
  homeLosses  Int @default(0)

  awayMatches Int @default(0)
  awayWins    Int @default(0)
  awayDraws   Int @default(0)
  awayLosses  Int @default(0)

  currentStreak     Int     @default(0)
  streakType        String?
  longestWinStreak  Int     @default(0)
  longestLossStreak Int     @default(0)

  cleanSheets Int @default(0)

  lastUpdatedAt DateTime @default(now())

  club Club @relation(fields: [clubId], references: [id], onDelete: Cascade)

  @@index([clubId])
  @@map("team_aggregate_stats")
}

model PerformanceGoal {
  id String @id @default(cuid())

  userId   String?
  playerId String?

  type        GoalType
  title       String
  description String?  @db.Text

  targetValue  Float?
  currentValue Float?
  unit         String?

  startDate DateTime
  endDate   DateTime
  status    GoalStatus @default(NOT_STARTED)

  progress   Int   @default(0)
  milestones Json?

  reviewedAt DateTime?
  reviewedBy String?
  feedback   String?   @db.Text

  createdBy String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user    User?   @relation("goalUser", fields: [userId], references: [id], onDelete: Cascade)
  player  Player? @relation("goalPlayer", fields: [playerId], references: [id], onDelete: Cascade)
  creator User    @relation("goalCreator", fields: [createdBy], references: [id])

  @@index([userId])
  @@index([playerId])
  @@index([status])
  @@index([type])
  @@map("performance_goals")
}

// ============================================================================
// üèüÔ∏è FACILITY MANAGEMENT
// ============================================================================

model Facility {
  id             String @id @default(cuid())
  organisationId String

  name        String
  type        FacilityType
  description String?      @db.Text

  address     String?
  city        String?
  postcode    String?
  country     String?
  coordinates Json?

  capacity Int?

  isActive       Boolean @default(true)
  operatingHours Json?

  amenities String[]
  images    String[]

  contactName  String?
  contactPhone String?
  contactEmail String?

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organisation Organisation      @relation(fields: [organisationId], references: [id], onDelete: Cascade)
  bookings     FacilityBooking[]
  matches      Match[]           @relation("matchFacility")

  @@index([organisationId])
  @@index([type])
  @@index([isActive])
  @@index([deletedAt])
  @@map("facilities")
}

model FacilityBooking {
  id         String @id @default(cuid())
  facilityId String

  startTime DateTime
  endTime   DateTime

  purpose     String
  description String?
  bookedBy    String

  status BookingStatus @default(PENDING)

  isRecurring     Boolean @default(false)
  recurrenceRule  String?
  parentBookingId String?

  cost     Float?
  currency String  @default("GBP")
  paid     Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  facility Facility @relation(fields: [facilityId], references: [id], onDelete: Cascade)

  @@index([facilityId])
  @@index([startTime, endTime])
  @@index([status])
  @@index([bookedBy])
  @@map("facility_bookings")
}

// ============================================================================
// üìπ MEDIA CONTENT
// ============================================================================

model MediaContent {
  id             String  @id @default(cuid())
  organisationId String?
  clubId         String?
  teamId         String?
  matchId        String?
  trainingId     String?

  // Uploader
  uploadedBy String

  // File information
  type     MediaType
  category MediaCategory @default(OTHER)

  title       String
  description String? @db.Text
  tags        String[]

  // File metadata
  filename     String
  originalName String
  mimeType     String
  sizeBytes    Int
  url          String
  cdnUrl       String?

  // Video-specific
  duration     Int?
  thumbnailUrl String?

  // Image-specific
  width  Int?
  height Int?

  // Processing
  processingStatus   MediaProcessingStatus @default(PENDING)
  processingProvider VideoProcessingProvider?
  processingError    String?
  processedAt        DateTime?

  // Quality variants (for video)
  qualityVariants Json?

  // Access control
  visibility  MediaVisibility @default(CLUB_ONLY)
  isPublic    Boolean         @default(false)
  accessRoles ClubMemberRole[]

  // Analytics
  viewCount     Int @default(0)
  downloadCount Int @default(0)
  likeCount     Int @default(0)

  // Timestamps for video clips
  startTimestamp Int?
  endTimestamp   Int?

  // Parent media (for clips from full videos)
  parentMediaId String?

  // Metadata
  metadata Json?

  // Expiry
  expiresAt DateTime?

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  organisation Organisation?    @relation(fields: [organisationId], references: [id], onDelete: SetNull)
  club         Club?            @relation("clubMedia", fields: [clubId], references: [id], onDelete: SetNull)
  team         Team?            @relation("teamMedia", fields: [teamId], references: [id], onDelete: SetNull)
  match        Match?           @relation("matchMedia", fields: [matchId], references: [id], onDelete: SetNull)
  training     TrainingSession? @relation("trainingMedia", fields: [trainingId], references: [id], onDelete: SetNull)
  uploader     User             @relation("mediaUploader", fields: [uploadedBy], references: [id])

  @@index([organisationId])
  @@index([clubId])
  @@index([teamId])
  @@index([matchId])
  @@index([trainingId])
  @@index([uploadedBy])
  @@index([type])
  @@index([category])
  @@index([visibility])
  @@index([processingStatus])
  @@index([createdAt])
  @@index([deletedAt])
  @@map("media_content")
}

model MediaAsset {
  id             String @id @default(cuid())
  organisationId String

  type     String
  filename String
  url      String
  mimeType String

  width  Int?
  height Int?

  sizeBytes Int

  duration           Int?
  thumbnailUrl       String?
  processingStatus   TranscodingStatus?
  processingProvider VideoProcessingProvider?

  alt         String?
  description String?
  tags        String[]

  usageCount Int @default(0)

  createdBy String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organisation Organisation @relation(fields: [organisationId], references: [id], onDelete: Cascade)

  @@index([organisationId])
  @@index([type])
  @@index([createdAt])
  @@map("media_assets")
}

// ============================================================================
// üíº JOB POSTING & APPLICATION SYSTEM
// ============================================================================

model JobPosting {
  id     String @id @default(cuid())
  clubId String

  // Job details
  title            String
  slug             String
  description      String  @db.Text
  shortDescription String?

  // Classification
  category        JobCategory
  role            ClubMemberRole
  employmentType  EmploymentType  @default(FULL_TIME)
  experienceLevel ExperienceLevel @default(MID)

  // Requirements
  requirements    String[]
  qualifications  String[]
  certifications  String[]
  skills          String[]
  yearsExperience Int?

  // Compensation
  salaryMin      Float?
  salaryMax      Float?
  currency       String   @default("GBP")
  salaryPeriod   String?
  benefits       String[]
  bonusStructure Json?

  // Location
  location       String?
  city           String?
  country        String?
  isRemote       Boolean @default(false)
  isHybrid       Boolean @default(false)
  travelRequired Boolean @default(false)

  // Status & Dates
  status      JobPostingStatus @default(DRAFT)
  publishedAt DateTime?
  deadline    DateTime?
  startDate   DateTime?

  // Settings
  isUrgent       Boolean @default(false)
  isFeatured     Boolean @default(false)
  isConfidential Boolean @default(false)

  // Application settings
  maxApplications     Int?
  requiresCoverLetter Boolean @default(true)
  requiresResume      Boolean @default(true)
  customQuestions     Json?

  // Metrics
  viewCount        Int @default(0)
  applicationCount Int @default(0)
  shortlistedCount Int @default(0)

  // Creator
  createdBy String

  // SOFT DELETE (v7.4.0)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  club         Club             @relation(fields: [clubId], references: [id], onDelete: Cascade)
  creator      User             @relation("jobCreator", fields: [createdBy], references: [id])
  applications JobApplication[]

  @@unique([clubId, slug])
  @@index([clubId])
  @@index([category])
  @@index([role])
  @@index([status])
  @@index([publishedAt])
  @@index([deadline])
  @@index([city])
  @@index([country])
  @@index([isRemote])
  @@index([isFeatured])
  @@index([createdAt])
  @@index([deletedAt])
  @@map("job_postings")
}

model JobApplication {
  id           String  @id @default(cuid())
  jobPostingId String
  userId       String
  coachId      String?

  // Application content
  coverLetter   String? @db.Text
  resumeUrl     String?
  portfolioUrl  String?
  linkedInUrl   String?
  customAnswers Json?

  // Applicant snapshot
  applicantSnapshot Json?

  // Status tracking
  status JobApplicationStatus @default(PENDING)

  // Review process
  reviewedBy  String?
  reviewedAt  DateTime?
  reviewNotes String?   @db.Text
  rating      Int?

  // Interview
  interviewDate     DateTime?
  interviewLocation String?
  interviewNotes    String?   @db.Text
  interviewRating   Int?

  // Offer
  offerDate          DateTime?
  offerSalary        Float?
  offerAcceptedAt    DateTime?
  offerDeclinedAt    DateTime?
  offerDeclineReason String?

  // Rejection
  rejectionReason String?
  rejectionDate   DateTime?

  // Withdrawal
  withdrawnAt    DateTime?
  withdrawReason String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  jobPosting JobPosting @relation(fields: [jobPostingId], references: [id], onDelete: Cascade)
  user       User       @relation("applicant", fields: [userId], references: [id], onDelete: Cascade)
  coach      Coach?     @relation("coachApplications", fields: [coachId], references: [id], onDelete: SetNull)
  reviewer   User?      @relation("applicationReviewer", fields: [reviewedBy], references: [id], onDelete: SetNull)

  @@unique([jobPostingId, userId])
  @@index([jobPostingId])
  @@index([userId])
  @@index([coachId])
  @@index([status])
  @@index([createdAt])
  @@index([rating])
  @@map("job_applications")
}

// ============================================================================
// üì¢ ANNOUNCEMENTS
// ============================================================================

model Announcement {
  id     String @id @default(cuid())
  clubId String

  title   String
  content String  @db.Text
  excerpt String?

  priority AnnouncementPriority @default(NORMAL)
  status   AnnouncementStatus   @default(DRAFT)

  publishAt DateTime?
  expiresAt DateTime?

  targetRoles   ClubMemberRole[]
  targetTeamIds String[]
  isPublic      Boolean          @default(false)

  attachments String[]
  imageUrl    String?

  viewCount Int @default(0)

  authorId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club   Club @relation(fields: [clubId], references: [id], onDelete: Cascade)
  author User @relation("announcementCreator", fields: [authorId], references: [id])

  @@index([clubId])
  @@index([status])
  @@index([publishAt])
  @@index([priority])
  @@map("announcements")
}

// ============================================================================
// üí∞ BILLING & SUBSCRIPTION MODELS
// ============================================================================

model Subscription {
  id             String  @id @default(cuid())
  userId         String?
  organisationId String?

  stripeSubscriptionId String? @unique
  stripeCustomerId     String?
  stripePriceId        String?

  status SubscriptionStatus @default(ACTIVE)
  tier   AccountTier        @default(FREE)

  currentPeriodStart DateTime
  currentPeriodEnd   DateTime

  trialStart DateTime?
  trialEnd   DateTime?

  cancelledAt       DateTime?
  cancelledReason   String?
  cancelAtPeriodEnd Boolean   @default(false)

  usageLimit   Int?
  usageCurrent Int  @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user         User?         @relation(fields: [userId], references: [id], onDelete: Cascade)
  organisation Organisation? @relation(fields: [organisationId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([organisationId])
  @@index([status])
  @@index([currentPeriodEnd])
  @@map("subscriptions")
}

model Payment {
  id     String  @id @default(cuid())
  userId String?

  amount   Float
  currency String @default("GBP")

  status PaymentStatus @default(PENDING)
  type   PaymentType   @default(SUBSCRIPTION)

  stripePaymentIntentId String? @unique
  stripeChargeId        String?

  description String?
  metadata    Json?

  refundedAmount Float?
  refundedAt     DateTime?
  refundReason   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([status])
  @@index([type])
  @@index([createdAt])
  @@map("payments")
}

model Invoice {
  id     String @id @default(cuid())
  userId String

  invoiceNumber String @unique
  amount        Float
  tax           Float?
  total         Float
  currency      String @default("GBP")

  issuedAt DateTime
  dueAt    DateTime
  paidAt   DateTime?

  status String @default("ISSUED")

  lineItems Json?

  pdfUrl          String?
  stripeInvoiceId String?

  remindersSent Int       @default(0)
  lastReminder  DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([dueAt])
  @@index([invoiceNumber])
  @@map("invoices")
}

// ============================================================================
// ü§ù SPONSORS
// ============================================================================

model Sponsor {
  id             String @id @default(cuid())
  organisationId String

  name        String
  logo        String?
  website     String?
  description String? @db.Text

  contactName  String?
  contactEmail String?
  contactPhone String?

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organisation Organisation  @relation(fields: [organisationId], references: [id], onDelete: Cascade)
  clubSponsors ClubSponsor[]

  @@index([organisationId])
  @@index([isActive])
  @@map("sponsors")
}

model ClubSponsor {
  id        String @id @default(cuid())
  clubId    String
  sponsorId String

  type      String
  value     Float?
  currency  String    @default("GBP")
  startDate DateTime
  endDate   DateTime?

  deliverables Json?

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club    Club    @relation(fields: [clubId], references: [id], onDelete: Cascade)
  sponsor Sponsor @relation(fields: [sponsorId], references: [id], onDelete: Cascade)

  @@unique([clubId, sponsorId, type])
  @@index([clubId])
  @@index([sponsorId])
  @@map("club_sponsors")
}

// ============================================================================
// üì± NOTIFICATIONS & MESSAGING
// ============================================================================

model Notification {
  id     String @id @default(cuid())
  userId String

  title   String
  message String @db.Text
  type    String

  read   Boolean   @default(false)
  readAt DateTime?

  link     String?
  metadata Json?

  emailSent Boolean @default(false)
  pushSent  Boolean @default(false)

  scheduledFor DateTime?

  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([read])
  @@index([type])
  @@index([createdAt])
  @@map("notifications")
}

model NotificationPreference {
  id     String @id @default(cuid())
  userId String @unique

  emailMatches   Boolean @default(true)
  emailTeam      Boolean @default(true)
  emailCoach     Boolean @default(true)
  emailTraining  Boolean @default(true)
  emailNews      Boolean @default(false)
  emailMarketing Boolean @default(false)
  emailJobs      Boolean @default(true)
  emailMedia     Boolean @default(true)

  pushMatches  Boolean @default(true)
  pushTeam     Boolean @default(true)
  pushTraining Boolean @default(true)
  pushChat     Boolean @default(true)
  pushJobs     Boolean @default(true)
  pushMedia    Boolean @default(true)

  smsMatches Boolean @default(false)
  smsUrgent  Boolean @default(false)

  quietHoursStart String?
  quietHoursEnd   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("notification_preferences")
}

// ============================================================================
// üí¨ CHAT SYSTEM
// ============================================================================

model Chat {
  id String @id @default(cuid())

  type ChatType @default(DIRECT)
  name String?

  teamId String?
  clubId String?

  isArchived Boolean @default(false)
  isMuted    Boolean @default(false)

  lastMessageAt      DateTime?
  lastMessagePreview String?

  createdBy String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  creator  User         @relation("chatCreator", fields: [createdBy], references: [id])
  members  ChatMember[]
  messages Message[]

  @@index([type])
  @@index([teamId])
  @@index([clubId])
  @@index([lastMessageAt])
  @@map("chats")
}

model Message {
  id       String @id @default(cuid())
  senderId String
  chatId   String

  content String @db.Text

  attachments Json?

  readBy   String[]  @default([])
  editedAt DateTime?

  replyToId String?

  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sender User @relation(fields: [senderId], references: [id], onDelete: Cascade)
  chat   Chat @relation(fields: [chatId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([chatId])
  @@index([createdAt])
  @@map("messages")
}

model ChatMember {
  id     String @id @default(cuid())
  userId String
  chatId String

  role     String    @default("MEMBER")
  joinedAt DateTime  @default(now())
  leftAt   DateTime?

  isMuted     Boolean   @default(false)
  lastReadAt  DateTime?
  unreadCount Int       @default(0)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  chat Chat @relation(fields: [chatId], references: [id], onDelete: Cascade)

  @@unique([userId, chatId])
  @@index([userId])
  @@index([chatId])
  @@map("chat_members")
}

// ============================================================================
// üë• SOCIAL & GAMIFICATION
// ============================================================================

model Follow {
  id          String @id @default(cuid())
  followerId  String
  followingId String

  createdAt DateTime @default(now())

  follower  User @relation("follower", fields: [followerId], references: [id], onDelete: Cascade)
  following User @relation("following", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
  @@map("follows")
}

model UserBlock {
  id        String @id @default(cuid())
  blockerId String
  blockedId String

  reason String?

  createdAt DateTime @default(now())

  blocker User @relation("blocker", fields: [blockerId], references: [id], onDelete: Cascade)
  blocked User @relation("blocked", fields: [blockedId], references: [id], onDelete: Cascade)

  @@unique([blockerId, blockedId])
  @@index([blockerId])
  @@map("user_blocks")
}

model SocialAction {
  id     String @id @default(cuid())
  userId String

  type         String
  resourceId   String
  resourceType String

  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, type, resourceId, resourceType])
  @@index([userId])
  @@index([resourceType, resourceId])
  @@map("social_actions")
}

model Achievement {
  id String @id @default(cuid())

  userId   String?
  playerId String?
  coachId  String?

  type        String
  title       String
  description String? @db.Text
  icon        String?

  progress Int     @default(100)
  tier     String?

  unlockedAt DateTime @default(now())

  user   User?   @relation("achievementUser", fields: [userId], references: [id], onDelete: Cascade)
  player Player? @relation("achievementPlayer", fields: [playerId], references: [id], onDelete: Cascade)
  coach  Coach?  @relation("achievementCoach", fields: [coachId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([playerId])
  @@index([coachId])
  @@index([type])
  @@map("achievements")
}

model Badge {
  id String @id @default(cuid())

  userId   String?
  playerId String?

  name        String
  description String?
  icon        String?
  category    String?

  rarity String @default("COMMON")

  awardedAt DateTime @default(now())

  user   User?   @relation("badgeUser", fields: [userId], references: [id], onDelete: Cascade)
  player Player? @relation("badgePlayer", fields: [playerId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([playerId])
  @@index([category])
  @@map("badges")
}

// ============================================================================
// üîå API & INTEGRATIONS
// ============================================================================

model Webhook {
  id             String @id @default(cuid())
  organisationId String

  name   String?
  event  WebhookEvent
  url    String

  isActive Boolean @default(true)
  secret   String?

  headers Json?

  maxRetries   Int @default(3)
  retryDelayMs Int @default(1000)

  failureCount  Int       @default(0)
  lastFailedAt  DateTime?
  lastSuccessAt DateTime?
  lastError     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  organisation Organisation      @relation(fields: [organisationId], references: [id], onDelete: Cascade)
  deliveries   WebhookDelivery[]

  @@index([organisationId])
  @@index([event])
  @@index([isActive])
  @@map("webhooks")
}

model WebhookDelivery {
  id        String @id @default(cuid())
  webhookId String

  event    WebhookEvent
  payload  Json
  response Json?

  statusCode   Int?
  success      Boolean
  errorMessage String?
  durationMs   Int?

  attemptNumber Int @default(1)

  createdAt DateTime @default(now())

  webhook Webhook @relation(fields: [webhookId], references: [id], onDelete: Cascade)

  @@index([webhookId])
  @@index([success])
  @@index([createdAt])
  @@map("webhook_deliveries")
}

model ApiUsageMetrics {
  id             String @id @default(cuid())
  organisationId String

  date DateTime @db.Date

  callsCount          Int    @default(0)
  averageResponseTime Float?
  errorCount          Int    @default(0)
  bandwidthBytes      BigInt @default(0)

  endpointBreakdown Json?

  updatedAt DateTime @updatedAt

  organisation Organisation @relation(fields: [organisationId], references: [id], onDelete: Cascade)

  @@unique([organisationId, date])
  @@index([organisationId])
  @@index([date])
  @@map("api_usage_metrics")
}

model QuotaUsage {
  id             String @id @default(cuid())
  organisationId String

  usersUsed             Int @default(0)
  teamsUsed             Int @default(0)
  storageUsedMb         Int @default(0)
  apiCallsUsedThisMonth Int @default(0)
  matchesThisMonth      Int @default(0)
  mediaStorageUsedMb    Int @default(0)

  monthlyResetDate DateTime?

  updatedAt DateTime @updatedAt

  organisation Organisation @relation(fields: [organisationId], references: [id], onDelete: Cascade)

  @@index([organisationId])
  @@map("quota_usage")
}

// ============================================================================
// üîÑ BACKUP & MAINTENANCE
// ============================================================================

model DatabaseBackup {
  id             String @id @default(cuid())
  organisationId String

  type   String @default("FULL")
  size   Int
  status String @default("COMPLETED")

  backupUrl String?
  checksum  String?
  expiresAt DateTime

  tablesIncluded String[]
  rowsCaptured   Int?

  createdAt DateTime @default(now())

  organisation Organisation @relation(fields: [organisationId], references: [id], onDelete: Cascade)

  @@index([organisationId])
  @@index([expiresAt])
  @@index([status])
  @@map("database_backups")
}
