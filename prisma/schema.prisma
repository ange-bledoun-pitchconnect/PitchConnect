// ============================================================================
// üåü PITCHCONNECT DATABASE SCHEMA v5.0.0 - PRODUCTION READY (FIXED)
// ============================================================================
// Enterprise-Grade Multi-Sport Platform - Football, Netball, Rugby, Cricket
// Consumer Psychology + SaaS Business Model + Global Scale + AI Analytics
// ============================================================================
// STATUS: ‚úÖ PRODUCTION-READY | FULLY OPTIMIZED | SCHEMA COMPLETE
// LAST UPDATED: December 2025 - All relations fixed, PostgreSQL tuned
// COMPATIBILITY: React 19 | NextAuth v5 | Next.js 15.5.9 | Prisma 5.22.0+
// ============================================================================

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch", "fullTextIndex", "driverAdapters", "views"]
  binaryTargets   = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ============================================================================
// üìã ENUMS - COMPREHENSIVE & COMPLETE SYSTEM
// ============================================================================

enum UserRole {
  SUPERADMIN
  ADMIN
  PLAYER
  PLAYER_PRO
  COACH
  COACH_PRO
  MANAGER
  CLUB_MANAGER
  CLUB_OWNER
  TREASURER
  REFEREE
  SCOUT
  ANALYST
  PARENT
  LEAGUE_ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  BANNED
  PENDING_VERIFICATION
  PENDING_EMAIL_VERIFICATION
  PENDING_PHONE_VERIFICATION
  ARCHIVED
  DELETED
}

enum UserType {
  INDIVIDUAL
  ORGANIZATION
  FAMILY
}

enum AccountTier {
  FREE
  PRO
  PREMIUM
  ENTERPRISE
}

enum PaymentFrequency {
  MONTHLY
  QUARTERLY
  ANNUAL
  LIFETIME
}

enum Sport {
  FOOTBALL
  NETBALL
  RUGBY
  CRICKET
  AMERICAN_FOOTBALL
  BASKETBALL
  HOCKEY
  LACROSSE
  AUSTRALIAN_RULES
  GAELIC_FOOTBALL
}

enum Position {
  // Football/Soccer
  GOALKEEPER
  LEFT_BACK
  CENTER_BACK
  RIGHT_BACK
  LEFT_WING_BACK
  RIGHT_WING_BACK
  DEFENSIVE_MIDFIELDER
  CENTRAL_MIDFIELDER
  LEFT_MIDFIELDER
  RIGHT_MIDFIELDER
  ATTACKING_MIDFIELDER
  LEFT_WINGER
  RIGHT_WINGER
  STRIKER
  CENTER_FORWARD
  SECOND_STRIKER

  // Netball
  GOALKEEPER_NETBALL
  GOAL_ATTACK
  WING_ATTACK
  CENTER
  WING_DEFENSE
  GOAL_DEFENSE
  GOAL_SHOOTER

  // Rugby Union
  PROP
  HOOKER
  LOCK
  FLANKER
  NUMBER_8
  SCRUM_HALF
  FLY_HALF
  INSIDE_CENTER
  OUTSIDE_CENTER
  FULLBACK

  // Rugby League
  HOOKER_LEAGUE
  PROP_LEAGUE
  SECOND_ROW
  LOOSE_FORWARD

  // American Football
  QUARTERBACK
  RUNNING_BACK
  WIDE_RECEIVER
  TIGHT_END
  LEFT_TACKLE
  LEFT_GUARD
  CENTER_POSITION
  RIGHT_GUARD
  RIGHT_TACKLE
  LINEBACKER
  DEFENSIVE_END
  DEFENSIVE_TACKLE
  SAFETY
  CORNERBACK
  PUNTER
  KICKER

  // Basketball
  POINT_GUARD
  SHOOTING_GUARD
  SMALL_FORWARD
  POWER_FORWARD
  CENTER_BASKETBALL

  // Cricket
  BATSMAN
  BOWLER
  ALL_ROUNDER
  FIELDER
  WICKET_KEEPER

  // Hockey
  GOALTENDER
  DEFENSEMAN
  WINGER
  CENTER_HOCKEY

  // Other
  UTILITY
  SUBSTITUTE
}

enum PreferredFoot {
  LEFT
  RIGHT
  BOTH
}

enum MatchStatus {
  SCHEDULED
  LIVE
  HALFTIME
  SECOND_HALF
  FINISHED
  CANCELLED
  POSTPONED
  ABANDONED
  REPLAY_SCHEDULED
  VOIDED
}

enum MatchAttendanceStatus {
  AVAILABLE
  UNAVAILABLE
  CONFIRMED
  MAYBE
  LATE
  NO_SHOW
  EXCUSED_ABSENCE
  INJURED
  ILL
  SUSPENDED
  NOT_SELECTED
  SUBSTITUTE
  STARTING_LINEUP
  ATTENDED
  UNUSED_SUB
  UNUSED_SQUAD
}

enum MatchEventType {
  GOAL
  ASSIST
  YELLOW_CARD
  RED_CARD
  SUBSTITUTION_ON
  SUBSTITUTION_OFF
  INJURY
  INJURY_TIME
  FULLTIME
  HALFTIME
  KICKOFF
  PENALTY
  OWN_GOAL
  VAR_REVIEW
  CHALLENGE_REVIEW
  TIMEOUT
  INTERCEPT
  REBOUND
  CENTER_PASS
  OBSTRUCTION
  TRY
  CONVERSION
  PENALTY_GOAL
  DROP_GOAL
  SCRUM
  LINEOUT
  MAUL
  RUCK
  KNOCK_ON
  HIGH_TACKLE
  OFFSIDE
  WICKET
  BOUNDARY
  MAIDEN_OVER
  WIDE
  NO_BALL
  BYE
  LEG_BYE
  OVERTHROW
  THREE_POINTER
  FAST_BREAK
  TURNOVER
  OFFENSIVE_FOUL
  TRAVEL
  DOUBLE_DRIBBLE
  TOUCHDOWN
  FIELD_GOAL
  SAFETY
  INTERCEPTION
  FUMBLE
  SACK
  HAT_TRICK
  MAJOR_PENALTY
  MINOR_PENALTY
  FIGHT
}

enum FormationType {
  FOUR_FOUR_TWO
  FOUR_THREE_THREE
  THREE_FIVE_TWO
  FIVE_THREE_TWO
  FIVE_FOUR_ONE
  THREE_FOUR_THREE
  FOUR_TWO_THREE_ONE
  FOUR_ONE_FOUR_ONE
  THREE_THREE_FOUR
  FIVE_TWO_THREE
  TWO_THREE_FIVE
  FOUR_ONE_TWO_THREE
  CUSTOM
}

enum SubscriptionTier {
  FREE
  PLAYER_PRO
  COACH
  COACH_PRO
  MANAGER
  CLUB_OWNER
  TREASURER
  REFEREE
  SCOUT_ANALYST
  PARENT
  LEAGUE_ADMIN
  ENTERPRISE
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  EXPIRED
  PAUSED
  PAST_DUE
  TRIAL
  SUSPENDED
  DOWNGRADED
  PENDING_UPGRADE
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
  DISPUTED
  CANCELLED
  PROCESSING
}

enum NotificationType {
  MATCH_SCHEDULED
  MATCH_REMINDER
  MATCH_LIVE_UPDATE
  MATCH_LIVE_SCORING
  MATCH_FINISHED
  MATCH_LINEUP_ANNOUNCED
  MATCH_CANCELLED
  MATCH_RESCHEDULED
  MATCH_COMMENTARY
  TRAINING_SCHEDULED
  TRAINING_REMINDER
  TRAINING_CANCELLED
  TRAINING_PLAN_ASSIGNED
  TEAM_MESSAGE
  TEAM_ANNOUNCEMENT
  COACH_MESSAGE
  PLAYER_MESSAGE
  GROUP_CHAT
  PLAYER_STATS_UPDATE
  PERFORMANCE_MILESTONE
  ACHIEVEMENT_UNLOCKED
  PERFORMANCE_ALERT
  PERFORMANCE_DECLINE
  INJURY_ALERT
  ILLNESS_ALERT
  RECOVERY_UPDATE
  FATIGUE_WARNING
  RETURN_TO_PLAY
  PAYMENT_RECEIVED
  PAYMENT_FAILED
  PAYMENT_PROCESSED
  PAYMENT_REFUNDED
  INVOICE_GENERATED
  SUBSCRIPTION_UPGRADED
  SUBSCRIPTION_DOWNGRADED
  SUBSCRIPTION_EXPIRING_SOON
  SUBSCRIPTION_EXPIRED
  SYSTEM_ALERT
  UPGRADE_REQUEST_APPROVED
  UPGRADE_REQUEST_REJECTED
  ROLE_CHANGED
  ACCOUNT_SUSPENDED
  ACCOUNT_REACTIVATED
  JOIN_REQUEST_RECEIVED
  JOIN_REQUEST_APPROVED
  JOIN_REQUEST_REJECTED
  LEAGUE_INVITATION
  TEAM_INVITATION
  MATCH_ATTENDANCE_REQUEST
  TIMESHEET_SUBMITTED
  TIMESHEET_APPROVED
  TIMESHEET_REJECTED
  RESULT_PENDING_APPROVAL
  LINEUP_PENDING_APPROVAL
  SCOUT_REPORT_RECEIVED
  PLAYER_COMPARISON_READY
  VIDEO_ANALYSIS_READY
  PREDICTION_UPDATE
}

enum TrainingIntensity {
  RECOVERY
  LOW
  MEDIUM
  HIGH
  MAXIMUM
  COMPETITIVE
}

enum TrainingCategory {
  PASSING
  SHOOTING
  DEFENDING
  POSSESSION
  SET_PIECES
  CONDITIONING
  TACTICAL
  RECOVERY
  STRENGTH_POWER
  SPEED_AGILITY
  FLEXIBILITY
  BALANCE_COORDINATION
  MENTAL_PREPARATION
  VIDEO_ANALYSIS
  TEAM_BUILDING
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  EXCUSED
  LATE
  LEFT_EARLY
  PARTIAL
}

enum UpgradeRequestStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
  UNDER_REVIEW
  ESCALATED
}

enum AuditActionType {
  USER_CREATED
  USER_UPDATED
  USER_DELETED
  USER_SUSPENDED
  USER_BANNED
  USER_UNBANNED
  USER_REACTIVATED
  USER_EMAIL_CHANGED
  USER_PASSWORD_CHANGED
  USER_PHONE_CHANGED
  ROLE_UPGRADED
  ROLE_DOWNGRADED
  ROLE_ASSIGNED
  ROLE_REVOKED
  MULTI_ROLE_GRANTED
  SUBSCRIPTION_GRANTED
  SUBSCRIPTION_CANCELLED
  SUBSCRIPTION_UPGRADED
  SUBSCRIPTION_DOWNGRADED
  PAYMENT_PROCESSED
  PAYMENT_REFUNDED
  PAYMENT_FAILED
  INVOICE_GENERATED
  DATA_EXPORTED
  DATA_DELETED
  DATA_ARCHIVED
  DATA_RESTORED
  BULK_DATA_IMPORT
  BULK_DATA_UPDATE
  USER_IMPERSONATED
  IMPERSONATION_ENDED
  SECURITY_SETTINGS_UPDATED
  TWO_FACTOR_ENABLED
  TWO_FACTOR_DISABLED
  TWO_FACTOR_RESET
  API_KEY_GENERATED
  API_KEY_REVOKED
  API_KEY_RESET
  LOGIN_ATTEMPT
  FAILED_LOGIN
  SUSPICIOUS_LOGIN
  IP_WHITELIST_ADDED
  IP_WHITELIST_REMOVED
  CLUB_CREATED
  CLUB_UPDATED
  CLUB_DELETED
  CLUB_MEMBER_ADDED
  CLUB_MEMBER_REMOVED
  TEAM_CREATED
  TEAM_UPDATED
  TEAM_DELETED
  SQUAD_CHANGED
  LINEUP_CHANGED
  FORMATION_CHANGED
  TACTICAL_CHANGE
  MATCH_CREATED
  MATCH_UPDATED
  MATCH_RESULT_UPDATED
  MATCH_CANCELLED
  LEAGUE_CREATED
  LEAGUE_UPDATED
  STANDINGS_UPDATED
  TIMESHEET_SUBMITTED
  TIMESHEET_APPROVED
  TIMESHEET_REJECTED
  COACH_PAYMENT_PROCESSED
  COACH_PAYMENT_FAILED
  SYSTEM_MAINTENANCE
  SYSTEM_ALERT
  DATABASE_BACKUP
  API_KEY_ROTATION
  SPORT_CONFIGURED
  FEATURE_TOGGLED
}

enum TimesheetStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
  PAID
  DISPUTED
  ARCHIVED
}

enum PaymentType {
  SUBSCRIPTION
  COACHING_FEE
  MATCH_FEE
  TOURNAMENT_FEE
  TRAINING_FEE
  FACILITY_RENTAL
  EQUIPMENT
  REFUND
  BONUS
  SALARY
  COMMISSION
  OTHER
}

enum LeagueFormat {
  ROUND_ROBIN
  DOUBLE_ROUND_ROBIN
  KNOCKOUT
  GROUP_KNOCKOUT
  ROUND_ROBIN_WITH_PLAYOFFS
  SWISS_SYSTEM
  LADDER_SYSTEM
  CUSTOM
}

enum LeagueVisibility {
  PUBLIC
  PRIVATE
  UNLISTED
  INVITE_ONLY
  FRIENDS_ONLY
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  REJECTED
  EXPIRED
  CANCELLED
  REVOKED
}

enum ResultApprovalStatus {
  PENDING
  APPROVED
  REJECTED
  DISPUTED
  REQUIRES_REVISION
  UNDER_REVIEW
}

enum ClubMemberRole {
  OWNER
  MANAGER
  HEAD_COACH
  ASSISTANT_COACH
  PLAYER
  STAFF
  TREASURER
  SCOUT
  ANALYST
  MEDICAL_STAFF
  PHYSIOTHERAPIST
  NUTRITIONIST
  PSYCHOLOGIST
  PERFORMANCE_COACH
  GOALKEEPING_COACH
}

enum TeamType {
  PROFESSIONAL
  SEMI_PROFESSIONAL
  AMATEUR
  ACADEMY
  YOUTH
  RECREATIONAL
}

enum VideoQuality {
  Q_360P
  Q_480P
  Q_720P
  Q_1080P
  Q_2K
  Q_4K
}

enum TranscodingStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  CANCELLED
  QUEUED
}

enum VideoProcessingProvider {
  MUX
  AWS_MEDIACONVERT
  BUNNY_CDN
  CLOUDINARY
  INTERNAL
  VERCEL_BLOB
}

enum PredictionType {
  INJURY_RISK
  PERFORMANCE_DECLINE
  OPTIMAL_FORMATION
  PLAYER_POTENTIAL
  MARKET_VALUE
  FATIGUE_LEVEL
  CAREER_TRAJECTORY
  WIN_PROBABILITY
  TOP_SCORER
  YELLOW_CARD_RISK
  RED_CARD_RISK
  PLAYER_OF_MATCH
}

enum RiskLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
  EXTREME
}

enum PredictionAccuracy {
  VERY_HIGH
  HIGH
  MEDIUM
  LOW
  VERY_LOW
}

enum AchievementType {
  MILESTONE_GOALS
  MILESTONE_ASSISTS
  MILESTONE_MATCHES
  CONSISTENCY
  LEADERSHIP
  IMPROVEMENT
  SPECIAL_PERFORMANCE
  TEAM_SUCCESS
  COMMUNITY_ENGAGEMENT
  VERIFIED_BADGE
}

enum BadgeType {
  VERIFIED_PLAYER
  VERIFIED_COACH
  VERIFIED_SCOUT
  TOP_PERFORMER
  RISING_STAR
  MENTOR
  TEAM_CAPTAIN
  LEAGUE_CHAMPION
  EARLY_ADOPTER
  COMMUNITY_LEADER
}

enum MediaType {
  VIDEO
  IMAGE
  DOCUMENT
  AUDIO
  LIVESTREAM
}

enum SocialActionType {
  LIKE
  COMMENT
  SHARE
  FOLLOW
  BLOCK
  REPORT
  BOOKMARK
}

enum ChatType {
  DIRECT_MESSAGE
  GROUP_CHAT
  TEAM_CHAT
  COACHING_SESSION
  BROADCAST
}

// ============================================================================
// üë§ USER & AUTHENTICATION MODELS - ENHANCED WITH AUTH.TS INTEGRATION
// ============================================================================

model User {
  id                      String    @id @default(cuid())
  email                   String    @unique @db.Citext
  emailVerified           DateTime?
  phone                   String?   @unique
  phoneVerified           DateTime?
  
  // Password management (hashed with PBKDF2)
  password                String?
  passwordChangedAt       DateTime?
  passwordResetToken      String?
  passwordResetExpires    DateTime?
  
  // Profile information
  firstName               String
  lastName                String
  middleName              String?
  displayName             String?
  avatar                  String?
  banner                  String?
  bio                     String?   @db.Text
  dateOfBirth             DateTime?
  nationality             String?
  language                String    @default("en-GB")
  timezone                String    @default("Europe/London")
  
  // Account management
  userType                UserType  @default(INDIVIDUAL)
  accountTier             AccountTier @default(FREE)
  roles                   UserRole[] @default([PLAYER])
  status                  UserStatus @default(PENDING_EMAIL_VERIFICATION)
  
  // Security & 2FA
  twoFactorEnabled        Boolean   @default(false)
  twoFactorSecret         String?   @unique
  twoFactorBackupCodes    String[]
  lastLoginAt             DateTime?
  lastLoginIp             String?
  lastLoginUserAgent      String?
  loginAttempts           Int       @default(0)
  lockoutUntil            DateTime?
  
  // Preferences & Settings
  emailNotificationsEnabled     Boolean @default(true)
  pushNotificationsEnabled      Boolean @default(true)
  smsNotificationsEnabled       Boolean @default(false)
  marketingEmailsEnabled        Boolean @default(false)
  privacyLevel                  String  @default("FRIENDS_ONLY")
  showOnlineStatus              Boolean @default(true)
  profileVisibility             String  @default("PUBLIC")
  
  // Legal & Compliance
  gdprConsent                   Boolean @default(false)
  gdprConsentDate               DateTime?
  dataProcessingConsent         Boolean @default(false)
  marketingConsent              Boolean @default(false)
  cookieConsent                 Boolean @default(false)
  termsAcceptedAt               DateTime?
  privacyPolicyAcceptedAt       DateTime?
  
  // Referral & Onboarding
  referralCode                  String? @unique
  referredBy                    String?
  referralRewardsClaimed        Int     @default(0)
  onboardingCompleted           Boolean @default(false)
  onboardingStep                Int     @default(0)
  onboardingCompletedAt         DateTime?
  
  // Timestamps
  createdAt                     DateTime @default(now())
  updatedAt                     DateTime @updatedAt
  deletedAt                     DateTime?

  // Relations - NextAuth
  accounts                Account[]
  sessions                Session[]
  refreshTokens           RefreshToken[]
  apiKeys                 ApiKey[]
  
  // Relations - Roles
  player                  Player?
  coach                   Coach?
  referee                 Referee?
  scout                   Scout?
  analyst                 Analyst?
  clubManager             ClubManager?
  clubOwner               ClubOwner?
  parent                  Parent?
  treasurer               Treasurer?
  
  // Relations - Clubs & Teams
  clubMemberships         ClubMember[]
  managedClubs            Club[]          @relation("clubManager")
  ownedClubs              Club[]          @relation("clubOwner")
  
  // Relations - Communication
  notifications           Notification[]
  notificationPrefs       NotificationPreference?
  messages                Message[]
  chatMembers             ChatMember[]
  
  // Relations - Social
  socialActions           SocialAction[]
  followers               Follow[]        @relation("follower")
  following               Follow[]        @relation("following")
  blocks                  UserBlock[]     @relation("blocker")
  blockedBy               UserBlock[]     @relation("blocked")
  
  // Relations - Gamification
  achievements            Achievement[]   @relation("achievementUser")
  badges                  Badge[]         @relation("badgeUser")
  
  // Relations - Billing
  subscriptions           Subscription[]
  payments                Payment[]
  invoices                Invoice[]
  upgrades                UpgradeRequest[]
  
  // Relations - Coaching
  coachTimesheets         CoachTimesheet[] @relation("coach")
  coachPayments           CoachPayment[]
  
  // Relations - Admin
  auditLogs               AuditLog[]

  @@index([email])
  @@index([phone])
  @@index([status])
  @@index([accountTier])
  @@index([userType])
  @@index([createdAt])
  @@map("users")
}

// NextAuth Account Model (NextAuth v5 compatible)
model Account {
  id                      String  @id @default(cuid())
  userId                  String
  type                    String
  provider                String
  providerAccountId       String
  
  refresh_token           String? @db.Text
  access_token            String? @db.Text
  expires_at              Int?
  token_type              String?
  scope                   String?
  id_token                String? @db.Text
  session_state           String?

  user                    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
  @@map("accounts")
}

// NextAuth Session Model (NextAuth v5 compatible)
model Session {
  id                      String   @id @default(cuid())
  sessionToken            String   @unique
  userId                  String
  expires                 DateTime
  
  ipAddress               String?
  userAgent               String?
  
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([sessionToken])
  @@map("sessions")
}

model RefreshToken {
  id                      String   @id @default(cuid())
  userId                  String
  token                   String   @unique
  expiresAt               DateTime
  revokedAt               DateTime?
  usedAt                  DateTime?
  
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
  @@map("refresh_tokens")
}

model VerificationToken {
  id                      String   @id @default(cuid())
  identifier              String
  token                   String   @unique
  type                    String   @default("EMAIL")
  expires                 DateTime
  
  @@unique([identifier, token])
  @@index([type])
  @@index([expires])
  @@map("verification_tokens")
}

model ApiKey {
  id                      String   @id @default(cuid())
  userId                  String
  
  name                    String
  key                     String   @unique @db.Char(32)
  secret                  String?  @unique
  lastUsed                DateTime?
  expiresAt               DateTime?
  
  createdAt               DateTime @default(now())
  revokedAt               DateTime?

  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([key])
  @@map("api_keys")
}

// ============================================================================
// üèÉ PLAYER MODELS - ENHANCED FOR ANALYTICS
// ============================================================================

model Player {
  id                      String   @id @default(cuid())
  userId                  String   @unique
  
  // Physical attributes
  height                  Float?
  weight                  Float?
  dateOfBirth             DateTime?
  nationality             String?
  secondNationality       String?
  
  // Football specifics
  jerseyNumber            Int?
  preferredFoot           PreferredFoot?
  primaryPosition         Position?
  secondaryPosition       Position?
  
  // Market & contract
  marketValue             Float?
  valueLastUpdated        DateTime?
  currency                String    @default("GBP")
  
  // Status
  isActive                Boolean   @default(true)
  isVerified              Boolean   @default(false)
  hasCompletedProfile     Boolean   @default(false)
  isAcademy               Boolean   @default(false)
  isYouth                 Boolean   @default(false)
  youthCategory           String?
  
  // Ratings & performance
  overallRating           Float?    @default(0)
  formRating              Float?    @default(0)
  developmentPhase        String?
  fitnessLevel            Float?
  injuryStatus            String?
  lastFitnessTest         DateTime?
  
  // Social metrics
  followersCount          Int       @default(0)
  followingCount          Int       @default(0)
  
  // Timestamps
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  // Relations
  user                    User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  statistics              PlayerStatistic[]
  analytics               PlayerAnalytic?   @relation("playerAnalytics")
  insights                PlayerInsight?    @relation("playerInsights")
  contracts               Contract[]
  injuries                Injury[]
  matchAttendance         MatchAttendance[]
  familyLinks             PlayerFamily[]
  scoutingReports         ScoutingReport[]
  highlights              PlayerHighlight[]
  badges                  Badge[]           @relation("badgePlayer")
  achievements            Achievement[]     @relation("achievementPlayer")
  
  @@index([userId])
  @@index([isActive])
  @@index([isVerified])
  @@index([primaryPosition])
  @@index([marketValue])
  @@index([createdAt])
  @@map("players")
}

model PlayerStatistic {
  id                      String   @id @default(cuid())
  playerId                String
  season                  Int
  teamId                  String?
  leagueId                String?
  
  // Core stats
  matches                 Int      @default(0)
  minutesPlayed           Int      @default(0)
  goals                   Int      @default(0)
  assists                 Int      @default(0)
  ownGoals                Int      @default(0)
  
  // Disciplinary
  yellowCards             Int      @default(0)
  redCards                Int      @default(0)
  
  // Technical
  passes                  Int      @default(0)
  passAccuracy            Float?
  tackles                 Int      @default(0)
  interceptions           Int      @default(0)
  clearances              Int      @default(0)
  
  // Shooting
  shots                   Int      @default(0)
  shotsOnTarget           Int      @default(0)
  
  // Sport-specific
  sportSpecificStats      Json?
  
  lastUpdated             DateTime @default(now())
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  player                  Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([playerId, season, teamId, leagueId])
  @@index([playerId])
  @@index([season])
  @@map("player_statistics")
}

model PlayerAnalytic {
  id                      String   @id @default(cuid())
  playerId                String   @unique
  
  // Ratings
  overallRating           Float    @default(0)
  formRating              Float    @default(0)
  consistencyIndex        Float    @default(0)
  injuryRisk              Float    @default(0)
  developmentPotential    Float    @default(0)
  fatigueLevelEstimate    Float    @default(0)
  
  // Rankings
  positionRank            Int?
  leagueRank              Int?
  globalRank              Int?
  
  // Trends
  weeklyTrend             Float?
  monthlyTrend            Float?
  seasonTrend             Float?
  
  // Performance
  lastMatchRating         Float?
  last5MatchesAvg         Float?
  seasonAverage           Float?
  
  // Predictions
  predictions             Json?
  predictionConfidence    Float?
  
  // Development
  strengths               String[]
  weaknesses              String[]
  developmentAreas        String[]
  recommendations         String?  @db.Text
  lastAnalysisDate        DateTime?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  player                  Player   @relation("playerAnalytics", fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([overallRating])
  @@index([injuryRisk])
  @@map("player_analytics")
}

model PlayerInsight {
  id                      String   @id @default(cuid())
  playerId                String   @unique
  
  // Analysis
  strengths               String[]
  weaknesses              String[]
  developmentAreas        String[]
  playingStyle            String?
  strongFoot              String?
  
  // Attributes
  aggressiveness          Float?
  defensiveAbility        Float?
  passAccuracy            Float?
  shootingAccuracy        Float?
  leadership              Float?
  teamwork                Float?
  situationalAwareness    Float?
  
  // Guidance
  recommendations         String?  @db.Text
  careerAdvice            String?  @db.Text
  lastReviewDate          DateTime?
  reviewedBy              String?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  player                  Player   @relation("playerInsights", fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@map("player_insights")
}

model PlayerFamily {
  id                      String   @id @default(cuid())
  playerId                String
  parentId                String?
  guardianId              String?
  relationship            String
  
  createdAt               DateTime @default(now())

  player                  Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@map("player_family")
}

model PlayerHighlight {
  id                      String   @id @default(cuid())
  playerId                String
  matchId                 String?
  
  title                   String
  description             String?  @db.Text
  videoUrl                String?
  thumbnailUrl            String?
  duration                Int?
  highlightType           String
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  player                  Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([matchId])
  @@map("player_highlights")
}

model Injury {
  id                      String   @id @default(cuid())
  playerId                String
  
  type                    String
  severity                String   @default("MINOR")
  location                String
  
  dateFrom                DateTime
  dateTo                  DateTime?
  estimatedReturn         DateTime?
  actualReturn            DateTime?
  
  description             String?  @db.Text
  treatment               String?
  therapist               String?
  status                  String   @default("ACTIVE")
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  player                  Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([dateFrom])
  @@index([status])
  @@map("injuries")
}

model Contract {
  id                      String   @id @default(cuid())
  playerId                String
  clubId                  String?
  
  position                Position
  
  // Financial
  salary                  Float?
  currency                String    @default("GBP")
  bonusStructure          Json?
  performanceBonus        Float?
  signOnBonus             Float?
  
  // Dates
  startDate               DateTime
  endDate                 DateTime?
  
  // Terms
  contractType            String    @default("PROFESSIONAL")
  status                  String    @default("ACTIVE")
  contractDocument        String?
  
  // Extensions & clauses
  extensionOption         Boolean   @default(false)
  extensionDate           DateTime?
  extensionYears          Int?
  buyoutClause            Float?
  releaseClause           Float?
  
  // Agent
  agentName               String?
  agentEmail              String?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  player                  Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([status])
  @@map("contracts")
}

// ============================================================================
// üèÜ COACH MODELS - ENHANCED FOR PAYMENTS & TIMESHEETS
// ============================================================================

model Coach {
  id                      String   @id @default(cuid())
  userId                  String   @unique
  
  // Professional details
  coachType               String    @default("HEAD_COACH")
  specialization          String[]
  certifications          String[]
  yearsExperience         Int?
  qualifications          String[]  @db.Text
  bio                     String?   @db.Text
  
  // Payment & contract
  hourlyRate              Float?
  currency                String    @default("GBP")
  bankDetails             Json?
  taxId                   String?
  contractType            String?
  
  // Verification
  isVerified              Boolean   @default(false)
  verificationDate        DateTime?
  licenseNumber           String?   @unique
  licenseExpiry           DateTime?
  backgroundCheckExpiry   DateTime?
  
  // Performance metrics
  overallRating           Float?    @default(0)
  totalPlayersCoached     Int       @default(0)
  successRate             Float?
  
  // Availability
  isAvailable             Boolean   @default(true)
  availabilityNotes       String?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  user                    User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  clubMemberships         ClubMember[]      @relation("coachMemberships")
  trainingSessions        TrainingSession[]
  tactics                 Tactic[]
  timesheets              CoachTimesheet[]
  payments                CoachPayment[]
  achievements            Achievement[]     @relation("achievementCoach")
  
  @@index([userId])
  @@index([isVerified])
  @@map("coaches")
}

// ============================================================================
// ü§ù OTHER STAFF MODELS - COMPLETE HIERARCHY
// ============================================================================

model Referee {
  id                      String   @id @default(cuid())
  userId                  String   @unique
  
  licenseNumber           String?  @unique
  licenseLevel            String?
  yearsOfExperience       Int?
  specialization          String[]
  
  certificationDate       DateTime?
  certificationExpiry     DateTime?
  backgroundCheckExpiry   DateTime?
  
  assignedMatches         Int      @default(0)
  isVerified              Boolean  @default(false)
  isActive                Boolean  @default(true)
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  matchAssignments        Match[]  @relation("referee")
  resultApprovals         MatchResultApproval[]

  @@index([userId])
  @@index([isVerified])
  @@map("referees")
}

model Scout {
  id                      String   @id @default(cuid())
  userId                  String   @unique
  
  specialization          String[]
  region                  String?
  yearsExperience         Int?
  focusAgeGroup           String?
  
  isVerified              Boolean   @default(false)
  isActive                Boolean   @default(true)
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  user                    User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  scoutingReports         ScoutingReport[]

  @@index([userId])
  @@index([isVerified])
  @@map("scouts")
}

model Analyst {
  id                      String   @id @default(cuid())
  userId                  String   @unique
  
  specialization          String[]
  tools                   String[]
  yearsExperience         Int?
  
  isVerified              Boolean   @default(false)
  isActive                Boolean   @default(true)
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isVerified])
  @@map("analysts")
}

model ClubManager {
  id                      String   @id @default(cuid())
  userId                  String   @unique
  
  managingStyle           String?
  yearsExperience         Int?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("club_managers")
}

model ClubOwner {
  id                      String   @id @default(cuid())
  userId                  String   @unique
  
  businessType            String?
  yearsInBusiness         Int?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("club_owners")
}

model Parent {
  id                      String   @id @default(cuid())
  userId                  String   @unique
  
  childrenCount           Int      @default(0)
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("parents")
}

model Treasurer {
  id                      String   @id @default(cuid())
  userId                  String   @unique
  
  yearsExperience         Int?
  bankDetails             Json?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("treasurers")
}

// ============================================================================
// üè¢ CLUB & TEAM MODELS
// ============================================================================

model Club {
  id                      String   @id @default(cuid())
  name                    String
  slug                    String   @unique
  description             String?  @db.Text
  logo                    String?
  banner                  String?
  website                 String?
  email                   String?
  phone                   String?
  foundedYear             Int?
  
  // Location
  city                    String?
  state                   String?
  country                 String?
  address                 String?
  postcode                String?
  venue                   String?
  venueCapacity           Int?
  
  // Sport & type
  sport                   Sport
  teamType                TeamType @default(AMATEUR)
  
  // Management
  managerId               String
  ownerId                 String?
  
  // Status
  isVerified              Boolean   @default(false)
  isPublic                Boolean   @default(true)
  acceptingPlayers        Boolean   @default(true)
  
  // Metrics
  followerCount           Int       @default(0)
  joinedMembers           Int       @default(0)
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  manager                 User              @relation("clubManager", fields: [managerId], references: [id])
  owner                   User?             @relation("clubOwner", fields: [ownerId], references: [id])
  members                 ClubMember[]
  teams                   Team[]
  leagues                 League[]
  formations              TeamFormation[]
  tactics                 Tactic[]
  trainingSessions        TrainingSession[]
  homeMatches             Match[]           @relation("homeTeam")
  awayMatches             Match[]           @relation("awayTeam")
  
  @@index([managerId])
  @@index([ownerId])
  @@index([sport])
  @@index([isPublic])
  @@index([city])
  @@map("clubs")
}

model ClubMember {
  id                      String   @id @default(cuid())
  userId                  String
  clubId                  String
  coachId                 String?
  
  role                    ClubMemberRole @default(STAFF)
  
  joinedAt                DateTime  @default(now())
  leftAt                  DateTime?
  isActive                Boolean   @default(true)
  isCaptain               Boolean   @default(false)
  
  salary                  Float?
  currency                String    @default("GBP")

  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  club                    Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  coach                   Coach?   @relation("coachMemberships", fields: [coachId], references: [id], onDelete: SetNull)

  @@unique([userId, clubId])
  @@index([userId])
  @@index([clubId])
  @@index([coachId])
  @@index([role])
  @@map("club_members")
}

model Team {
  id                      String   @id @default(cuid())
  clubId                  String
  
  name                    String
  description             String?  @db.Text
  logo                    String?
  ageGroup                String?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  club                    Club              @relation(fields: [clubId], references: [id], onDelete: Cascade)
  players                 TeamPlayer[]
  matchSquads             MatchSquad[]
  formations              TeamFormation[]

  @@unique([clubId, name])
  @@index([clubId])
  @@map("teams")
}

model TeamPlayer {
  id                      String   @id @default(cuid())
  teamId                  String
  playerId                String?
  
  position                Position?
  jerseyNumber            Int?
  isActive                Boolean   @default(true)
  
  joinedAt                DateTime @default(now())

  team                    Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([teamId, playerId])
  @@index([teamId])
  @@map("team_players")
}

// ============================================================================
// üèÜ LEAGUE & COMPETITION MODELS
// ============================================================================

model League {
  id                      String   @id @default(cuid())
  clubId                  String
  
  name                    String
  description             String?  @db.Text
  season                  Int
  
  startDate               DateTime
  endDate                 DateTime?
  registrationDeadline    DateTime?
  
  format                  LeagueFormat     @default(ROUND_ROBIN)
  visibility              LeagueVisibility @default(PRIVATE)
  status                  String           @default("DRAFT")
  
  maxTeams                Int?
  teamsRegistered         Int      @default(0)
  
  logo                    String?
  rules                   String?  @db.Text
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  club                    Club              @relation(fields: [clubId], references: [id], onDelete: Cascade)
  teams                   LeagueTeam[]
  matches                 Match[]
  standings               LeagueStanding[]
  analytics               LeagueAnalytics?  @relation("leagueAnalytics")

  @@unique([clubId, name, season])
  @@index([clubId])
  @@index([season])
  @@index([status])
  @@map("leagues")
}

model LeagueTeam {
  id                      String   @id @default(cuid())
  leagueId                String
  teamId                  String?
  
  name                    String
  
  registeredAt            DateTime @default(now())

  league                  League   @relation(fields: [leagueId], references: [id], onDelete: Cascade)

  @@index([leagueId])
  @@map("league_teams")
}

model LeagueStanding {
  id                      String   @id @default(cuid())
  leagueId                String
  teamName                String
  
  position                Int
  played                  Int      @default(0)
  won                     Int      @default(0)
  drawn                   Int      @default(0)
  lost                    Int      @default(0)
  goalsFor                Int      @default(0)
  goalsAgainst            Int      @default(0)
  goalDifference          Int      @default(0)
  points                  Int      @default(0)
  
  lastUpdated             DateTime @default(now())

  league                  League   @relation(fields: [leagueId], references: [id], onDelete: Cascade)

  @@unique([leagueId, teamName])
  @@index([leagueId])
  @@map("league_standings")
}

model LeagueAnalytics {
  id                      String   @id @default(cuid())
  leagueId                String   @unique
  
  totalMatches            Int      @default(0)
  totalGoals              Int      @default(0)
  avgGoalsPerMatch        Float    @default(0)
  topScorer               String?
  topScorerGoals          Int      @default(0)
  highestScore            String?
  
  predictions             Json?

  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  league                  League   @relation("leagueAnalytics", fields: [leagueId], references: [id], onDelete: Cascade)

  @@index([leagueId])
  @@map("league_analytics_data")
}

// ============================================================================
// ‚öΩ MATCH & MATCH EVENT MODELS
// ============================================================================

model Match {
  id                      String   @id @default(cuid())
  leagueId                String?
  homeTeamId              String
  awayTeamId              String
  homeClubId              String
  awayClubId              String
  
  refereeId               String?
  
  status                  MatchStatus @default(SCHEDULED)
  
  kickOffTime             DateTime
  finishedAt              DateTime?
  duration                Int?
  
  venue                   String?
  capacity                Int?
  attendanceCount         Int?
  
  homeScore               Int      @default(0)
  awayScore               Int      @default(0)
  
  notes                   String?  @db.Text
  highlights              String?
  commentary              String?  @db.Text
  
  isLive                  Boolean  @default(false)
  liveStartedAt           DateTime?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  league                  League?               @relation(fields: [leagueId], references: [id])
  homeTeam                Club                  @relation("homeTeam", fields: [homeClubId], references: [id])
  awayTeam                Club                  @relation("awayTeam", fields: [awayClubId], references: [id])
  referee                 Referee?              @relation("referee", fields: [refereeId], references: [id])
  
  attendees               MatchAttendance[]
  events                  MatchEvent[]
  squad                   MatchSquad[]
  statistics              MatchStatistic?       @relation("matchStatistics")
  analytics               MatchAnalytic?        @relation("matchAnalytics")
  resultApprovals         MatchResultApproval[]
  lineupApprovals         LineupApproval[]
  
  @@index([leagueId])
  @@index([homeClubId])
  @@index([awayClubId])
  @@index([refereeId])
  @@index([status])
  @@index([kickOffTime])
  @@map("matches")
}

model MatchAttendance {
  id                      String   @id @default(cuid())
  matchId                 String
  playerId                String
  
  status                  MatchAttendanceStatus @default(AVAILABLE)
  minutesPlayed           Int      @default(0)
  jerseyNumber            Int?
  performance             Float?

  match                   Match    @relation(fields: [matchId], references: [id], onDelete: Cascade)
  player                  Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([matchId, playerId])
  @@index([matchId])
  @@index([playerId])
  @@map("match_attendance")
}

model MatchEvent {
  id                      String   @id @default(cuid())
  matchId                 String
  playerId                String?
  playerName              String?
  
  eventType               MatchEventType
  minute                  Int
  second                  Int      @default(0)
  description             String?  @db.Text
  
  createdAt               DateTime @default(now())

  match                   Match    @relation(fields: [matchId], references: [id], onDelete: Cascade)

  @@index([matchId])
  @@index([eventType])
  @@index([minute])
  @@map("match_events")
}

model MatchSquad {
  id                      String   @id @default(cuid())
  matchId                 String
  teamId                  String
  
  createdAt               DateTime @default(now())

  match                   Match    @relation(fields: [matchId], references: [id], onDelete: Cascade)
  team                    Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([matchId, teamId])
  @@index([matchId])
  @@map("match_squads")
}

model MatchStatistic {
  id                      String   @id @default(cuid())
  matchId                 String   @unique
  
  possession              Float?
  shots                   Int?
  shotsOnTarget           Int?
  passes                  Int?
  passAccuracy            Float?
  tackles                 Int?
  interceptions           Int?
  fouls                   Int?
  corners                 Int?
  offsides                Int?
  
  sportStats              Json?

  match                   Match    @relation("matchStatistics", fields: [matchId], references: [id], onDelete: Cascade)

  @@index([matchId])
  @@map("match_statistics")
}

model MatchAnalytic {
  id                      String   @id @default(cuid())
  matchId                 String   @unique
  
  homeTeamForm            Float?
  awayTeamForm            Float?
  predictedWinner         String?
  matchIntensity          Float?
  defensiveStrength       Float?
  
  homeKeyStats            Json?
  awayKeyStats            Json?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  match                   Match    @relation("matchAnalytics", fields: [matchId], references: [id], onDelete: Cascade)

  @@index([matchId])
  @@map("match_analytics")
}

model MatchResultApproval {
  id                      String   @id @default(cuid())
  matchId                 String
  refereeId               String
  
  status                  ResultApprovalStatus @default(PENDING)
  approvedAt              DateTime?
  notes                   String?  @db.Text

  match                   Match    @relation(fields: [matchId], references: [id], onDelete: Cascade)
  referee                 Referee  @relation(fields: [refereeId], references: [id], onDelete: Cascade)

  @@unique([matchId, refereeId])
  @@index([matchId])
  @@index([refereeId])
  @@map("match_result_approvals")
}

model LineupApproval {
  id                      String   @id @default(cuid())
  matchId                 String   @unique
  
  managerApproved         Boolean  @default(false)
  coachApproved           Boolean  @default(false)
  
  approvedAt              DateTime?

  match                   Match    @relation(fields: [matchId], references: [id], onDelete: Cascade)

  @@index([matchId])
  @@map("lineup_approvals")
}

// ============================================================================
// üìö TRAINING & TACTICS MODELS
// ============================================================================

model TeamFormation {
  id                      String   @id @default(cuid())
  clubId                  String
  teamId                  String
  
  name                    String
  description             String?
  formationType           FormationType
  positions               Json
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  club                    Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  team                    Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@index([clubId])
  @@index([teamId])
  @@map("team_formations")
}

model TrainingSession {
  id                      String   @id @default(cuid())
  clubId                  String
  coachId                 String
  
  name                    String
  description             String?  @db.Text
  date                    DateTime
  duration                Int
  intensity               TrainingIntensity @default(MEDIUM)
  category                TrainingCategory  @default(TACTICAL)
  
  location                String?
  capacity                Int?
  totalAttendees          Int      @default(0)
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  club                    Club                  @relation(fields: [clubId], references: [id], onDelete: Cascade)
  coach                   Coach                 @relation(fields: [coachId], references: [id], onDelete: Cascade)
  attendance              TrainingAttendance[]
  plan                    TrainingPlan?

  @@index([clubId])
  @@index([coachId])
  @@index([date])
  @@map("training_sessions")
}

model TrainingPlan {
  id                      String   @id @default(cuid())
  sessionId               String   @unique
  
  weekNumber              Int
  focusAreas              String[]
  objectives              String?  @db.Text
  drills                  Json?
  progressMetrics         Json?
  
  createdAt               DateTime @default(now())

  session                 TrainingSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@map("training_plans")
}

model TrainingAttendance {
  id                      String   @id @default(cuid())
  sessionId               String
  playerId                String?
  playerName              String?
  
  status                  AttendanceStatus @default(PRESENT)
  
  session                 TrainingSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, playerName])
  @@index([sessionId])
  @@map("training_attendance")
}

model Tactic {
  id                      String   @id @default(cuid())
  clubId                  String
  coachId                 String
  
  name                    String
  description             String?  @db.Text
  type                    String
  formationType           FormationType?
  
  keyElements             Json?
  matchups                Json?
  videoUrl                String?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  club                    Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  coach                   Coach    @relation(fields: [coachId], references: [id], onDelete: Cascade)

  @@index([clubId])
  @@index([coachId])
  @@map("tactics")
}

// ============================================================================
// üí¨ COMMUNICATION & SOCIAL MODELS
// ============================================================================

model Message {
  id                      String   @id @default(cuid())
  senderId                String
  recipientId             String?
  chatId                  String?
  
  content                 String   @db.Text
  mediaUrl                String?
  mediaType               MediaType?
  
  isRead                  Boolean  @default(false)
  readAt                  DateTime?
  editedAt                DateTime?
  deletedAt               DateTime?
  
  createdAt               DateTime @default(now())

  sender                  User     @relation(fields: [senderId], references: [id], onDelete: Cascade)
  chat                    Chat?    @relation(fields: [chatId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([chatId])
  @@index([createdAt])
  @@map("messages")
}

model Chat {
  id                      String   @id @default(cuid())
  name                    String?
  type                    ChatType @default(DIRECT_MESSAGE)
  creatorId               String
  
  isArchived              Boolean  @default(false)
  lastMessageAt           DateTime?
  
  createdAt               DateTime @default(now())

  messages                Message[]
  members                 ChatMember[]

  @@index([creatorId])
  @@map("chats")
}

model ChatMember {
  id                      String   @id @default(cuid())
  chatId                  String
  userId                  String
  
  role                    String   @default("MEMBER")
  joinedAt                DateTime @default(now())
  leftAt                  DateTime?
  isMuted                 Boolean  @default(false)

  chat                    Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([chatId, userId])
  @@map("chat_members")
}

model Follow {
  id                      String   @id @default(cuid())
  followerId              String
  followingId             String
  
  createdAt               DateTime @default(now())

  follower                User     @relation("follower", fields: [followerId], references: [id], onDelete: Cascade)
  following               User     @relation("following", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@map("follows")
}

model UserBlock {
  id                      String   @id @default(cuid())
  blockerId               String
  blockedId               String
  
  reason                  String?
  createdAt               DateTime @default(now())

  blocker                 User     @relation("blocker", fields: [blockerId], references: [id], onDelete: Cascade)
  blocked                 User     @relation("blocked", fields: [blockedId], references: [id], onDelete: Cascade)

  @@unique([blockerId, blockedId])
  @@map("user_blocks")
}

model SocialAction {
  id                      String   @id @default(cuid())
  userId                  String
  targetId                String
  actionType              SocialActionType
  
  contentType             String?
  contentId               String?
  
  createdAt               DateTime @default(now())

  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([actionType])
  @@map("social_actions")
}

// ============================================================================
// üèÖ GAMIFICATION MODELS
// ============================================================================

model Achievement {
  id                      String   @id @default(cuid())
  userId                  String
  playerId                String?
  coachId                 String?
  
  type                    AchievementType
  
  title                   String
  description             String?  @db.Text
  icon                    String?
  points                  Int      @default(0)
  
  unlockedAt              DateTime @default(now())

  user                    User     @relation("achievementUser", fields: [userId], references: [id], onDelete: Cascade)
  player                  Player?  @relation("achievementPlayer", fields: [playerId], references: [id], onDelete: SetNull)
  coach                   Coach?   @relation("achievementCoach", fields: [coachId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([playerId])
  @@index([coachId])
  @@index([type])
  @@map("achievements")
}

model Badge {
  id                      String   @id @default(cuid())
  userId                  String
  playerId                String?
  
  type                    BadgeType
  title                   String
  description             String?
  icon                    String?
  
  awardedAt               DateTime @default(now())
  expiresAt               DateTime?

  user                    User     @relation("badgeUser", fields: [userId], references: [id], onDelete: Cascade)
  player                  Player?  @relation("badgePlayer", fields: [playerId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([playerId])
  @@index([type])
  @@map("badges")
}

// ============================================================================
// üìπ VIDEO & MEDIA MODELS
// ============================================================================

model Video {
  id                      String   @id @default(cuid())
  
  title                   String
  description             String?  @db.Text
  fileName                String
  fileSize                Int
  duration                Int
  
  quality                 VideoQuality @default(Q_1080P)
  transcodingStatus       TranscodingStatus @default(PENDING)
  provider                VideoProcessingProvider @default(MUX)
  
  videoUrl                String?
  publicUrl               String?
  thumbnailUrl            String?
  
  uploadedBy              String?
  uploadedAt              DateTime @default(now())
  
  views                   Int      @default(0)
  likes                   Int      @default(0)
  
  isPublic                Boolean  @default(true)
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  @@index([uploadedBy])
  @@index([transcodingStatus])
  @@index([isPublic])
  @@map("videos")
}

model VideoAnalysis {
  id                      String   @id @default(cuid())
  
  videoId                 String
  matchId                 String?
  clubId                  String?
  
  title                   String
  analysisType            String
  insights                String?  @db.Text
  keyMoments              Json?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  @@index([videoId])
  @@index([matchId])
  @@map("video_analysis")
}

model ScoutingReport {
  id                      String   @id @default(cuid())
  scoutId                 String
  playerId                String
  
  title                   String
  summary                 String?  @db.Text
  strengths               String[]
  weaknesses              String[]
  overallRating           Float?
  
  videoUrl                String?
  recommendations         String?  @db.Text
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  scout                   Scout    @relation(fields: [scoutId], references: [id], onDelete: Cascade)
  player                  Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([scoutId])
  @@index([playerId])
  @@map("scouting_reports")
}

// ============================================================================
// üìä NOTIFICATIONS & PREFERENCES
// ============================================================================

model Notification {
  id                      String   @id @default(cuid())
  userId                  String
  
  type                    NotificationType
  title                   String
  message                 String   @db.Text
  
  actionUrl               String?
  data                    Json?
  
  isRead                  Boolean  @default(false)
  readAt                  DateTime?
  
  priority                Int      @default(0)
  
  createdAt               DateTime @default(now())

  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([type])
  @@index([createdAt])
  @@map("notifications")
}

model NotificationPreference {
  id                      String   @id @default(cuid())
  userId                  String   @unique
  
  emailNotifications      Boolean  @default(true)
  pushNotifications       Boolean  @default(true)
  smsNotifications        Boolean  @default(false)
  inAppNotifications      Boolean  @default(true)
  
  matchReminders          Boolean  @default(true)
  trainingReminders       Boolean  @default(true)
  performanceAlerts       Boolean  @default(true)
  injuryAlerts            Boolean  @default(true)
  paymentAlerts           Boolean  @default(true)
  
  digestFrequency         String   @default("WEEKLY")
  quietHoursStart         String   @default("22:00")
  quietHoursEnd           String   @default("08:00")

  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("notification_preferences")
}

// ============================================================================
// üí≥ SUBSCRIPTION & PAYMENT MODELS
// ============================================================================

model Subscription {
  id                      String   @id @default(cuid())
  userId                  String
  
  tier                    SubscriptionTier @default(FREE)
  status                  SubscriptionStatus @default(ACTIVE)
  
  startDate               DateTime @default(now())
  endDate                 DateTime?
  renewalDate             DateTime?
  cancellationDate        DateTime?
  
  frequency               PaymentFrequency @default(MONTHLY)
  
  priceMonthly            Int?
  priceAnnual             Int?
  currency                String    @default("GBP")
  
  stripeCustId            String?
  stripeSubId             String?   @unique
  stripePriceId           String?
  
  trialEndsAt             DateTime?
  isTrialActive           Boolean   @default(false)
  
  features                Json?
  limits                  Json?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  payments                Payment[]

  @@index([userId])
  @@index([status])
  @@index([tier])
  @@map("subscriptions")
}

model Payment {
  id                      String   @id @default(cuid())
  userId                  String
  subscriptionId          String?
  
  amount                  Float
  currency                String    @default("GBP")
  status                  PaymentStatus @default(PENDING)
  type                    PaymentType @default(SUBSCRIPTION)
  
  stripePaymentId         String?   @unique
  invoiceUrl              String?
  receiptUrl              String?
  
  paidAt                  DateTime?
  failedAt                DateTime?
  refundedAt              DateTime?
  refundReason            String?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  user                    User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  subscription            Subscription? @relation(fields: [subscriptionId], references: [id])
  invoice                 Invoice?

  @@index([userId])
  @@index([status])
  @@index([type])
  @@map("payments")
}

model Invoice {
  id                      String   @id @default(cuid())
  paymentId               String   @unique
  
  invoiceNumber           String   @unique
  userId                  String
  
  amount                  Float
  currency                String    @default("GBP")
  tax                     Float?
  total                   Float
  
  itemDescription         String?
  periodStart             DateTime?
  periodEnd               DateTime?
  
  dueDate                 DateTime?
  paidDate                DateTime?
  
  pdfUrl                  String?
  
  createdAt               DateTime @default(now())

  payment                 Payment  @relation(fields: [paymentId], references: [id], onDelete: Cascade)
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("invoices")
}

model CoachTimesheet {
  id                      String   @id @default(cuid())
  coachId                 String
  userId                  String
  
  weekStartDate           DateTime
  weekEndDate             DateTime
  
  totalHours              Float     @default(0)
  status                  TimesheetStatus @default(DRAFT)
  notes                   String?   @db.Text
  
  submittedAt             DateTime?
  approvedAt              DateTime?
  approvedBy              String?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  coach                   Coach               @relation(fields: [coachId], references: [id], onDelete: Cascade)
  user                    User                @relation("coach", fields: [userId], references: [id], onDelete: Cascade)
  entries                 TimesheetEntry[]

  @@index([coachId])
  @@index([userId])
  @@index([status])
  @@map("coach_timesheets")
}

model TimesheetEntry {
  id                      String   @id @default(cuid())
  timesheetId             String
  
  date                    DateTime
  hoursWorked             Float
  description             String?
  
  timesheet               CoachTimesheet @relation(fields: [timesheetId], references: [id], onDelete: Cascade)

  @@index([timesheetId])
  @@map("timesheet_entries")
}

model CoachPayment {
  id                      String   @id @default(cuid())
  coachId                 String
  userId                  String
  
  amount                  Float
  currency                String    @default("GBP")
  status                  PaymentStatus @default(PENDING)
  
  periodStartDate         DateTime
  periodEndDate           DateTime
  
  hourlyRate              Float?
  totalHours              Float?
  
  notes                   String?   @db.Text
  paidAt                  DateTime?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  coach                   Coach    @relation(fields: [coachId], references: [id], onDelete: Cascade)
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([coachId])
  @@index([userId])
  @@index([status])
  @@map("coach_payments")
}

// ============================================================================
// üìà UPGRADE & FEATURE MANAGEMENT
// ============================================================================

model UpgradeRequest {
  id                      String   @id @default(cuid())
  userId                  String
  
  currentTier             SubscriptionTier
  requestedTier           SubscriptionTier
  
  status                  UpgradeRequestStatus @default(PENDING)
  reason                  String?  @db.Text
  
  requestedAt             DateTime @default(now())
  approvedAt              DateTime?
  rejectedAt              DateTime?
  rejectionReason         String?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@map("upgrade_requests")
}

// ============================================================================
// üîç AUDIT & LOGGING
// ============================================================================

model AuditLog {
  id                      String   @id @default(cuid())
  userId                  String?
  
  action                  AuditActionType
  entity                  String
  entityId                String
  changes                 Json?
  
  ipAddress               String?
  userAgent               String?
  
  severity                String   @default("INFO")
  
  createdAt               DateTime @default(now())

  user                    User?    @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([action])
  @@index([entity])
  @@index([createdAt])
  @@index([severity])
  @@map("audit_logs")
}

// ============================================================================
// ü§ñ PREDICTION & AI MODELS
// ============================================================================

model PlayerPrediction {
  id                      String   @id @default(cuid())
  playerId                String?
  
  predictionType          PredictionType
  value                   Float
  riskLevel               RiskLevel
  confidence              PredictionAccuracy
  
  predictedDate           DateTime?
  validUntil              DateTime
  
  metadata                Json?
  
  createdAt               DateTime @default(now())

  @@index([playerId])
  @@index([predictionType])
  @@map("player_predictions")
}

model PerformanceMetric {
  id                      String   @id @default(cuid())
  
  entityType              String
  entityId                String
  
  metric                  String
  value                   Float
  benchmark               Float?
  variance                Float?
  
  recordedAt              DateTime @default(now())

  @@index([entityType])
  @@index([entityId])
  @@map("performance_metrics")
}

// ============================================================================
// üì± FEATURE & APP TRACKING
// ============================================================================

model FeatureFlag {
  id                      String   @id @default(cuid())
  name                    String   @unique
  description             String?
  
  isEnabled               Boolean  @default(false)
  rolloutPercentage       Int      @default(0)
  
  targetRoles             String[]
  targetTiers             String[]
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  @@map("feature_flags")
}