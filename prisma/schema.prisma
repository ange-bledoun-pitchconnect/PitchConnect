// ============================================================================
// PITCHCONNECT DATABASE SCHEMA (Prisma ORM) - ENHANCED PRODUCTION VERSION
// PostgreSQL via Supabase | TypeScript Strict Mode | Global Scale Ready
// ENHANCED: Multi-sport support for Football, Netball, Rugby, Cricket, American Football, Basketball
// ============================================================================

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch", "fullTextIndex", "driverAdapters"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ============================================================================
// ENUMS - CORE SYSTEM
// ============================================================================

enum UserRole {
  SUPERADMIN
  PLAYER
  PLAYER_PRO
  COACH
  CLUB_MANAGER
  CLUB_OWNER
  LEAGUE_ADMIN
  PARENT
  TREASURER
  REFEREE
  SCOUT
  ANALYST
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  BANNED
  PENDING_VERIFICATION
  ARCHIVED
}

enum TeamType {
  PROFESSIONAL
  SEMI_PROFESSIONAL
  AMATEUR
  YOUTH
  POWERLEAGUE
  ACADEMY
}

// ============================================================================
// MULTI-SPORT ENUMS
// ============================================================================

enum Sport {
  FOOTBALL
  NETBALL
  RUGBY
  CRICKET
  AMERICAN_FOOTBALL
  BASKETBALL
}

enum Position {
  // Football
  GOALKEEPER
  DEFENDER
  MIDFIELDER
  FORWARD

  // Netball
  GOALKEEPER_NETBALL
  GOAL_ATTACK
  WING_ATTACK
  CENTER
  WING_DEFENSE
  GOAL_DEFENSE
  GOAL_SHOOTER

  // Rugby
  PROP
  HOOKER
  LOCK
  FLANKER
  NUMBER_8
  SCRUM_HALF
  FLY_HALF
  INSIDE_CENTER
  OUTSIDE_CENTER
  WINGER
  FULLBACK

  // American Football
  QUARTERBACK
  RUNNING_BACK
  WIDE_RECEIVER
  TACKLE
  GUARD
  CENTER_POSITION
  LINEBACKER
  SAFETY
  CORNERBACK

  // Basketball
  POINT_GUARD
  SHOOTING_GUARD
  SMALL_FORWARD
  POWER_FORWARD
  CENTER_BASKETBALL

  // Cricket
  BATSMAN
  BOWLER
  FIELDER
  WICKET_KEEPER
}

enum PreferredFoot {
  LEFT
  RIGHT
  BOTH
}

enum MatchStatus {
  SCHEDULED
  LIVE
  HALFTIME
  FINISHED
  CANCELLED
  POSTPONED
  ABANDONED
}

enum MatchAttendanceStatus {
  AVAILABLE
  UNAVAILABLE
  CONFIRMED
  MAYBE
  LATE
  NO_SHOW
  EXCUSED_ABSENCE
  INJURED
  ILL
  SUSPENDED
  NOT_SELECTED
  SUBSTITUTE
  STARTING_LINEUP
  ATTENDED
  UNUSED_SUB
}

enum MatchEventType {
  GOAL
  ASSIST
  YELLOW_CARD
  RED_CARD
  SUBSTITUTION_ON
  SUBSTITUTION_OFF
  INJURY
  INJURY_TIME
  FULLTIME
  HALFTIME
  KICKOFF
  PENALTY
  OWN_GOAL
  VAR_REVIEW
  // Netball specific
  INTERCEPT
  REBOUND
  CENTER_PASS
  // Rugby specific
  TRY
  CONVERSION
  PENALTY_GOAL
  DROP_GOAL
  SCRUM
  LINEOUT
  MAUL
  RUCK
  // Cricket specific
  WICKET
  BOUNDARY
  MAIDEN_OVER
  WIDE
  NO_BALL
  // Basketball specific
  THREE_POINTER
  FAST_BREAK
  TURNOVER
  OFFENSIVE_FOUL
  // American Football specific
  TOUCHDOWN
  FIELD_GOAL
  SAFETY
  INTERCEPTION
  FUMBLE
  SACK
}

enum Formation {
  FOUR_FOUR_TWO
  FOUR_THREE_THREE
  THREE_FIVE_TWO
  FIVE_THREE_TWO
  FIVE_FOUR_ONE
  THREE_FOUR_THREE
  FOUR_TWO_THREE_ONE
  FOUR_ONE_FOUR_ONE
  THREE_THREE_FOUR
  FIVE_TWO_THREE
}

enum SubscriptionTier {
  FREE
  PLAYER_PRO
  COACH
  MANAGER
  LEAGUE_ADMIN
  ENTERPRISE
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  EXPIRED
  PAUSED
  PAST_DUE
  TRIAL
  SUSPENDED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
  DISPUTED
  CANCELLED
}

enum NotificationType {
  MATCH_SCHEDULED
  MATCH_REMINDER
  MATCH_LIVE_UPDATE
  TRAINING_SESSION
  TEAM_MESSAGE
  ACHIEVEMENT_UNLOCKED
  PAYMENT_RECEIVED
  PAYMENT_FAILED
  PLAYER_STATS_UPDATE
  SYSTEM_ALERT
  UPGRADE_REQUEST_APPROVED
  UPGRADE_REQUEST_REJECTED
  ROLE_CHANGED
  ACCOUNT_SUSPENDED
  MATCH_ATTENDANCE_REQUEST
  TIMESHEET_APPROVED
  TIMESHEET_REJECTED
  PAYMENT_PROCESSED
  JOIN_REQUEST
  LEAGUE_INVITATION
  PERFORMANCE_ALERT
  INJURY_ALERT
  TEAM_ANNOUNCEMENT
}

enum TrainingIntensity {
  LOW
  MEDIUM
  HIGH
  MAXIMUM
}

enum TrainingCategory {
  PASSING
  SHOOTING
  DEFENDING
  POSSESSION
  SET_PIECES
  CONDITIONING
  TACTICAL
  RECOVERY
  STRENGTH_POWER
  SPEED_AGILITY
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  EXCUSED
  LATE
  LEFT_EARLY
}

enum UpgradeRequestStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
  UNDER_REVIEW
}

enum AuditActionType {
  USER_CREATED
  USER_UPDATED
  USER_DELETED
  USER_SUSPENDED
  USER_BANNED
  USER_UNBANNED
  ROLE_UPGRADED
  ROLE_DOWNGRADED
  SUBSCRIPTION_GRANTED
  SUBSCRIPTION_CANCELLED
  PAYMENT_REFUNDED
  DATA_EXPORTED
  USER_IMPERSONATED
  IMPERSONATION_ENDED
  SECURITY_SETTINGS_UPDATED
  TWO_FACTOR_ENABLED
  TWO_FACTOR_DISABLED
  LOGIN_ATTEMPT
  FAILED_LOGIN
  API_KEY_GENERATED
  API_KEY_REVOKED
  BULK_USER_ACTION
  SYSTEM_MAINTENANCE
  MATCH_RESULT_UPDATED
  SQUAD_CHANGED
  TACTICAL_CHANGE
  SPORT_CONFIGURED
}

enum TimesheetStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
  PAID
  DISPUTED
}

enum PaymentType {
  SUBSCRIPTION
  COACHING_FEE
  MATCH_FEE
  TOURNAMENT_FEE
  REFUND
  BONUS
  SALARY
  OTHER
}

enum LeagueFormat {
  ROUND_ROBIN
  DOUBLE_ROUND_ROBIN
  KNOCKOUT
  GROUP_KNOCKOUT
  ROUND_ROBIN_WITH_PLAYOFFS
  CUSTOM
}

enum LeagueVisibility {
  PUBLIC
  PRIVATE
  UNLISTED
  INVITE_ONLY
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  REJECTED
  EXPIRED
  CANCELLED
}

enum ResultApprovalStatus {
  PENDING
  APPROVED
  REJECTED
  DISPUTED
  REQUIRES_REVISION
}

enum ClubMemberRole {
  OWNER
  MANAGER
  COACH
  ASSISTANT_COACH
  STAFF
  TREASURER
  SCOUT
  ANALYST
  MEDICAL_STAFF
}

enum VideoQuality {
  Q_480P
  Q_720P
  Q_1080P
  Q_4K
}

enum TranscodingStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  CANCELLED
}

enum VideoProcessingProvider {
  MUX
  AWS_MEDIACONVERT
  BUNNY_CDN
  CLOUDINARY
  INTERNAL
}

enum PredictionType {
  INJURY_RISK
  PERFORMANCE_DECLINE
  OPTIMAL_FORMATION
  PLAYER_POTENTIAL
  MARKET_VALUE
  FATIGUE_LEVEL
  CAREER_TRAJECTORY
}

enum RiskLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum PredictionAccuracy {
  VERY_HIGH
  HIGH
  MEDIUM
  LOW
}

// ============================================================================
// USER & AUTHENTICATION MODELS - ENHANCED
// ============================================================================

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  emailVerified DateTime?
  password      String?
  firstName     String
  lastName      String
  phoneNumber   String?
  avatar        String?
  dateOfBirth   DateTime?
  nationality   String?
  language      String    @default("en-GB")

  roles  UserRole[]
  status UserStatus @default(PENDING_VERIFICATION)

  isSuperAdmin  Boolean   @default(false)
  lastLoginIp   String?
  loginAttempts Int       @default(0)
  lockedUntil   DateTime?
  lastLoginAt   DateTime?

  // Security & 2FA
  twoFactorSecret       String?
  twoFactorEnabled      Boolean   @default(false)
  twoFactorBackupCodes  String?
  twoFactorVerifiedAt   DateTime?
  twoFactorMethod       String    @default("TOTP")
  
  // Login Security
  lastFailedLoginAt     DateTime?
  failedLoginCount      Int       @default(0)
  lockedUntilAt         DateTime?
  passwordChangedAt     DateTime?
  passwordResetToken    String?   @unique
  passwordResetExpiry   DateTime?

  // Account Status
  emailConfirmedAt      DateTime?
  phoneConfirmedAt      DateTime?
  documentVerifiedAt    DateTime?
  kycCompletedAt        DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  accounts              Account[]
  sessions              Session[]
  preferences           UserPreferences?
  playerProfile         Player?
  coachProfile          Coach?
  clubManager           ClubManager?
  clubOwner             ClubOwner?
  leagueAdmin           LeagueAdmin?
  parentProfile         Parent?
  treasurerProfile      Treasurer?
  refereeProfile        Referee?
  scoutProfile          Scout?
  analyticsProfile      Analyst?
  subscription          Subscription?
  payments              Payment[]
  notifications         Notification[]
  scoutingReports       ScoutingProfile[]
  sentMessages          Message[]         @relation("MessageSender")
  upgradeRequests       UpgradeRequest[]
  loginHistory          LoginAttempt[]    @relation("UserLoginHistory")
  
  // Audit & Security
  auditLogsPerformed    AuditLog[]              @relation("AuditLogPerformedBy")
  auditLogsTarget       AuditLog[]              @relation("AuditLogTargetUser")
  impersonationSessions ImpersonationSession[]  @relation("ImpersonationAdmin")
  impersonationTargets  ImpersonationSession[]  @relation("ImpersonationTarget")
  
  // API Keys & Admin
  apiKeys               ApiKey[]
  approvedTimesheets    CoachTimesheet[]        @relation("TimesheetApprover")
  processedPayments     CoachPayment[]          @relation("PaymentProcessor")
  announcementsCreated  Announcement[]
  videosUploaded        Video[]                 @relation("videosUploaded")

  // Club & Team Relations
  ownedClubs            Club[]          @relation("ClubOwner")
  clubMemberships       ClubMember[]    @relation("ClubMemberships")
  teamMemberships       TeamMember[]    @relation("TeamMemberships")
  userRoles             UserRole_User[] @relation("UserRoles")
  joinRequests          JoinRequest[]   @relation("UserJoinRequests")

  @@index([email])
  @@index([status])
  @@index([isSuperAdmin])
  @@index([createdAt])
  @@index([lastLoginAt])
  @@map("users")
}

model UserRole_User {
  id       String   @id @default(cuid())
  userId   String
  roleName UserRole

  user User @relation("UserRoles", fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([userId, roleName])
  @@index([userId])
  @@index([roleName])
  @@map("user_roles")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([provider, providerAccountId])
  @@index([userId])
  @@index([provider])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  ipAddress    String?
  userAgent    String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([userId])
  @@index([expires])
  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  type       String   @default("EMAIL")
  expires    DateTime

  createdAt DateTime @default(now())

  @@unique([identifier, token, type])
  @@index([identifier])
  @@map("verification_tokens")
}

model UserPreferences {
  id     String @id @default(cuid())
  userId String @unique

  theme    String @default("auto")
  language String @default("en-GB")
  timezone String @default("Europe/London")
  currency String @default("GBP")

  notificationsEmail     Boolean @default(true)
  notificationsSMS       Boolean @default(false)
  notificationsPush      Boolean @default(true)
  notificationsMatchDay  Boolean @default(true)
  notificationsPerformance Boolean @default(true)
  notificationsInjury    Boolean @default(true)
  emailDigest            String  @default("WEEKLY")

  privateProfile         Boolean @default(false)
  analyticsLevel         String  @default("BASIC")
  allowDataSelling       Boolean @default(false)
  shareStatsPublicly     Boolean @default(true)

  defaultView            String  @default("DASHBOARD")
  itemsPerPage           Int     @default(25)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("user_preferences")
}

// ============================================================================
// AUDIT & SECURITY MODELS - ENHANCED
// ============================================================================

model AuditLog {
  id            String          @id @default(cuid())
  performedById String
  performedBy   User            @relation("AuditLogPerformedBy", fields: [performedById], references: [id], onDelete: Cascade)
  
  targetUserId  String?
  targetUser    User?           @relation("AuditLogTargetUser", fields: [targetUserId], references: [id], onDelete: SetNull)
  
  action        AuditActionType
  entityType    String?
  entityId      String?
  resourceName  String?
  changes       Json?
  details       String?         @db.Text
  
  ipAddress     String?
  userAgent     String?
  severity      String          @default("INFO")
  status        String          @default("SUCCESS")

  createdAt DateTime @default(now())

  @@index([performedById])
  @@index([targetUserId])
  @@index([action])
  @@index([createdAt])
  @@index([severity])
  @@index([entityType, entityId])
  @@index([performedById, createdAt])
  @@map("audit_logs")
}

model ImpersonationSession {
  id           String    @id @default(cuid())
  adminId      String
  admin        User      @relation("ImpersonationAdmin", fields: [adminId], references: [id], onDelete: Cascade)
  
  targetUserId String
  targetUser   User      @relation("ImpersonationTarget", fields: [targetUserId], references: [id], onDelete: Cascade)
  
  startedAt    DateTime  @default(now())
  endedAt      DateTime?
  
  ipAddress    String?
  userAgent    String?
  reason       String?
  activities   Json?

  createdAt DateTime @default(now())

  @@index([adminId])
  @@index([targetUserId])
  @@index([startedAt])
  @@map("impersonation_sessions")
}

model SecuritySetting {
  id String @id @default(cuid())

  sessionTimeoutMinutes    Int     @default(30)
  maxLoginAttemptsAllowed  Int     @default(5)
  lockoutDurationMinutes   Int     @default(15)
  passwordExpirationDays   Int?    @default(90)
  
  ipWhitelist              String[]
  ipBlacklist              String[]
  restrictAccessByIP       Boolean @default(false)
  
  twoFactorRequired        Boolean @default(false)
  allowApiKeys             Boolean @default(true)
  apiKeyRotationDays       Int     @default(90)
  
  auditLoggingEnabled      Boolean @default(true)
  alertOnSuspiciousActivity Boolean @default(true)
  logRetentionDays         Int     @default(365)
  
  encryptSensitiveData     Boolean @default(true)
  gdprDeletionRetentionDays Int   @default(30)
  dataExportEnabled        Boolean @default(true)
  
  apiRateLimit             Int     @default(1000)
  loginRateLimit           Int     @default(10)
  
  updatedAt DateTime @updatedAt
  updatedBy String?

  @@map("security_settings")
}

model LoginAttempt {
  id           String   @id @default(cuid())
  userId       String?
  email        String
  success      Boolean
  ipAddress    String?
  userAgent    String?
  reason       String?
  location     String?
  
  attemptedAt  DateTime @default(now())

  user         User?    @relation("UserLoginHistory", fields: [userId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([userId])
  @@index([attemptedAt])
  @@index([success])
  @@index([email, attemptedAt])
  @@map("login_attempts")
}

model ApiKey {
  id       String   @id @default(cuid())
  userId   String
  name     String
  key      String   @unique
  prefix   String
  
  lastUsedAt DateTime?
  expiresAt DateTime?
  revokedAt DateTime?
  
  scopes   String[]
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([expiresAt])
  @@map("api_keys")
}

// ============================================================================
// CLUB & TEAM MODELS - ENHANCED WITH MULTI-SPORT
// ============================================================================

model Club {
  id              String  @id @default(cuid())
  name            String
  code            String  @unique
  city            String
  country         String  @default("United Kingdom")
  foundedYear     Int?
  description     String? @db.Text
  stadiumName     String?
  stadiumCapacity Int?
  logoUrl         String?
  coverUrl        String?
  primaryColor    String  @default("#FFD700")
  secondaryColor  String  @default("#FF6B35")
  website         String?
  socialLinks     Json?
  
  status          String  @default("ACTIVE")
  type            TeamType @default(PROFESSIONAL)
  ownerId         String  @unique
  timezone        String  @default("Europe/London")
  currency        String  @default("GBP")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  owner           User           @relation("ClubOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  teams           Team[]
  members         ClubMember[]

  @@index([ownerId])
  @@index([status])
  @@index([code])
  @@map("clubs")
}

model ClubMember {
  id              String         @id @default(cuid())
  clubId          String
  userId          String
  role            ClubMemberRole @default(MANAGER)
  status          String         @default("ACTIVE")
  
  joinedAt        DateTime       @default(now())
  joinedBy        String?
  permissions     Json?
  notes           String?        @db.Text

  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  club Club @relation(fields: [clubId], references: [id], onDelete: Cascade)
  user User @relation("ClubMemberships", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([clubId, userId])
  @@index([clubId])
  @@index([userId])
  @@index([role])
  @@index([status])
  @@map("club_members")
}

model Team {
  id              String  @id @default(cuid())
  name            String
  code            String
  clubId          String
  
  // MULTI-SPORT FIELDS
  sport           Sport   @default(FOOTBALL)
  positionSystem  String  @default("FOOTBALL") // FOOTBALL, NETBALL, RUGBY, CRICKET, AMERICAN_FOOTBALL, BASKETBALL
  maxPlayersOnCourt Int   @default(11)         // 11 for Football, 7 for Netball, 15 for Rugby, etc.
  totalSquadSize  Int     @default(23)         // Typical squad size
  
  ageGroup        String  @default("SENIOR")
  category        String  @default("FIRST_TEAM")
  status          String  @default("ACTIVE")
  description     String? @db.Text
  logoUrl         String?
  
  founded         DateTime?
  stadiumId       String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  club              Club               @relation(fields: [clubId], references: [id], onDelete: Cascade)
  members           TeamMember[]
  joinRequests      JoinRequest[]
  leagueTeams       LeagueTeam[]
  invitations       LeagueInvitation[]
  announcements     Announcement[]
  videos            Video[]
  trainingSessions  TrainingSession[]
  homeMatches       Match[]            @relation("HomeTeam")
  awayMatches       Match[]            @relation("AwayTeam")
  tactics           Tactic[]

  @@unique([clubId, code])
  @@index([clubId])
  @@index([status])
  @@index([sport])
  @@map("teams")
}

model TeamMember {
  id              String   @id @default(cuid())
  teamId          String
  userId          String
  role            String   @default("PLAYER")
  status          String   @default("ACTIVE")
  
  joinedAt        DateTime @default(now())
  leftAt          DateTime?
  isCaptain       Boolean  @default(false)
  number          Int?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user User @relation("TeamMemberships", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
  @@index([teamId])
  @@index([userId])
  @@index([role])
  @@map("team_members")
}

model JoinRequest {
  id              String   @id @default(cuid())
  teamId          String
  userId          String
  message         String?  @db.Text
  status          String   @default("PENDING")
  
  respondedBy     String?
  respondedAt     DateTime?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user User @relation("UserJoinRequests", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
  @@index([teamId])
  @@index([userId])
  @@index([status])
  @@map("join_requests")
}

// ============================================================================
// UPGRADE REQUEST SYSTEM
// ============================================================================

model UpgradeRequest {
  id              String               @id @default(cuid())
  userId          String
  currentRole     UserRole
  requestedRole   UserRole
  reason          String               @db.Text
  evidence        String[]
  status          UpgradeRequestStatus @default(PENDING)

  reviewedBy      String?
  reviewedAt      DateTime?
  reviewNotes     String?              @db.Text
  approvedAt      DateTime?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("upgrade_requests")
}

// ============================================================================
// PLAYER MODELS - ENHANCED
// ============================================================================

model Player {
  id            String @id @default(cuid())
  userId        String @unique
  firstName     String
  lastName      String
  dateOfBirth   DateTime
  nationality   String
  secondNationality String?
  
  height        Float?
  weight        Float?
  position      Position
  preferredFoot PreferredFoot
  secondaryPosition Position?
  
  shirtNumber   Int?
  photo         String?
  passportUrl   String?
  
  status        String  @default("ACTIVE")
  developmentNotes String? @db.Text
  playerType    String  @default("FIELD")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user               User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  stats              PlayerStats[]
  achievements       PlayerAchievement[]
  scoutingProfiles   ScoutingProfile[]
  matchEvents        MatchEvent[]
  trainingAttendance TrainingAttendance[]
  tacticPositions    TacticPlayer[]
  matchAttendance    MatchAttendance[]
  injuries           Injury[]
  contracts          Contract[]

  @@index([userId])
  @@index([position])
  @@index([status])
  @@map("players")
}

model PlayerStats {
  id              String   @id @default(cuid())
  playerId        String
  season          Int
  teamId          String?

  appearances     Int @default(0)
  goals           Int @default(0)
  assists         Int @default(0)
  minutesPlayed   Int @default(0)
  
  passingAccuracy Float?
  passes          Int?
  passesCompleted Int?
  
  tackles         Int?
  interceptions   Int?
  clearances      Int?
  blocks          Int?
  
  shotsOnTarget   Int?
  totalShots      Int?
  expectedGoals   Float?
  expectedAssists Float?
  
  sprintDistance  Float?
  topSpeed        Float?
  acceleration    Float?
  jumpHeight      Float?
  
  dribbles        Int?
  foulsCommitted  Int?
  foulsDrawn      Int?
  yellowCards     Int?
  redCards        Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([playerId, season, teamId])
  @@index([playerId])
  @@index([season])
  @@map("player_stats")
}

model Injury {
  id              String    @id @default(cuid())
  playerId        String
  type            String
  severity        String    @default("MINOR")
  
  dateFrom        DateTime
  dateTo          DateTime?
  estimatedReturn DateTime?
  
  description     String?   @db.Text
  treatment       String?
  status          String    @default("ACTIVE")
  
  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([playerId])
  @@index([dateFrom])
  @@map("injuries")
}

model Contract {
  id              String   @id @default(cuid())
  playerId        String
  clubId          String?
  position        Position
  
  salary          Float?
  currency        String   @default("GBP")
  startDate       DateTime
  endDate         DateTime?
  
  contractType    String   @default("PROFESSIONAL")
  status          String   @default("ACTIVE")
  documentUrl     String?
  
  extensionOption Boolean  @default(false)
  extensionDate   DateTime?
  
  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([playerId])
  @@index([status])
  @@map("contracts")
}

// ============================================================================
// COACH & STAFF MODELS - ENHANCED
// ============================================================================

model Coach {
  id              String @id @default(cuid())
  userId          String @unique
  coachType       String @default("HEAD_COACH")

  bio             String?  @db.Text
  yearsExperience Int?
  qualifications  String[]
  specializations String[]
  certifications  String[]

  hourlyRate      Float?
  currency        String   @default("GBP")
  bankDetails     Json?
  taxId           String?
  contractType    String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user             User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  trainingSessions TrainingSession[]
  tactics          Tactic[]
  timesheets       CoachTimesheet[]
  payments         CoachPayment[]

  @@index([userId])
  @@map("coaches")
}

model Referee {
  id                String  @id @default(cuid())
  userId            String  @unique
  
  licenseNumber     String? @unique
  licenseLevel      String?
  yearsOfExperience Int?
  specialization    String?
  
  certificationDate DateTime?
  certificationExpiry DateTime?
  
  assignedMatches   Int     @default(0)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user             User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  matchAssignments Match[]
  resultApprovals  MatchResultApproval[]

  @@index([userId])
  @@map("referees")
}

model Scout {
  id              String  @id @default(cuid())
  userId          String  @unique
  
  specialization  String
  region          String
  yearsExperience Int?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("scouts")
}

model Analyst {
  id              String  @id @default(cuid())
  userId          String  @unique
  
  specialization  String
  tools           String[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("analysts")
}

model ClubManager {
  id              String @id @default(cuid())
  userId          String @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("club_managers")
}

model ClubOwner {
  id              String @id @default(cuid())
  userId          String @unique

  canManageTeams      Boolean @default(true)
  canManageTreasury   Boolean @default(true)
  canViewAnalytics    Boolean @default(true)
  canManageMembers    Boolean @default(true)
  canManageLeagues    Boolean @default(true)
  canUpdateProfile    Boolean @default(true)
  canDeleteClub       Boolean @default(false)
  canTransferOwnership Boolean @default(false)
  canViewReports      Boolean @default(true)
  canManageSubscriptions Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade, map: "club_owner_user_fk")

  @@index([userId])
  @@map("club_owners")
}

model Treasurer {
  id              String  @id @default(cuid())
  userId          String  @unique
  clubId          String?
  permissions     Json?

  canViewFinancials   Boolean @default(true)
  canApprovePayments  Boolean @default(true)
  canManageBudgets    Boolean @default(true)
  canGenerateReports  Boolean @default(true)
  canExportData       Boolean @default(true)
  canManageTaxes      Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([clubId])
  @@map("treasurers")
}

model Parent {
  id              String  @id @default(cuid())
  userId          String  @unique
  
  childrenIds     String[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("parents")
}

// ============================================================================
// LEAGUE & FIXTURES MODELS - ENHANCED WITH MULTI-SPORT
// ============================================================================

model League {
  id              String  @id @default(cuid())
  name            String
  code            String  @unique
  
  // MULTI-SPORT SUPPORT
  sport           Sport   @default(FOOTBALL)
  
  logo            String?
  country         String
  season          Int
  status          String  @default("ACTIVE")

  pointsWin       Int @default(3)
  pointsDraw      Int @default(1)
  pointsLoss      Int @default(0)

  format          LeagueFormat     @default(ROUND_ROBIN)
  visibility      LeagueVisibility @default(PUBLIC)
  registrationOpen Boolean         @default(true)
  maxTeams        Int?

  adminId         String
  admin           LeagueAdmin @relation(fields: [adminId], references: [id])
  
  teams           LeagueTeam[]
  fixtures        Fixture[]
  standings       Standings[]
  seasons         LeagueSeason[]
  configuration   LeagueConfiguration?
  invitations     LeagueInvitation[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([code])
  @@index([adminId])
  @@index([season])
  @@index([status])
  @@index([sport])
  @@map("leagues")
}

model LeagueSeason {
  id              String    @id @default(cuid())
  leagueId        String
  name            String
  startDate       DateTime
  endDate         DateTime?
  isActive        Boolean   @default(true)
  isCurrent       Boolean   @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  league League @relation(fields: [leagueId], references: [id], onDelete: Cascade)

  @@index([leagueId])
  @@map("league_seasons")
}

model LeagueConfiguration {
  id              String @id @default(cuid())
  leagueId        String @unique

  pointsForWin    Int @default(3)
  pointsForDraw   Int @default(1)
  pointsForLoss   Int @default(0)

  bonusPointsEnabled Boolean @default(false)
  bonusPointsForGoals Int?

  minTeams        Int  @default(2)
  maxTeams        Int?

  registrationOpen Boolean   @default(true)
  registrationDeadline DateTime?
  entryFee         Float?

  minPlayerAge    Int?
  maxPlayerAge    Int?
  maxPlayersPerTeam Int?
  minPlayersPerMatch Int @default(7)

  tiebreaker1     String @default("GOAL_DIFFERENCE")
  tiebreaker2     String @default("GOALS_SCORED")
  tiebreaker3     String @default("HEAD_TO_HEAD")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  league League @relation(fields: [leagueId], references: [id], onDelete: Cascade)

  @@map("league_configurations")
}

model LeagueInvitation {
  id              String           @id @default(cuid())
  leagueId        String
  teamId          String
  invitedBy       String
  message         String?
  status          InvitationStatus @default(PENDING)
  expiresAt       DateTime?
  respondedAt     DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  league League      @relation(fields: [leagueId], references: [id], onDelete: Cascade)
  team   Team        @relation(fields: [teamId], references: [id], onDelete: Cascade)
  admin  LeagueAdmin @relation(fields: [invitedBy], references: [id], onDelete: Cascade)

  @@unique([leagueId, teamId])
  @@index([leagueId])
  @@index([teamId])
  @@index([invitedBy])
  @@map("league_invitations")
}

model LeagueAdmin {
  id              String @id @default(cuid())
  userId          String @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user            User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  leagues         League[]
  invitationsSent LeagueInvitation[]

  @@index([userId])
  @@map("league_admins")
}

model LeagueTeam {
  id              String    @id @default(cuid())
  leagueId        String
  teamId          String
  joinedAt        DateTime  @default(now())
  leftAt          DateTime?

  league League @relation(fields: [leagueId], references: [id], onDelete: Cascade)
  team   Team   @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([leagueId, teamId])
  @@index([leagueId])
  @@index([teamId])
  @@map("league_teams")
}

model Fixture {
  id              String @id @default(cuid())
  leagueId        String
  matchweek       Int
  season          Int
  status          String @default("UPCOMING")

  league  League  @relation(fields: [leagueId], references: [id], onDelete: Cascade)
  matches Match[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([leagueId])
  @@index([matchweek])
  @@index([season])
  @@map("fixtures")
}

model Standings {
  id              String @id @default(cuid())
  leagueId        String
  teamId          String
  position        Int

  played          Int @default(0)
  won             Int @default(0)
  drawn           Int @default(0)
  lost            Int @default(0)

  goalsFor        Int @default(0)
  goalsAgainst    Int @default(0)
  goalDifference  Int @default(0)
  points          Int @default(0)

  form            String  @default("")

  league League @relation(fields: [leagueId], references: [id], onDelete: Cascade)

  updatedAt DateTime @updatedAt

  @@unique([leagueId, teamId])
  @@index([leagueId])
  @@index([position])
  @@index([points])
  @@map("standings")
}

// ============================================================================
// MATCH & EVENT MODELS - ENHANCED WITH MULTI-SPORT
// ============================================================================

model Match {
  id              String      @id @default(cuid())
  fixtureId       String?
  homeTeamId      String
  awayTeamId      String
  refereeId       String?
  
  // MULTI-SPORT SUPPORT
  sport           Sport       @default(FOOTBALL)
  
  date            DateTime
  kickOffTime     DateTime?
  venue           String?
  venueCity       String?
  
  status          MatchStatus @default(SCHEDULED)
  homeGoals       Int?
  awayGoals       Int?
  attendance      Int?

  homeGoalsET     Int?
  awayGoalsET     Int?
  homePenalties   Int?
  awayPenalties   Int?

  attendanceDeadline DateTime?
  
  notes           String?     @db.Text
  highlights      String?

  fixture         Fixture?                @relation(fields: [fixtureId], references: [id], onDelete: SetNull)
  homeTeam        Team                    @relation("HomeTeam", fields: [homeTeamId], references: [id])
  awayTeam        Team                    @relation("AwayTeam", fields: [awayTeamId], references: [id])
  referee         Referee?                @relation(fields: [refereeId], references: [id], onDelete: SetNull)
  
  events          MatchEvent[]
  stats           MatchStats?
  playerAttendances MatchAttendance[]
  resultApprovals MatchResultApproval[]
  videos          Video[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([fixtureId])
  @@index([homeTeamId])
  @@index([awayTeamId])
  @@index([refereeId])
  @@index([date])
  @@index([status])
  @@index([sport])
  @@map("matches")
}

model MatchResultApproval {
  id              String               @id @default(cuid())
  matchId         String
  submittedBy     String
  approvedBy      String?
  status          ResultApprovalStatus @default(PENDING)

  homeScore       Int
  awayScore       Int
  notes           String?

  submittedAt     DateTime @default(now())
  reviewedAt      DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  match   Match    @relation(fields: [matchId], references: [id], onDelete: Cascade)
  referee Referee? @relation(fields: [approvedBy], references: [id], onDelete: SetNull)

  @@index([matchId])
  @@index([submittedBy])
  @@index([approvedBy])
  @@index([status])
  @@map("match_result_approvals")
}

model MatchAttendance {
  id              String                @id @default(cuid())
  matchId         String
  playerId        String
  status          MatchAttendanceStatus @default(AVAILABLE)

  respondedAt     DateTime?
  confirmedBy     String?
  notes           String?               @db.Text
  minutesPlayed   Int?
  performanceRating Float?
  
  position        Position?
  shirtNumber     Int?

  match  Match  @relation(fields: [matchId], references: [id], onDelete: Cascade)
  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([matchId, playerId])
  @@index([matchId])
  @@index([playerId])
  @@index([status])
  @@map("match_attendance")
}

model MatchEvent {
  id              String         @id @default(cuid())
  matchId         String
  playerId        String?
  assistedBy      String?
  type            MatchEventType
  minute          Int
  isExtraTime     Boolean        @default(false)
  additionalInfo  String?

  match  Match   @relation(fields: [matchId], references: [id], onDelete: Cascade)
  player Player? @relation(fields: [playerId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now())

  @@index([matchId])
  @@index([playerId])
  @@index([minute])
  @@map("match_events")
}

model MatchStats {
  id              String @id @default(cuid())
  matchId         String @unique

  homeTeamId      String
  homePossession  Int?
  homeShots       Int?
  homeShotsOnTarget Int?
  homePasses      Int?
  homePassAccuracy Float?
  homeTackles     Int?
  homeFouls       Int?
  homeCorners     Int?
  homeOffsides    Int?

  awayTeamId      String
  awayPossession  Int?
  awayShots       Int?
  awayShotsOnTarget Int?
  awayPasses      Int?
  awayPassAccuracy Float?
  awayTackles     Int?
  awayFouls       Int?
  awayCorners     Int?
  awayOffsides    Int?

  match Match @relation(fields: [matchId], references: [id], onDelete: Cascade)

  updatedAt DateTime @updatedAt

  @@index([matchId])
  @@map("match_stats")
}

// ============================================================================
// TRAINING MODELS - ENHANCED
// ============================================================================

model TrainingSession {
  id              String   @id @default(cuid())
  teamId          String
  coachId         String
  
  date            DateTime
  startTime       DateTime
  endTime         DateTime
  duration        Int
  
  location        String?
  focus           String
  notes           String?  @db.Text
  sessionType     String   @default("TEAM")

  team            Team                @relation(fields: [teamId], references: [id], onDelete: Cascade)
  coach           Coach               @relation(fields: [coachId], references: [id])
  drills          SessionDrill[]
  attendance      TrainingAttendance[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([teamId])
  @@index([coachId])
  @@index([date])
  @@map("training_sessions")
}

model Drill {
  id              String            @id @default(cuid())
  name            String
  description     String            @db.Text
  duration        Int
  intensity       TrainingIntensity
  playerCount     Int
  difficulty      String
  category        TrainingCategory
  videoUrl        String?
  equipment       String[]

  sessions        SessionDrill[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
  @@index([intensity])
  @@map("drills")
}

model SessionDrill {
  id              String @id @default(cuid())
  trainingSessionId String
  drillId         String
  order           Int
  durationOverride Int?

  trainingSession TrainingSession @relation(fields: [trainingSessionId], references: [id], onDelete: Cascade)
  drill           Drill           @relation(fields: [drillId], references: [id])

  @@unique([trainingSessionId, drillId])
  @@index([trainingSessionId])
  @@index([drillId])
  @@map("session_drills")
}

model TrainingAttendance {
  id              String           @id @default(cuid())
  trainingSessionId String
  playerId        String
  status          AttendanceStatus
  performanceRating Int?
  notes           String?

  trainingSession TrainingSession @relation(fields: [trainingSessionId], references: [id], onDelete: Cascade)
  player          Player          @relation(fields: [playerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([trainingSessionId, playerId])
  @@index([trainingSessionId])
  @@index([playerId])
  @@map("training_attendance")
}

// ============================================================================
// COACH TIMESHEET & PAYMENT MODELS
// ============================================================================

model CoachTimesheet {
  id              String @id @default(cuid())
  coachId         String
  period          String
  billingCycle    String @default("MONTHLY")

  startDate       DateTime
  endDate         DateTime

  trainingHours   Float @default(0)
  matchHours      Float @default(0)
  adminHours      Float @default(0)
  otherHours      Float @default(0)
  totalHours      Float @default(0)

  hourlyRate      Float
  totalAmount     Float

  status          TimesheetStatus @default(DRAFT)
  submittedAt     DateTime?
  reviewedBy      String?
  reviewedAt      DateTime?
  reviewNotes     String?         @db.Text
  approvedBy      String?
  approvedAt      DateTime?

  attachments     String[]

  coach           Coach @relation(fields: [coachId], references: [id], onDelete: Cascade)
  approver        User? @relation("TimesheetApprover", fields: [approvedBy], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([coachId])
  @@index([status])
  @@index([startDate, endDate])
  @@map("coach_timesheets")
}

model CoachPayment {
  id              String        @id @default(cuid())
  coachId         String
  timesheetId     String?
  amount          Float
  currency        String        @default("GBP")
  paymentType     PaymentType   @default(COACHING_FEE)
  status          PaymentStatus @default(PENDING)

  paymentMethod   String?
  transactionId   String?
  invoiceNumber   String?
  invoiceUrl      String?

  processedBy     String?
  processedAt     DateTime?
  paidAt          DateTime?
  notes           String?       @db.Text

  coach           Coach @relation(fields: [coachId], references: [id], onDelete: Cascade)
  processor       User? @relation("PaymentProcessor", fields: [processedBy], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([coachId])
  @@index([status])
  @@index([paymentType])
  @@map("coach_payments")
}

// ============================================================================
// TACTICAL MODELS
// ============================================================================

model Tactic {
  id              String    @id @default(cuid())
  coachId         String
  teamId          String
  name            String
  formation       Formation
  description     String?   @db.Text
  playStyle       String    @default("BALANCED")
  defensiveShape  String    @default("COMPACT")
  pressType       String    @default("MID_BLOCK")
  
  notes           String?   @db.Text

  coach           Coach          @relation(fields: [coachId], references: [id])
  team            Team           @relation(fields: [teamId], references: [id])
  playerPositions TacticPlayer[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([coachId])
  @@index([teamId])
  @@map("tactics")
}

model TacticPlayer {
  id              String   @id @default(cuid())
  tacticId        String
  playerId        String
  position        Position
  role            String?

  tactic Tactic @relation(fields: [tacticId], references: [id], onDelete: Cascade)
  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@unique([tacticId, playerId])
  @@index([tacticId])
  @@index([playerId])
  @@map("tactic_players")
}

// ============================================================================
// PAYMENT & SUBSCRIPTION MODELS
// ============================================================================

model Subscription {
  id              String             @id @default(cuid())
  userId          String             @unique
  tier            SubscriptionTier   @default(FREE)
  status          SubscriptionStatus @default(ACTIVE)

  monthlyPrice    Float?
  annualPrice     Float?
  annualDiscount  Boolean            @default(false)
  customPrice     Float?
  grantedByAdmin  Boolean            @default(false)
  grantedBy       String?
  grantReason     String?

  stripeCustomerId String? @unique
  stripeSubscriptionId String? @unique

  currentPeriodStart DateTime?
  currentPeriodEnd   DateTime?
  cancelledAt        DateTime?
  trialEndsAt        DateTime?

  autoRenew       Boolean @default(true)

  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  payments        Payment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([stripeCustomerId])
  @@index([stripeSubscriptionId])
  @@index([tier])
  @@index([status])
  @@map("subscriptions")
}

model Payment {
  id              String        @id @default(cuid())
  subscriptionId  String?
  userId          String
  amount          Float
  currency        String        @default("GBP")
  status          PaymentStatus @default(PENDING)
  paymentType     PaymentType   @default(SUBSCRIPTION)

  stripePaymentIntentId String? @unique
  stripeInvoiceId       String?
  invoiceUrl            String?

  refundedBy      String?
  refundReason    String?
  refundedAt      DateTime?

  subscription Subscription? @relation(fields: [subscriptionId], references: [id], onDelete: SetNull)
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([subscriptionId])
  @@index([userId])
  @@index([stripePaymentIntentId])
  @@index([status])
  @@index([paymentType])
  @@map("payments")
}

// ============================================================================
// GAMIFICATION MODELS
// ============================================================================

model Achievement {
  id              String  @id @default(cuid())
  name            String  @unique
  description     String  @db.Text
  icon            String?
  criterion       String
  threshold       Int
  points          Int     @default(10)
  badgeColor      String  @default("#FFD700")

  playerAchievements PlayerAchievement[]

  @@index([criterion])
  @@map("achievements")
}

model PlayerAchievement {
  id              String   @id @default(cuid())
  playerId        String
  achievementId   String
  unlockedAt      DateTime @default(now())
  progress        Int      @default(0)

  player          Player      @relation(fields: [playerId], references: [id], onDelete: Cascade)
  achievement     Achievement @relation(fields: [achievementId], references: [id], onDelete: Cascade)

  @@unique([playerId, achievementId])
  @@index([playerId])
  @@index([achievementId])
  @@map("player_achievements")
}

model Leaderboard {
  id              String  @id @default(cuid())
  leagueId        String?
  teamId          String?
  type            String
  season          Int
  period          String  @default("SEASON")

  @@index([leagueId])
  @@index([teamId])
  @@index([type])
  @@index([season])
  @@map("leaderboards")
}

// ============================================================================
// SCOUTING MODELS
// ============================================================================

model ScoutingProfile {
  id              String   @id @default(cuid())
  playerId        String
  createdBy       String
  
  overallRating   Int
  potential       Int
  strengths       String[]
  weaknesses      String[]
  notes           String?  @db.Text
  videoLinks      String[]
  comparablePlayer String?
  
  recommendedClubs String[]
  recommendedLeagues String[]

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)
  scout  User   @relation(fields: [createdBy], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([playerId])
  @@index([createdBy])
  @@index([overallRating])
  @@map("scouting_profiles")
}

// ============================================================================
// COMMUNICATION MODELS
// ============================================================================

model Message {
  id              String  @id @default(cuid())
  teamId          String?
  senderId        String
  content         String  @db.Text
  attachmentUrl   String?

  sender          User               @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)
  recipients      MessageRecipient[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([teamId])
  @@index([senderId])
  @@index([createdAt])
  @@map("messages")
}

model MessageRecipient {
  id              String    @id @default(cuid())
  messageId       String
  recipientId     String
  readAt          DateTime?

  message Message @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@unique([messageId, recipientId])
  @@index([messageId])
  @@index([recipientId])
  @@map("message_recipients")
}

// ============================================================================
// NOTIFICATION MODELS
// ============================================================================

model Notification {
  id              String           @id @default(cuid())
  userId          String
  type            NotificationType
  title           String
  message         String
  link            String?
  read            Boolean          @default(false)
  metadata        Json?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([userId])
  @@index([read])
  @@index([createdAt])
  @@index([userId, read])
  @@map("notifications")
}

// ============================================================================
// ANNOUNCEMENTS & VIDEOS
// ============================================================================

model Announcement {
  id              String   @id @default(cuid())
  teamId          String
  createdBy       String
  title           String
  content         String   @db.Text
  priority        String   @default("NORMAL")
  pinned          Boolean  @default(false)
  
  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user User @relation(fields: [createdBy], references: [id])
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([teamId])
  @@index([createdBy])
  @@index([pinned])
  @@map("announcements")
}

model Video {
  id              String  @id @default(cuid())
  teamId          String?
  matchId         String?
  createdBy       String  
  title           String
  description     String? @db.Text
  url             String
  duration        Int?
  type            String  @default("TRAINING")
  videoType       String  @default("UPLOADED")
  
  views           Int     @default(0)
  
  team Team?   @relation(fields: [teamId], references: [id], onDelete: SetNull)
  match Match?  @relation(fields: [matchId], references: [id], onDelete: SetNull)
  creator User   @relation("videosUploaded", fields: [createdBy], references: [id], onDelete: Cascade)
  stream        VideoStream?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([teamId])
  @@index([matchId])
  @@index([createdBy])
  @@index([type])
  @@map("videos")
}

// ============================================================================
// VIDEO STREAMING MODELS
// ============================================================================

model VideoStream {
  id                    String                @id @default(cuid())
  videoId               String                @unique
  
  // Provider Configuration
  provider              VideoProcessingProvider @default(MUX)
  providerAssetId       String?               @unique
  providerPlaybackId    String?               @unique
  hlsPlaylistUrl        String?
  dashManifestUrl       String?
  
  // Quality Variants (Mux generates these automatically)
  transcodeStatus       TranscodingStatus     @default(PENDING)
  transcodeProgress     Int                   @default(0)
  
  // Streaming URLs by Quality
  url480p               String?
  url720p               String?
  url1080p              String?
  url4k                 String?
  
  // Metadata
  duration              Int?                  @default(0)
  width                 Int?
  height                Int?
  aspectRatio           String?               @default("16:9")
  fps                   Int?                  @default(30)
  bitrate               String?
  codecs                String?
  
  // Analytics
  views                 Int                   @default(0)
  totalPlayTimeMinutes  Int                   @default(0)
  averageViewDuration  Float?
  completionRate        Float?
  droppedFramePercent   Float?
  
  // Thumbnail
  thumbnailUrl          String?
  thumbnailSmall        String?               // For preview cards
  posterUrl             String?               // For player backdrop
  
  // Subtitles/Captions
  hasCaptions           Boolean               @default(false)
  captionTracks         Json?                 // { language: [{ url, type }] }
  
  // DRM & Security
  isLive                Boolean               @default(false)
  isPublic              Boolean               @default(true)
  requiresAuth          Boolean               @default(false)
  expiresAt             DateTime?             // For temporary links
  
  // Timestamps & Status
  startedAt             DateTime?
  completedAt           DateTime?
  failureReason         String?
  lastAccessedAt        DateTime?
  
  video                 Video                 @relation(fields: [videoId], references: [id], onDelete: Cascade)
  accessLogs            VideoAccessLog[]
  chapters              VideoChapter[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([videoId])
  @@index([provider])
  @@index([transcodeStatus])
  @@index([providerAssetId])
  @@map("video_streams")
}

model VideoChapter {
  id                    String                @id @default(cuid())
  videoStreamId         String
  
  title                 String
  description           String?               @db.Text
  startTime             Int                   // In seconds
  endTime               Int
  thumbnailUrl          String?
  
  videoStream           VideoStream           @relation(fields: [videoStreamId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([videoStreamId])
  @@index([startTime])
  @@map("video_chapters")
}

model VideoAccessLog {
  id                    String                @id @default(cuid())
  videoStreamId         String
  userId                String?
  
  // Access Info
  ipAddress             String?
  userAgent             String?
  countryCode           String?
  
  // Playback Stats
  playbackDuration      Int                   @default(0)      // Seconds played
  startedAt             DateTime?
  endedAt               DateTime?
  pauseCount            Int                   @default(0)
  seekCount             Int                   @default(0)
  
  // Quality Info
  initialQuality        VideoQuality?
  maxQualityReached     VideoQuality?
  bitrateSwitches       Int                   @default(0)
  
  // Device Info
  deviceType            String?               // mobile, tablet, desktop
  osName                String?               // iOS, Android, Windows, etc.
  browserName           String?
  
  // Network Info
  networkType           String?               // wifi, mobile_3g, mobile_4g, etc.
  bandwidth             Float?                // Mbps
  
  videoStream           VideoStream           @relation(fields: [videoStreamId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@index([videoStreamId])
  @@index([userId])
  @@index([createdAt])
  @@index([countryCode])
  @@map("video_access_logs")
}

model VideoInteraction {
  id                    String                @id @default(cuid())
  videoId               String
  userId                String?
  
  // Interaction Types
  type                  String                @default("PLAY") // PLAY, PAUSE, SEEK, QUALITY_CHANGE, FULLSCREEN, etc.
  timestamp             Int?                  // Video timestamp in seconds
  metadata              Json?                 // Additional data for the interaction
  
  // Engagement
  likedAt               DateTime?
  bookmarkedAt          DateTime?
  sharedAt              DateTime?
  
  createdAt DateTime @default(now())
  
  @@index([videoId])
  @@index([userId])
  @@index([type])
  @@map("video_interactions")
}

model VideoComment {
  id                    String                @id @default(cuid())
  videoId               String
  userId                String
  
  timestamp             Int?                  // Video timestamp in seconds
  text                  String                @db.Text
  parentCommentId       String?               // For nested comments
  
  likes                 Int                   @default(0)
  views                 Int                   @default(0)
  
  isSpotlighted         Boolean               @default(false)
  isPinned              Boolean               @default(false)
  isDeleted             Boolean               @default(false)
  
  parentComment         VideoComment?         @relation("CommentReplies", fields: [parentCommentId], references: [id], onDelete: Cascade)
  replies               VideoComment[]        @relation("CommentReplies")
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([videoId])
  @@index([userId])
  @@index([timestamp])
  @@index([parentCommentId])
  @@map("video_comments")
}

// ============================================================================
// PREDICTIVE ANALYTICS MODELS
// ============================================================================

model InjuryPrediction {
  id                    String          @id @default(cuid())
  playerId              String
  
  // Risk Assessment
  riskLevel             RiskLevel       @default(MEDIUM)
  riskPercentage        Float           @default(0)
  confidence            Float           @default(0)
  
  // Contributing Factors
  playtimeMinutesLastWeek Int?
  trainingLoadLastWeek  Int?            // Cumulative training minutes
  previousInjuries      Int?            // Count of past injuries
  ageInYears            Int?
  bmi                   Float?
  sprintAcceleration    Float?          // Recent acceleration in sprints
  
  // Vulnerability Factors
  vulnerabilityFactors  Json?           // { factor: { score, weight } }
  muscleGroupsAtRisk    String[]        @default([])
  
  // Timeline
  predictedRiskWindow   String?         // "NEXT_2_WEEKS", "NEXT_MONTH", etc.
  highestRiskDate       DateTime?
  estimatedRecoveryDays Int?
  
  // Recommendations
  recommendations       String[]
  recommendedRestDays   Int?
  suggestedCrossTraining String[]
  
  // Accuracy Metrics
  accuracy              PredictionAccuracy @default(MEDIUM)
  model                 String          @default("ensemble")
  modelVersion          String?
  
  // Tracking
  occurrenceOfPredicted Boolean?        // Did injury actually occur?
  actualInjuryDate      DateTime?
  wasAccurate           Boolean?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([playerId])
  @@index([riskLevel])
  @@index([createdAt])
  @@map("injury_predictions")
}

model PerformancePrediction {
  id                    String                @id @default(cuid())
  playerId              String
  
  // Current Performance Metrics
  recentFormRating      Float                 // 0-10 scale
  averageRatingLastMatches Float?
  consistencyScore      Float?                // How consistent recent performance
  
  // Predicted Metrics (Next Match/Week/Month)
  predictedPerformanceRating Float            // 0-10
  predictedGoals        Float?                // Expected goal contribution
  predictedAssists      Float?
  predictedPassAccuracy Float?
  predictedTackles      Int?
  
  // Trend Analysis
  performanceTrend      String    @default("STABLE") // IMPROVING, DECLINING, STABLE
  trendStrength         Float     @default(0)        // 0-1
  cyclePhase            String?                      // PEAK, POST_PEAK, VALLEY, etc.
  
  // Influencing Factors
  recentFormFactors     Json?     // Factors affecting current form
  recoveryStatus        String?   // FULL, PARTIAL, POOR
  mentalState           String?   // Estimated from recent performances
  teamDynamics          String?   // How team performance affects player
  oppositionRating      Float?    // Strength of upcoming opponent
  
  // Recommendations
  playingTimeRecommendation String?  // FULL, REDUCED, BENCH, REST
  positionRecommendation String?     // Optimal position for recovery/performance
  supportStrategies     String[]
  focusAreas            String[]
  
  // Accuracy
  accuracy              PredictionAccuracy @default(MEDIUM)
  
  timeHorizon           String    @default("NEXT_MATCH") // NEXT_MATCH, NEXT_WEEK, NEXT_MONTH
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([playerId])
  @@index([performanceTrend])
  @@index([createdAt])
  @@map("performance_predictions")
}

model FormationOptimization {
  id                    String    @id @default(cuid())
  teamId                String
  leagueId              String?
  
  // Analysis Context
  opponentStrengths     String[]
  opponentWeaknesses    String[]
  teamAvailablePlayers  String[]
  bannedOrInjuredPlayers String[]
  
  // Recommended Formation
  recommendedFormation  String    @default("4-3-3")
  matchupRating         Float     // How good is this formation against opponent
  
  // Alternative Formations (Backup options)
  alternativeFormations Json?     // { formation: { rating, reasoning } }
  
  // Player Positioning (Optimal lineup)
  recommendedLineup     Json?     // { position: playerId }
  substitutionSuggestions Json?   // { minute: [ { playerOut, playerIn, reason } ] }
  
  // Tactical Notes
  pressStrategy         String?   // HIGH, MID, LOW_BLOCK
  defensiveShape        String?   // COMPACT, BALANCED, AGGRESSIVE
  playStyle             String?   // POSSESSION, COUNTER, BALANCED
  keyTacticalFocuses    String[]
  
  // Set Piece Strategy
  cornerKickStrategy    String?
  freeKickStrategy      String?
  penaltyTaker          String?
  
  // Match Prediction
  expectedOutcome       String?   // WIN, DRAW, LOSS probability
  winProbability        Float?    // 0-1
  drawProbability       Float?
  lossProbability       Float?
  expectedGoalsFor      Float?
  expectedGoalsAgainst  Float?
  
  // Confidence
  confidence            Float     @default(0)
  accuracy              PredictionAccuracy @default(MEDIUM)
  
  // Metadata
  matchDate             DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([teamId])
  @@index([leagueId])
  @@index([createdAt])
  @@map("formation_optimizations")
}

model PlayerPotential {
  id                    String    @id @default(cuid())
  playerId              String    @unique
  
  // Current Assessment
  currentAbilityRating  Float     // 0-100
  peakAbilityRating     Float     // 0-100 (potential ceiling)
  developmentStage      String    // DEVELOPING, RISING, PEAK, DECLINING
  
  // Growth Trajectory
  yearsToReachPeak      Int?      // Estimated years
  peakAgeRange          String?   // e.g., "28-31"
  estimatedPeakValue    Float?    // Market value at peak
  
  // Growth Areas (Top development opportunities)
  growthAreas           Json?     // { skill: { currentLevel, targetLevel, priority } }
  strengthAreas         String[]  // Already strong
  developmentPriorities String[]
  
  // Player Profile
  playerType            String?   // TECHNICAL, PHYSICAL, MENTAL, BALANCED
  uniqueAttributes      String[]  // What makes them special
  improvementPotential  String    // HIGH, MEDIUM, LOW
  
  // Comparable Players (Similar players at same age)
  comparablePlayers     String[]  // Player IDs of similar trajectory
  benchmarkStats        Json?     // Stats to compare against
  
  // Career Projection
  projectedCareerValue  Json?     // { year: estimatedValue }
  retirementAgeEstimate Int?      // Estimated career end
  internationalChance   Float?    // Chance of playing for national team
  transferMarketValue   Float?    // Current estimated market value
  
  // Training Recommendations
  recommendedFocusAreas String[]
  trainingFocus         String?
  playingTimeNeed       String?   // HIGH, MEDIUM, LOW
  leagueRecommendation  String?   // Recommended competition level
  
  // Timeline
  lastUpdated           DateTime  @updatedAt
  createdAt DateTime @default(now())
  
  @@index([playerId])
  @@index([developmentStage])
  @@index([peakAbilityRating])
  @@map("player_potentials")
}

model LeagueAnalytics {
  id                    String    @id @default(cuid())
  leagueId              String    @unique
  
  // League Overview
  totalMatches          Int       @default(0)
  goalsPerMatch         Float?    @default(2.8)
  averagePossession     Float?
  averagePassAccuracy   Float?
  
  // Performance Distribution
  topScorerGoals        Int?
  topAssisterAssists    Int?
  averageAttendance     Int?
  
  // Team Rankings
  offensiveRanking      Json?     // { teamId: { goals, rating } }
  defensiveRanking      Json?     // { teamId: { goalsConceded, rating } }
  
  // Player Rankings
  topScorers            Json?     // [{ playerId, goals, team }]
  topAssisters          Json?     // [{ playerId, assists, team }]
  mostValuablePlayers   Json?     // [{ playerId, team, rating }]
  
  // Competitive Balance
  leagueParity          Float?    // How competitive (0-1)
  titleContenders       String[]
  relegationRisks       String[]
  
  // Trend Analysis
  scoringTrend          String?   // INCREASING, DECREASING, STABLE
  competitivenessTrend  String?   // Teams getting closer or spreading out
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([leagueId])
  @@map("league_analytics")
}

model PlayerComparison {
  id                    String    @id @default(cuid())
  playerId1             String
  playerId2             String
  
  // Comparison Context
  position              String
  age1                  Int?
  age2                  Int?
  
  // Direct Comparisons
  comparativeStrengths  Json?     // { metric: { player1Rating, player2Rating } }
  comparativeWeaknesses Json?
  
  // Statistical Comparison
  stats                 Json?     // { metric: { player1Value, player2Value, difference } }
  
  // Verdict
  betterOverallPlayer   String    // playerId1 or playerId2
  betterForRole         String?   // Which player fits team needs better
  betterTransferValue   String?
  
  // Development Outlook
  playerWithBetterTrajectory String?
  
  // Summary
  summary               String    @db.Text
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([playerId1, playerId2])
  @@index([position])
  @@map("player_comparisons")
}

model MarketValueAnalysis {
  id                    String    @id @default(cuid())
  playerId              String    @unique
  
  // Value Assessment
  currentMarketValue    Float
  currency              String    @default("GBP")
  confidence            Float     @default(0)
  
  // Value Components
  ageComponent          Float     // Value impact from age
  performanceComponent  Float     // Value from current form
  potentialComponent    Float     // Value from development upside
  marketDemandComponent Float     // Impact of supply/demand
  
  // Value Trends
  valueChange6Months    Float?
  valueChange12Months   Float?
  valueTrend            String?   // RISING, STABLE, DECLINING
  
  // Comparable Transfers
  recentSimilarTransfers Json?    // Similar player transfers
  transferMarketMean    Float?    // Average value of similar players
  
  // Transfer Risk
  transferRisk          RiskLevel
  injuryRiskFactoringInValue Boolean @default(true)
  
  // Recommendations
  buyRecommendation     String?   // BUY, HOLD, SELL
  fairValueRange        Json?     // { min, max }
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([playerId])
  @@index([valueTrend])
  @@map("market_value_analyses")
}

model FatigueAnalysis {
  id                    String    @id @default(cuid())
  playerId              String
  
  // Fatigue Assessment
  fatigueLevel          Float     // 0-100 scale
  riskLevel             RiskLevel
  
  // Contributing Factors
  playtimeLastDays      Json?     // { day: minutes }
  trainingIntensity     Float?    // Last week average
  matchIntensity        Float?    // From match tracking
  recoveryQuality       String?   // EXCELLENT, GOOD, POOR
  
  // Physical Indicators
  sprintSpeed           Float?    // Compared to baseline
  acceleration          Float?    // Change from baseline
  jumpHeight            Float?    // If available from tracking
  
  // Recommended Actions
  recommendRestDays     Int?
  suggestedActivities   String[]
  trainingModification  String?   // LIGHT, NORMAL, INTENSE
  
  // Timeline
  predictedRecoveryDate DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([playerId])
  @@index([riskLevel])
  @@map("fatigue_analyses")
}
